<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Laravel Passport 和 OAuth2 - DEVLOG of andyyou</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="DEVLOG of andyyou"><meta name="msapplication-TileImage" content="/img/faicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="DEVLOG of andyyou"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Laravel Passport 提供了 Laravel 應用程式完整的 OAuth2 伺服器實作整合。Passport 是基於 League OAuth2 Server 套件建置。  如果您還不知道何謂 OAuth2，在繼續之前，請先熟悉 OAuth2 的一般術語和功能。 參考資源"><meta property="og:type" content="article"><meta property="og:title" content="DEVLOG of andyyou"><meta property="og:url" content="https://andyyou.github.io/2023/12/05/laravel-passport/"><meta property="og:site_name" content="DEVLOG of andyyou"><meta property="og:description" content="Laravel Passport 提供了 Laravel 應用程式完整的 OAuth2 伺服器實作整合。Passport 是基於 League OAuth2 Server 套件建置。  如果您還不知道何謂 OAuth2，在繼續之前，請先熟悉 OAuth2 的一般術語和功能。 參考資源"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://andyyou.github.io/img/og_image.png"><meta property="article:published_time" content="2023-12-05T07:21:57.000Z"><meta property="article:modified_time" content="2023-12-07T08:51:33.010Z"><meta property="article:author" content="andyyou"><meta property="article:tag" content="laravel"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="fb:app_id" content="450470251782295"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://andyyou.github.io/2023/12/05/laravel-passport/"},"headline":"Laravel Passport 和 OAuth2","image":["https://andyyou.github.io/img/og_image.png"],"datePublished":"2023-12-05T07:21:57.000Z","dateModified":"2023-12-07T08:51:33.010Z","author":{"@type":"Person","name":"https://avatars2.githubusercontent.com/u/665690?v=3&s=466"},"publisher":{"@type":"Organization","name":"DEVLOG of andyyou","logo":{"@type":"ImageObject","url":"https://andyyou.github.io/img/logo.png"}},"description":"Laravel Passport 提供了 Laravel 應用程式完整的 OAuth2 伺服器實作整合。Passport 是基於 League OAuth2 Server 套件建置。  如果您還不知道何謂 OAuth2，在繼續之前，請先熟悉 OAuth2 的一般術語和功能。 參考資源"}</script><link rel="canonical" href="https://andyyou.github.io/2023/12/05/laravel-passport/"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-C93NK5NEGP" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-C93NK5NEGP');</script><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><script data-ad-client="ca-pub-3038600205998182" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="DEVLOG of andyyou" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/andyyou"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜尋" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-05T07:21:57.000Z" title="12/5/2023, 3:21:57 PM">2023-12-05</time>發表</span><span class="level-item"><time dateTime="2023-12-07T08:51:33.010Z" title="12/7/2023, 4:51:33 PM">2023-12-07</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Program/">Program</a></span><span class="level-item">1 小時讀完 (大約10045個字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Laravel Passport 和 OAuth2</h1><div class="content"><p>Laravel Passport 提供了 Laravel 應用程式完整的 OAuth2 伺服器實作整合。Passport 是基於 League OAuth2 Server 套件建置。</p>
<blockquote>
<p>如果您還不知道何謂 OAuth2，在繼續之前，請先熟悉 OAuth2 的一般術語和功能。</p>
<p><a target="_blank" rel="noopener" href="https://oauth2.thephpleague.com/terminology/">參考資源</a></p>
</blockquote>
<span id="more"></span>

<h2 id="何謂-OAuth2"><a href="#何謂-OAuth2" class="headerlink" title="何謂 OAuth2"></a>何謂 OAuth2</h2><p>讓我們先從基本的驗證功能開始：</p>
<ol>
<li>用戶於客戶端輸入帳號密碼</li>
<li>客戶端送給伺服器驗證身份</li>
<li>驗證成功後通過 Session/Cookie 機制在 <strong>客戶端</strong> 儲存登入的狀態</li>
</ol>
<p>基本的驗證機制儘管依舊適用於很多情境，但因為</p>
<ul>
<li>缺乏擴展彈性（多台伺服器的 Session / Cookie 統一問題）</li>
<li>安全性的問題（密碼被盜沒有太多應對辦法）</li>
<li>維護成本（同組織的各項服務可能需要反覆實作一樣的功能）</li>
<li>用戶體驗（社交媒體的興起，簡化註冊流程，多設備訪問）</li>
<li>授權第三方應用</li>
</ul>
<p>種種因素尤其是授權第三方應用和擴展需求，因此 OAuth2 廣泛的受到採用。</p>
<p>OAuth2 是一個業界標準協議，處理有關授權的相關流程。</p>
<p>例如某網站服務可以使用 Facebook 登入；Facebook 授權這個某網站有限範圍內取得用戶在 Facebook 的相關資訊或可操作的行為。</p>
<p>用戶驗證是在 Facebook 完成，登入且用戶同意授權，第三方應用程式被授權取得存取權杖（Access Token），可以使用該存取權杖從 Facebook 取得需要的資源。</p>
<p>總結來說就是你授權第三方可以去 Facebook 取得你的資料。</p>
<ol>
<li>在第三方應用點擊 “使用 Facebook 登入”</li>
<li>跳轉至 Facebook 輸入帳密登入</li>
<li>確認授權第三方範圍（Scope）即第三方要求的權限</li>
<li>同意的話，瀏覽器導回第三方，拒絕的話停止在此步驟</li>
<li>第三方取得授權可以向 Facebook 存取資料或執行你授權的操作</li>
</ol>
<h3 id="認識-OAuth2-的術語"><a href="#認識-OAuth2-的術語" class="headerlink" title="認識 OAuth2 的術語"></a>認識 OAuth2 的術語</h3><ul>
<li><code>Access Token</code> （存取權杖）: 這是一種特殊的權杖，用於讓應用程式能夠安全存取用戶在平台上保護的資料，如社群平台的個人資料。</li>
<li><code>Authorization Code</code> （授權碼）: 這是一種中介權杖。當用戶同意授權後，系統會先提供這個權杖給第三方應用程式，目的是提高交換存取權杖的安全性。這是因為直接回傳存取權杖可能存在安全風險，這個步驟增加了一層保護。</li>
<li><code>Authorization Server</code> （授權伺服器）: 這是管理用戶身份驗證和授權的伺服器。它負責處理授權請求，確認身份，發行存取權杖和授權碼給客戶端（Client）。</li>
<li><code>Client</code> （客戶端）: 指的是想要取得你資料的第三方應用程式，例如某個需要取得用戶 Facebook 資料的應用程式。</li>
<li><code>Grant</code> （授權）: 這是用戶授予第三方應用程式存取其資料的過程，如 Facebook 登入之後點擊同意按鈕的操作。</li>
<li><code>Resource Server</code> （資源伺服器）: 這是儲存用戶資料的伺服器，如社群媒體帖文和個人資料。它通過驗證存取權杖來檢查是否提供資料存取。</li>
<li><code>Resource Owner</code> （資源擁有者）: 指的是用戶本人，他們可以授權第三方應用程式存取他們在目標平台的帳戶。這種存取是有限制的，僅限於用戶授予的權限範圍內。</li>
<li><code>Scope</code> （授權範圍）: 這定義了第三方應用程式可以存取的資料類型和程度，例如僅讀取個人資料權限。</li>
<li><code>JWT</code> （JSON Web Token）: 這是一種格式為 JSON 的安全權杖，常用於用戶和伺服器之間的身份驗證和資訊傳輸。它依靠伺服器端的密鑰和簽名過程來保障安全，而客戶端則負責安全地儲存和使用這個權杖。</li>
<li><code>Redirect URI（Callback URL）</code>：授權伺服器驗證完身份，授權同意之後導向的網址或路徑。</li>
</ul>
<h2 id="OAuth2-支援-4-種授權模式"><a href="#OAuth2-支援-4-種授權模式" class="headerlink" title="OAuth2 支援 4 種授權模式"></a>OAuth2 支援 4 種授權模式</h2><h3 id="授權碼模式-Authorization-Code"><a href="#授權碼模式-Authorization-Code" class="headerlink" title="授權碼模式 Authorization Code"></a>授權碼模式 Authorization Code</h3><ol>
<li>用戶發起登入：例如用戶在應用點擊<strong>使用 Google 登入</strong></li>
<li>瀏覽器導向授權伺服器：過程中會先提供 Google 需要的資料如 Client Id, Redirect URI, Scope 等</li>
<li>用戶身份驗證：在授權伺服器上進行用戶身份驗證</li>
<li>同意授權：用戶被提示是否同意授予應用程式所需權限</li>
<li>返回授權碼：用戶同意後，瀏覽器導向回應用程式的 Redirect URI 網址，同時包含授權碼（Authorization Code）</li>
<li>交換存取權杖：應用程式使用授權碼向授權伺服器請求存取權杖（Access Token）</li>
<li>存取資源：應用程式使用存取權杖向資源伺服器請求資料</li>
</ol>
<figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Client ID</span>: 客戶端 ID</span><br><span class="line"><span class="attribute">Client Secret</span>: 客戶端密鑰</span><br><span class="line"><span class="attribute">Redirect URI</span>: 導向網址</span><br><span class="line"><span class="attribute">Scope</span>: 授權範圍(可選)</span><br><span class="line"><span class="attribute">State</span>: 防止 CSRF 攻擊隨機產生的值(推薦)</span><br></pre></td></tr></table></figure>

<h3 id="Authorization-Code-PKCE（Proof-Key-for-Code-Exchange）"><a href="#Authorization-Code-PKCE（Proof-Key-for-Code-Exchange）" class="headerlink" title="Authorization Code + PKCE（Proof Key for Code Exchange）"></a>Authorization Code + PKCE（Proof Key for Code Exchange）</h3><ol>
<li>產生程式碼驗證器和程式碼挑戰：</li>
</ol>
<ul>
<li>應用程式產生一個隨機的程式碼驗證器（Code Verifier）即一個隨機字串。</li>
<li>應用程式使用程式碼驗證器產生一個程式碼挑戰（Code Challenge），通常是對驗證器進行 SHA256 雜湊 Hash 並進行 Base64 編碼。</li>
</ul>
<ol start="2">
<li>用戶發起登入</li>
<li>發送授權請求：應用程式將用戶導向授權伺服器，並在請求中包含程式碼挑戰和其他必要資訊，如客戶端 ID、導向 URI 等。</li>
<li>用戶身份驗證和授權</li>
<li>返回授權碼</li>
<li>使用授權碼和程式碼驗證器取得存取權杖</li>
<li>存取資源</li>
</ol>
<p>主要在步驟 1 中加入產生程式碼驗證器和程式碼挑戰的過程，並在步驟 6 中使用這些值來獲取存取權杖。PKCE 通過確保只有發送授權請求的同一客戶端能夠使用授權碼來提高了安全性。</p>
<figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Client ID</span>: 客戶端 ID</span><br><span class="line"><span class="attribute">Redirect URI</span>: 導向網址</span><br><span class="line"><span class="attribute">Scope</span>: 授權範圍(可選)</span><br><span class="line"><span class="attribute">Code Verifier</span>: 隨機字串，用於產生 Code Challenge</span><br><span class="line"><span class="attribute">Code Challenge</span>: 用 Code Verifier 產生，發送給授權伺服器</span><br><span class="line"><span class="attribute">State</span>: : 防止 CSRF 攻擊隨機產生的值(推薦)</span><br></pre></td></tr></table></figure>

<h3 id="隱式模式-Implicit"><a href="#隱式模式-Implicit" class="headerlink" title="隱式模式 Implicit"></a>隱式模式 Implicit</h3><p>適用於客戶端應用程式（例如 JavaScript Single Page Application）。通常整個程式都在前端運行。在向 API 取得資料的過程，因為沒有後端，無法通過授權碼交換存取權杖。因而直接讓授權伺服器核發存取權杖（Access Token）。</p>
<ol>
<li>用戶發起登入：用戶在應用程式中點擊登入。</li>
<li>導向到授權伺服器：瀏覽器導向授權伺服器。</li>
<li>用戶身份驗證：用戶在授權伺服器上進行身份驗證。</li>
<li>授權確認：用戶被提示是否同意授予權限。</li>
<li>直接獲取存取權杖：用戶同意後，瀏覽器重定向回應用程式同時包含回傳存取權杖。</li>
<li>存取資源：應用程式使用存取權杖向資源伺服器請求資料。</li>
</ol>
<figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Client ID</span>: 客戶端 ID</span><br><span class="line"><span class="attribute">Redirect URI</span>: 導向網址</span><br><span class="line"><span class="attribute">Scope</span>: 授權範圍(可選)</span><br><span class="line"><span class="attribute">State</span>: : 防止 CSRF 攻擊隨機產生的值(推薦)</span><br></pre></td></tr></table></figure>

<h3 id="資源擁有者密碼憑證模式-Resource-Owner-Password-Credentials"><a href="#資源擁有者密碼憑證模式-Resource-Owner-Password-Credentials" class="headerlink" title="資源擁有者密碼憑證模式 Resource Owner Password Credentials"></a>資源擁有者密碼憑證模式 Resource Owner Password Credentials</h3><p>用戶將帳號密碼交給第三方應用程式，由應用程式直接向授權伺服器交換存取權杖。</p>
<ol>
<li>收集用戶憑證：用戶將自己的登入資訊（例如，用戶名和密碼）提供給應用程式</li>
<li>應用程式請求存取權杖：應用程式直接使用這些資訊向授權伺服器請求存取權杖</li>
<li>存取資源：獲得存取權杖後，應用程式即可使用此權杖向資源伺服器請求用戶資料。</li>
</ol>
<figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Client ID</span>: 客戶端 ID（可選，取決於伺服器端的要求）</span><br><span class="line"><span class="attribute">Client Secret</span>: 客戶端密鑰（可選，取決於伺服器端的要求）</span><br><span class="line"><span class="attribute">Username</span>: 用戶帳號</span><br><span class="line"><span class="attribute">Password</span>: 用戶密碼</span><br></pre></td></tr></table></figure>

<h3 id="客戶端憑證模式-Client-Credentials"><a href="#客戶端憑證模式-Client-Credentials" class="headerlink" title="客戶端憑證模式 Client Credentials"></a>客戶端憑證模式 Client Credentials</h3><p>通常是應用程式向授權伺服器取得存取權杖，讀取自己的資料而不是用戶的資料。</p>
<ol>
<li>應用程式認證：應用程式使用其自身的憑證（不涉及用戶）向授權伺服器請求存取權杖</li>
<li>存取資源：應用程式使用獲得的存取權杖向資源伺服器請求資料，通常是應用程式自己的資料而非用戶個人資料</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Client</span> ID: 客戶端 ID</span><br><span class="line"><span class="built_in">Client</span> Secret: 客戶端密鑰</span><br></pre></td></tr></table></figure>

<h2 id="Passport-或-Sanctum"><a href="#Passport-或-Sanctum" class="headerlink" title="Passport 或 Sanctum?"></a>Passport 或 Sanctum?</h2><p>在開始之前您可能需要確認您的應用程式需要使用 Passport 還是 Sanctum。如果您的應用程式需要支援 OAuth2 那麼你該使用 Passport 。如果你只是需要支援存取第三方平台的資料如 Facebook 登入或者簡單的提供 API Token 讓應用程式可以存取 API，那麼你應該使用 Sanctum。</p>
<p>Scanctum 不支援 OAuth2 但是提供簡單的 API 驗證。</p>
<h2 id="安裝-Passport"><a href="#安裝-Passport" class="headerlink" title="安裝 Passport"></a>安裝 Passport</h2><p>通過 Composer 安裝</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ compoer require laravel/passport</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 Laravel 中，Service Provider 是一種特殊的 class 類別，功能為註冊和設定服務到 Laravel 的服務容器中。Service Provider 會在應用程式啟動時被載入，並註冊應用程式所需的服務。</p>
</blockquote>
<p>Passport 的 Service Provider 會提供相關的資料庫遷移檔案（Migration），安裝之後，需要執行 <code>php artisan migrate</code>，建立 OAuth2 的相關資料表。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan migrate</span><br></pre></td></tr></table></figure>

<p>接著，需要執行 <code>php artisan passport:install</code> 指令<strong>建立加密金鑰(產生 Access Token 時使用)<strong>。此外，這個指令還會建立</strong>個人存取</strong>和<strong>密碼存取</strong>的 Client，因應不同的資料結構與流程產生存取權杖。</p>
<p>⚠️ 注意：在執行之前，如果您的 <code>Client</code> 資料模型希望使用 UUID 作為主鍵，執行 <code>passport:install</code> 安裝指令時請使用 <code>--uuids</code> 參數。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan passport:install</span><br><span class="line"></span><br><span class="line">$ php artisan passport:install --uuids</span><br></pre></td></tr></table></figure>

<p>執行 <code>passport:install</code> 之後，在 <code>App\Models\User</code> 加入 <code>Laravel\Passport\HasApiTokens</code> trait。這個 trait 會提供資料模型一些輔助函式，讓你可以檢查已登入用戶的存取權杖 Access Token 和授權範圍 Scope。如果你的資料模型已經使用 <code>Laravel\Sanctum\HasApiTokens</code> trait，請記得移除替換。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Factories</span>\<span class="title">HasFactory</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="title">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Notifications</span>\<span class="title">Notifiable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">HasApiTokens</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HasApiTokens</span>, <span class="title">HasFactory</span>, <span class="title">Notifiable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最後，在 <code>config/auth.php</code> 設定檔，設定 <code>api</code> 驗證機制還有 <code>driver</code> 設定成 <code>passport</code>。這個步驟會讓應用程式使用 Passport 的 <code>TokenGuard</code> 來驗證。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;guards&#x27;</span> =&gt; [</span><br><span class="line">  <span class="string">&#x27;web&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;session&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;provider&#x27;</span> =&gt; <span class="string">&#x27;users&#x27;</span></span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="string">&#x27;api&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;passport&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;provider&#x27;</span> =&gt; <span class="string">&#x27;users&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>您可能已經執行 <code>passport:install --uuids</code> 。這個參數會讓 Passport 使用 UUID 作為主鍵而不是自動遞增的數字。選擇使用 UUID 作為主鍵時，需要進行一些額外的設定步驟，包括修改或停用預設的資料庫遷移設定，需要重新執行 <code>php artisan migrate:fresh</code>。</p>
<blockquote>
<p>指令會提供提示訊息，另外如果 User 和其他資料模型也要使用 UUID 須調整相關資料庫遷移檔。<a target="_blank" rel="noopener" href="https://laraveldaily.com/post/laravel-users-table-change-primary-key-id-to-uuid">參考教學修改 Migrations</a></p>
<p>⚠️ <code>--uuids</code> 參數會解開資料庫遷移檔案到 <code>database/migraions/</code>，即使你沒有執行 <code>php artisan vendor:publish --tag=passport-migrations</code></p>
</blockquote>
<h3 id="部署-Passport"><a href="#部署-Passport" class="headerlink" title="部署 Passport"></a>部署 Passport</h3><blockquote>
<p>Passport 提供了 3 種讀取金鑰的設定方式：預設路徑，變更路徑，使用 env。</p>
</blockquote>
<p>第一次部署 Passport 的應用程式到伺服器時，你可能需要執行 <code>php artisan passport:keys</code> 指令來產生加密所需的金鑰，這把金鑰用於產生存取權杖（Access Token），檔案預設在 <code>storage/</code> 目錄下。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan passport:keys</span><br></pre></td></tr></table></figure>

<p>Passport 載入金鑰的路徑可以使用 <code>Passport::loadKeysFrom</code> 方法變更。一般來說這個方法在 <code>App\Providers\AuthServiceProvider</code> 類別的 <code>boot</code> 方法中調用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::loadKeysFrom(<span class="keyword">__DIR__</span>.<span class="string">&#x27;/../secrets/oauth&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>又或者，你可以使用 <code>php artisan vendor:publish</code> 指令解開 Passport 的設定檔</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan vendor:publish --tag=passport-config</span><br></pre></td></tr></table></figure>

<p>匯出設定檔到 <code>config/passport.php</code> 使用環境變數來設定加密金鑰。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PASSPORT_PRIVATE_KEY=&quot;-----BEGIN</span> <span class="string">RSA</span> <span class="string">PRIVATE</span> <span class="string">KEY-----</span></span><br><span class="line"><span class="string">&lt;private</span> <span class="string">key</span> <span class="string">here&gt;</span></span><br><span class="line"><span class="string">-----END</span> <span class="string">RSA</span> <span class="string">PRIVATE</span> <span class="string">KEY-----&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">PASSPORT_PUBLIC_KEY=&quot;-----BEGIN</span> <span class="string">PUBLIC</span> <span class="string">KEY-----</span></span><br><span class="line"><span class="string">&lt;public</span> <span class="string">key</span> <span class="string">here&gt;</span></span><br><span class="line"><span class="string">-----END</span> <span class="string">PUBLIC</span> <span class="string">KEY-----&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="自訂資料庫遷移檔"><a href="#自訂資料庫遷移檔" class="headerlink" title="自訂資料庫遷移檔"></a>自訂資料庫遷移檔</h3><p>如果你不想使用 Passport 預設的資料庫遷移檔，你可以在 <code>App\Providers\AppServiceProvider</code> 的 <code>register</code> 方法中使用 <code>Passport::ignoreMigrations</code> 方法。又或者你可以使用 <code>php artisan vendor:publish</code> 指令解開 Passport 的遷移檔案到 <code>database/migrations</code> 目錄下進行調整。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan vendor:publish --tag=passport-migrations</span><br></pre></td></tr></table></figure>

<h2 id="相關設定"><a href="#相關設定" class="headerlink" title="相關設定"></a>相關設定</h2><h3 id="Client-Secret-雜湊"><a href="#Client-Secret-雜湊" class="headerlink" title="Client Secret 雜湊"></a>Client Secret 雜湊</h3><p>如果你希望提高儲存在資料庫的 Client Secret 安全性，如同密碼進行不可逆的雜湊 Hash ，你可以在 <code>App\Providers\AuthServiceProvider</code> 的 <code>boot</code> 加入 <code>Passport::hashClientSecrets</code> 方法。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Passport</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::hashClientSecrets();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一旦啟用，所有的 Client Secret 將只會在用戶建立時顯示一次，因為原始資料被加密不可逆，因此一旦遺失則無法恢復和查詢。</p>
<h3 id="有效時間"><a href="#有效時間" class="headerlink" title="有效時間"></a>有效時間</h3><p>預設 Passport 發行的存取權杖 Access Token 屬於長效期，一年後才會到期。如果你希望調整效期，你可以使用 <code>tokensExpireIn</code>，<code>refreshTokenExpireIn</code> ，<code>personalAccessTokensExpireIn</code> 方法。</p>
<p>上面這些方法在 <code>App\Providers\AuthServiceProvider</code> 的 <code>boot</code> 方法中調用。</p>
<blockquote>
<p>Access Token：用戶授權後用於取得資源的權杖</p>
<p>Refresh Token：存取權杖（Access Token）過期後，應用不需重新登入可刷新取得新的存取權杖</p>
<p>Person Access Token：開發階段或特定情境直接取得的存取權杖，無需標準 OAuth 授權流程</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::tokenExpireIn(now()-&gt;addDays(<span class="number">15</span>));</span><br><span class="line">  Passport::refreshTokensExpireIn(now()-&gt;addDays(<span class="number">30</span>));</span><br><span class="line">  Passport::personalAccessTokensExpireIn(now()-&gt;addMonths(<span class="number">6</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>⚠️ Passport 資料表的 <code>expires_at</code> 是唯讀的，且僅用於顯示用途。發行權杖或憑證的時候 Passport 會把效期資訊儲存在簽署和加密的權杖/憑證中，也就是不依賴資料表的資料，如果你需要讓憑證失效需要撤銷，變更欄位資料是無效的。</strong></p>
<h3 id="覆寫預設資料模型"><a href="#覆寫預設資料模型" class="headerlink" title="覆寫預設資料模型"></a>覆寫預設資料模型</h3><p>你可以繼承 Passport 內部的資料模型進而自訂模型。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Client</span> <span class="title">as</span> <span class="title">PassportClient</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> <span class="keyword">extends</span> <span class="title">PassportClient</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在定義自己的模型之後，可以通過 <code>Laravel\Passport\Passport</code> 類別設定 Passport 使用自訂的模型。</p>
<p>一般來說你會在 <code>App\Providers\AuthServiceProvider</code> 的 <code>boot</code> 設定</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Passport</span>\<span class="title">AuthCode</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Passport</span>\<span class="title">Client</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Passport</span>\<span class="title">PersonalAccessClient</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Passport</span>\<span class="title">RefreshToken</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Passport</span>\<span class="title">Token</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::useTokenModel(Token::class);</span><br><span class="line">  Passport::useRefreshTokenModel(RefreshToken::class);</span><br><span class="line">  Passport::useAuthCodeModel(AuthCode::class);</span><br><span class="line">  Passport::useClientModel(Client::class);</span><br><span class="line">  Passport::usePersonalAccessClientModel(PersonalAccessClient::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="覆寫路由"><a href="#覆寫路由" class="headerlink" title="覆寫路由"></a>覆寫路由</h3><p>如果需要自訂路由，則需要在 <code>AppServiceProvider</code> 使用 <code>Passport::ignoreRoutes</code> 略過 Passport 預先註冊路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Passport</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::ignoreRoutes();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然後，可以複製 <a target="_blank" rel="noopener" href="https://github.com/laravel/passport/blob/11.x/routes/web.php">Passport 預設的路由</a> 到 <code>routes/web.php</code> 並修改調整。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::group([</span><br><span class="line">    <span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;passport.&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span> =&gt; config(<span class="string">&#x27;passport.path&#x27;</span>, <span class="string">&#x27;oauth&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;namespace&#x27;</span> =&gt; <span class="string">&#x27;\Laravel\Passport\Http\Controllers&#x27;</span>,</span><br><span class="line">], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Passport routes...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="發行存取權杖-Access-Token"><a href="#發行存取權杖-Access-Token" class="headerlink" title="發行存取權杖 Access Token"></a>發行存取權杖 Access Token</h2><p>通過授權碼 Authorization Code 的方式使用 OAuth2 是多數開發者熟悉的流程。授權碼模式下，第三方應用先將用戶導向我們的授權伺服器讓用戶進行授權或拒絕請求發行存取權杖。</p>
<h3 id="客戶端管理-Client"><a href="#客戶端管理-Client" class="headerlink" title="客戶端管理 Client"></a>客戶端管理 Client</h3><p>首先，開發者建立的第三方應用程式在和我們 Passport 的 API 溝通之前需要註冊一個 <strong>客戶端 Client</strong> 或者其他平台叫 App 。一般來說就是提供應用程式的名稱，和同意授權後導向回去的 URL。</p>
<h4 id="使用-passport-client-指令"><a href="#使用-passport-client-指令" class="headerlink" title="使用 passport:client 指令"></a>使用 <code>passport:client</code> 指令</h4><p>最簡單建立客戶端的方式就是使用 <code>php artisan passport:client</code> 指令。這個指令可以協助建立測試 OAuth2 的 Client。當我們執行這個指令時 Passport 會詢問我們一些問題，然後建立 Client 並提供 Client ID 和 Client Secret。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan passport:client</span><br></pre></td></tr></table></figure>

<h3 id="導向-URLs"><a href="#導向-URLs" class="headerlink" title="導向 URLs"></a>導向 URLs</h3><p>若你需要多個導向網址可以使用 <code>,</code> 逗號分隔。這個設定主要是起到檢查的作用。第三方應用發送授權請求的時候會提供一個 <code>redirect_uri</code> 然後伺服器會檢查是否和該 Client 設定的其中一個是否匹配（<code>redirect</code> 參數）。檢查符合設定的 URLs 才會進行導向。</p>
<h3 id="JSON-API"><a href="#JSON-API" class="headerlink" title="JSON API"></a>JSON API</h3><p>由於第三方應用程式的用戶無法直接使用 <code>php artisan client</code> 指令，因此 Passport 提供了 JSON API 用於建立 Client。省去我們自行建立 Controller 開發新增，更新，刪除 Client 的時間。</p>
<p>不過我們還是需要自己實作前端通過這些 JSON API 提供用戶管理他們的 Client 的介面。下面我們將過一遍這些 API。為了方便後續會使用 Axios 來展示發送請求。</p>
<p>JSON API 預設使用 <code>web</code> 和 <code>auth</code> middleware 驗證；因此我們只能在我們的應用程式上呼叫，外部是不能直接 call 這些 API 的。</p>
<h4 id="GET-oauth-clients"><a href="#GET-oauth-clients" class="headerlink" title="GET /oauth/clients"></a>GET /oauth/clients</h4><p>這個路由會回傳通過驗證的用戶全部 Client 列表。讓用戶可以進一步編輯或刪除 Client。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&#x27;/oauth/clients&#x27;</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(response.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="POST-oauth-clients"><a href="#POST-oauth-clients" class="headerlink" title="POST /oauth/clients"></a>POST /oauth/clients</h4><p>此路由用來新增 Client 。它需要兩個參數 <code>name</code> 和 <code>redirect</code> 。當 Client 建立後會發行 Client ID 和 Client Secret 。這兩個資料在第三方應用程式用於後續請求 Access Token</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Client Name&#x27;</span>,</span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&#x27;https://example.com/auth/provider/callback&#x27;</span>, <span class="comment">// 遵循 Socialite 慣例</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">axios</span><br><span class="line">  .post(<span class="string">&#x27;/oauth/clients&#x27;</span>, data)</span><br><span class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response.data);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// List errors</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="PUT-oauth-clients-client-id"><a href="#PUT-oauth-clients-client-id" class="headerlink" title="PUT /oauth/clients/{client-id}"></a>PUT /oauth/clients/{client-id}</h4><p>此路由用於更新 Client。需要提供兩個參數 <code>name</code> 和 <code>redirect</code> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;New Client Name&#x27;</span>,</span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&#x27;http://example.com/auth/provider/callback&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">axios</span><br><span class="line">  .put(<span class="string">`/oauth/clients/<span class="subst">$&#123;clientId&#125;</span>`</span>, data)</span><br><span class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response.data);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// List errors</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="DELETE-oauth-clients-client-id"><a href="#DELETE-oauth-clients-client-id" class="headerlink" title="DELETE /oauth/clients/{client-id}"></a>DELETE /oauth/clients/{client-id}</h4><p>刪除 Client：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">axios.delete(<span class="string">`/oauth/clients/<span class="subst">$&#123;clientId&#125;</span>`</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="請求存取權杖-Access-Token"><a href="#請求存取權杖-Access-Token" class="headerlink" title="請求存取權杖 Access Token"></a>請求存取權杖 Access Token</h2><h3 id="導向驗證"><a href="#導向驗證" class="headerlink" title="導向驗證"></a>導向驗證</h3><p>一旦 Client 建立完成，開發者就可以使用 Client ID 和 Client Secret 跟我們的服務請求 Authorization Code 和 Access Token。首先，這個第三方應用要導向我們的 <code>/oauth/authorize</code> 範例如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Str</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/redirect&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$request</span>-&gt;session()-&gt;put(<span class="string">&#x27;state&#x27;</span>, <span class="variable">$state</span> = Str::random(<span class="number">40</span>));</span><br><span class="line"></span><br><span class="line">  <span class="variable">$query</span> = http_build_query([</span><br><span class="line">    <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;redirect_uri&#x27;</span> =&gt; <span class="string">&#x27;https://example.com/auth/provider/callback&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;response_type&#x27;</span> =&gt; <span class="string">&#x27;code&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;scope&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;state&#x27;</span> =&gt; <span class="variable">$state</span>,</span><br><span class="line">    <span class="comment">// &#x27;prompt&#x27; =&gt; &#x27;&#x27;, // &quot;none&quot;, &quot;consent&quot;, &quot;login&quot;</span></span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> redirect(<span class="string">&#x27;https://passport-app.test/oauth/authorize?&#x27;</span>.<span class="variable">$query</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>prompt</code> 參數可以用來設定 Passport 驗證流程的行為。</p>
<ul>
<li><code>none</code>：當 <code>prompt</code> 為 <code>none</code> 時如果用戶沒有登入使用 Passport 的應用程式則拋出錯誤</li>
<li><code>consent</code>：即使之前已經被授權了，Passport 還是會宣示授權確認頁面</li>
<li><code>login</code>：即使用戶已經登入了 Passport 還是會提示用戶重新登入</li>
<li>沒設定：如果用戶之前還沒授權則提示用戶進行授權</li>
</ul>
<h3 id="同意請求授權"><a href="#同意請求授權" class="headerlink" title="同意請求授權"></a>同意請求授權</h3><p>當收到驗證請求，Passport 會自動根據 <code>prompt</code> 的設定回應並顯示同意或拒絕的頁面。如果同意請求，那麼就會導向一開始請求參數中的 <code>redirect_uri</code> 。這個 <code>redirect_uri</code> 必須符合 Client 設定的 <code>redirect</code>。</p>
<p>如果你希望自訂驗證同意的畫面，你可以使用 <code>php artisan vendor:publish</code> 解開 Passport 的視圖，檔案會在 <code>resources/views/vendor/passport</code>目錄</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan vendor:publish --tag=passport-views</span><br></pre></td></tr></table></figure>

<p>有時候你希望跳過驗證提示，例如你自己的另一個應用而非其他人的應用程式。你可能不想要用戶每次都看到確認授權的頁面，直接發放存取權杖 Access Token。此時你可以擴展 <code>Client</code> 資料模型使用 <code>skipsAuthorization</code>。假如 <code>skipsAuthorization</code> 回傳 <code>true</code> 那麼 Client 會直接同意授權並導向 <code>redirect_uri</code> ，除非有設定 <code>prompt</code>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Passport</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Client</span> <span class="title">as</span> <span class="title">BaseClient</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> <span class="keyword">extends</span> <span class="title">BaseClient</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skipsAuthorization</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用授權碼-Authorization-Code-交換存取權杖-Access-Token"><a href="#使用授權碼-Authorization-Code-交換存取權杖-Access-Token" class="headerlink" title="使用授權碼 Authorization Code 交換存取權杖 Access Token"></a>使用授權碼 Authorization Code 交換存取權杖 Access Token</h3><p>若用戶同意授權請求，將會導向提出請求的應用程式。該應用程式首先須驗證 <code>state</code> 參數和發出請求前設定的是否一致然後發送一個 <code>POST</code> 請求到我們的應用程式來取得存取權杖 Access Token。這個請求須包含授權碼 Authorization Code。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Http</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/callback&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$state</span> = <span class="variable">$request</span>-&gt;session()-&gt;pull(<span class="string">&#x27;state&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  throw_unless(</span><br><span class="line">  	strlen(<span class="variable">$state</span>) &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$state</span> === <span class="variable">$request</span>-&gt;state,</span><br><span class="line">    <span class="built_in">InvalidArgumentException</span>::class,</span><br><span class="line">    <span class="string">&#x27;Invalid state value.&#x27;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="variable">$response</span> = Http::asForm()-&gt;post(<span class="string">&#x27;http://passport-app.text/oauth/token&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;grant_type&#x27;</span> =&gt; <span class="string">&#x27;authorization_code&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;client_secret&#x27;</span> =&gt; <span class="string">&#x27;client-secret&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;redirect_uri&#x27;</span> =&gt; <span class="string">&#x27;http://third-party-app.com/callback&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;code&#x27;</span> =&gt; <span class="variable">$request</span>-&gt;code,</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$response</span>-&gt;json();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>/oauth/token</code> 路由會回傳一個 JSON 物件包含 <code>access_token</code>，<code>refresh_token</code> 和 <code>expires_in</code>。<code>expires_in</code> 屬性表示存取權杖 Access Token 的過期秒數。</p>
<h3 id="JSON-API-1"><a href="#JSON-API-1" class="headerlink" title="JSON API"></a>JSON API</h3><p>Passport 也提供 JSON API 管理存取權杖。我們一樣需要在前端使用對應的 API 提供用戶管理存取權杖。一樣為了方便下面使用 Axios 展示發送請求，這些 API 一樣也是使用 <code>web</code> 和 <code>auth</code> middleware 驗證，因此一樣只能在自己的應用呼叫，不支援外部請求。</p>
<h4 id="GET-oauth-tokens"><a href="#GET-oauth-tokens" class="headerlink" title="GET /oauth/tokens"></a>GET /oauth/tokens</h4><p>這個路由回傳存取權杖列表。主要的用途就是讓用戶可以選取撤銷。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&#x27;/oauth/tokens&#x27;</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(response.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="DELETE-oauth-tokens-token-id"><a href="#DELETE-oauth-tokens-token-id" class="headerlink" title="DELETE /oauth/tokens/{token-id}"></a>DELETE /oauth/tokens/{token-id}</h4><p>此路由可用來撤銷通過驗證的 Access Token 和其相關的 Refresh Token</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axios.delete(<span class="string">`/oauth/tokens/<span class="subst">$&#123;tokenId&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Refresh-Token-更新存取權杖"><a href="#Refresh-Token-更新存取權杖" class="headerlink" title="Refresh Token 更新存取權杖"></a>Refresh Token 更新存取權杖</h3><p>若你發行的 Access Token 有效時間很短，用戶端會需要使用 Refresh Token 更新 Access Token</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Http</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = Http::asForm()-&gt;post(<span class="string">&#x27;http://passport-app.test/oauth/token&#x27;</span>, [</span><br><span class="line">  <span class="string">&#x27;grant_type&#x27;</span> =&gt; <span class="string">&#x27;refresh_token&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;refresh_token&#x27;</span> =&gt; <span class="string">&#x27;the-refresh-token&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;client_secret&#x27;</span> =&gt; <span class="string">&#x27;client-secret&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;scope&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$response</span>-&gt;json();</span><br></pre></td></tr></table></figure>

<p><code>/oauth/token</code> 路由會回傳 JSON 物件包含 <code>access_token</code> <code>refresh_token</code> 和 <code>expires_in</code></p>
<h3 id="撤銷金鑰"><a href="#撤銷金鑰" class="headerlink" title="撤銷金鑰"></a>撤銷金鑰</h3><p>你可以使用<code>Laravel\Passport\TokenRepository</code> 的 <code>revokeAccessToken</code> 方法撤銷權杖。<code>revokeRefreshTokensByAccessTokenId</code> 可以撤銷 Refresh Token。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">TokenRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">RefreshTokenRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$tokenRepository</span> = app(TokenRepository::class);</span><br><span class="line"><span class="variable">$refreshTokenRepository</span> = app(RefreshTokenRepository::class);</span><br><span class="line"></span><br><span class="line"><span class="variable">$tokenRepository</span>-&gt;revokeAccessToken(<span class="variable">$tokenId</span>);</span><br><span class="line"><span class="variable">$refreshTokenRepository</span>-&gt;revokeRefreshTokensByAccessTokenId(<span class="variable">$tokenId</span>);</span><br></pre></td></tr></table></figure>

<h3 id="清除-Tokens"><a href="#清除-Tokens" class="headerlink" title="清除 Tokens"></a>清除 Tokens</h3><p>當權杖被撤銷或過期，你可能希望從資料庫移除它們。Passport 提供了 <code>php artisan passport:purge</code> 指令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan passport:purge</span><br><span class="line"></span><br><span class="line"><span class="comment"># 僅清除過期超過6小時的 token</span></span><br><span class="line">$ php artisan passport:purge --hours=6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 僅清除撤銷的 Token 和 Authorization code</span></span><br><span class="line">$ php artisan passport:purge --revoked</span><br><span class="line"></span><br><span class="line"><span class="comment"># 僅清除過期的 Token 和 Authorization code</span></span><br><span class="line">$ php artisan passport:purge --expired</span><br></pre></td></tr></table></figure>

<p>你也可以在 <code>App\Console\Kernel</code> 設定排程自動清除。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">schedule</span>(<span class="params">Schedule <span class="variable">$schedule</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="variable">$schedule</span>-&gt;command(<span class="string">&#x27;passport:purge&#x27;</span>)-&gt;hourly();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="PKCE-與-Authorization-Code-授權"><a href="#PKCE-與-Authorization-Code-授權" class="headerlink" title="PKCE 與 Authorization Code 授權"></a>PKCE 與 Authorization Code 授權</h2><blockquote>
<p>PKCE （Proof Key for Code Exchange）是一種 OAuth 授權流程額外增強安全性的技術。</p>
<ol>
<li>應用生成一個隨機字串 - Code Verifier</li>
<li>應用計算該字串的 SHA256 + Base64 產生 Code Challenge 發給授權伺服器</li>
<li>用戶授權，伺服器將授權碼傳回應用</li>
<li>應用使用授權碼和 Code Verifier 請求 Access Token</li>
<li>伺服器將 Code Verifier 轉換後檢查和 Code Challenge 是否匹配，然後發放 Access Token</li>
</ol>
</blockquote>
<p>Authorization Code 授權搭配 PKCE 流程，PKCE 主要對 SPA 或行動 app 強化驗證機制和存取 API 安全性。這種授權應被用於當您無法保證客戶端密鑰能被保密儲存，或為了減輕授權碼被攻擊者攔截的風險時，應該使用這種授權方式。在使用 Authorization Code 交換 Access Token 時，Code Verifier 和 Code Challenge 的組合將取代 Client Secret 的角色，並更進一步確認發出請求方是否一致。</p>
<h3 id="建立-Client"><a href="#建立-Client" class="headerlink" title="建立 Client"></a>建立 Client</h3><p>在你的應用程式可以通過 Authorization Code 授權搭配 PKCE 發行 Token 之前，你需要建立啟用 PKCE 的 Client</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan passport:client --public</span><br></pre></td></tr></table></figure>

<blockquote>
<p>主要的差異就是這個 Client 預設不會建立 Secret 因為你將使用 PKCE Code Verifier 和 Code Challenge 的組合將取代 Client Secret</p>
</blockquote>
<h4 id="Code-Verifier-amp-Code-Challenge"><a href="#Code-Verifier-amp-Code-Challenge" class="headerlink" title="Code Verifier &amp; Code Challenge"></a>Code Verifier &amp; Code Challenge</h4><p>由於這種授權方式不會提供 Client Secret，開發者需要自己產生 Code Verifier 和 Code Challenge 來取得 Access Token。</p>
<p>Code Verifier 應該是隨機產生長度 43 - 128 包含字母，數字和 <code>-</code>, <code>.</code> <code>_</code> <code>~</code> 字元的字串符合 RFC 7636 規範。</p>
<p>Code Challenge 應該為 Base64 編碼的字串並使用合法網址和檔名的字元。結尾時 <code>=</code> 字元且應該移除換行等其他字元。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$encoded</span> = base64_encode(hash(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$codeVerifier</span>, <span class="literal">true</span>));</span><br><span class="line"><span class="variable">$codeChallenge</span> = strtr(ttrim(<span class="variable">$encoded</span>, <span class="string">&#x27;=&#x27;</span>), <span class="string">&#x27;+/&#x27;</span>, <span class="string">&#x27;-_&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="導向驗證-1"><a href="#導向驗證-1" class="headerlink" title="導向驗證"></a>導向驗證</h4><p>一旦 Client 建立，就可以使用 Client ID 和 Code Verifier 以及 Code Challenge 去請求 Authorization Code 和 Access Token 。首先第三方應用需要導向 <code>/oauth/authorize</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Str</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/redirect&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$request</span>-&gt;session()-&gt;put(<span class="string">&#x27;state&#x27;</span>, <span class="variable">$state</span> = Str::random(<span class="number">40</span>));</span><br><span class="line"></span><br><span class="line">  <span class="variable">$request</span>-&gt;session()-&gt;put(<span class="string">&#x27;codeVerifier&#x27;</span>, <span class="variable">$codeVerifier</span> = Str::random(<span class="number">128</span>));</span><br><span class="line"></span><br><span class="line">  <span class="variable">$codeChallenge</span> = strtr(rtrim(</span><br><span class="line">  	base64_encode(hash(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$codeVerifier</span>, <span class="literal">true</span>))</span><br><span class="line">    , <span class="string">&#x27;=&#x27;</span></span><br><span class="line">  ), <span class="string">&#x27;+/&#x27;</span>, <span class="string">&#x27;-_&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$query</span> = http_build_query([</span><br><span class="line">    <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;redirect_uri&#x27;</span> =&gt; <span class="string">&#x27;https://third-party-app.com/callback&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;response_type&#x27;</span> =&gt; <span class="string">&#x27;code&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;scope&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;code_challenge&#x27;</span> =&gt; <span class="variable">$codeChallenge</span>,</span><br><span class="line">    <span class="string">&#x27;code_challenge_method&#x27;</span> =&gt; <span class="string">&#x27;sha256&#x27;</span>,</span><br><span class="line">    <span class="comment">// &#x27;prompt&#x27; =&gt; &#x27;&#x27;, // &quot;none&quot;, &quot;consent&quot;, or &quot;login&quot;</span></span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> redirect(<span class="string">&#x27;http://passport-app.test/oauth/authorize?&#x27;</span>.<span class="variable">$query</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Authorization-Code-交換-Access-Token"><a href="#Authorization-Code-交換-Access-Token" class="headerlink" title="Authorization Code 交換 Access Token"></a>Authorization Code 交換 Access Token</h4><p>如果用戶同意授權，將會導回第三方應用。該應用驗證 <code>state</code> 是否與導向前匹配。</p>
<p>如果匹配，第三方應用會在 <code>POST</code> 請求 Access Token。該請求包含 Authorization Code 以及原來產生的 Code Verifier。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Http</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/callback&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$state</span> = <span class="variable">$request</span>-&gt;session()-&gt;pull(<span class="string">&#x27;state&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$codeVerifier</span> = <span class="variable">$request</span>-&gt;session()-&gt;pull(<span class="string">&#x27;code_verifier&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    throw_unless(</span><br><span class="line">        strlen(<span class="variable">$state</span>) &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$state</span> === <span class="variable">$request</span>-&gt;state,</span><br><span class="line">        <span class="built_in">InvalidArgumentException</span>::class</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="variable">$response</span> = Http::asForm()-&gt;post(<span class="string">&#x27;http://passport-app.test/oauth/token&#x27;</span>, [</span><br><span class="line">        <span class="string">&#x27;grant_type&#x27;</span> =&gt; <span class="string">&#x27;authorization_code&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;redirect_uri&#x27;</span> =&gt; <span class="string">&#x27;http://third-party-app.com/callback&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;code_verifier&#x27;</span> =&gt; <span class="variable">$codeVerifier</span>,</span><br><span class="line">        <span class="string">&#x27;code&#x27;</span> =&gt; <span class="variable">$request</span>-&gt;code,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$response</span>-&gt;json();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="密碼授權"><a href="#密碼授權" class="headerlink" title="密碼授權"></a>密碼授權</h2><p>OAuth2 密碼授權允許你的其他應用程式例如同樣是自己開發的行動 app 使用帳號和密碼取得 Access Token。這個模式讓你的 app 可以快速取得 Access Token 而不需要用戶執行完整的 OAuth2 流程</p>
<h3 id="建立密碼授權-Client"><a href="#建立密碼授權-Client" class="headerlink" title="建立密碼授權 Client"></a>建立密碼授權 Client</h3><p>在我們的應用程式通過密碼授權發行 Token 之前，我們需要建立一個密碼授權的 Client。使用 <code>php artisan passport:client --password</code> 可以建立。預設 <code>passport:install</code> 會兩種類型各自建立一組 Client。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan passport:client --password</span><br></pre></td></tr></table></figure>

<h3 id="請求-Token"><a href="#請求-Token" class="headerlink" title="請求 Token"></a>請求 Token</h3><p>一旦建立密碼授權 Client，就可以使用帳號和密碼 <code>POST /oauth/token</code> 請求 Access Token。注意這個路由 Passport 已經註冊了不需要重新定義。如果請求成功會自己收到 <code>access_token</code> 和 <code>refresh_token</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Http</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$reponse</span> = Http::asForm()-&gt;post(<span class="string">&#x27;http://passport-app.test/oauth/token&#x27;</span>, [</span><br><span class="line">  <span class="string">&#x27;grant_type&#x27;</span> =&gt; <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;client_secret&#x27;</span> =&gt; <span class="string">&#x27;client-secret&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;taylor@laravel.com&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;my-password&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;scope&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$response</span>-&gt;json();</span><br></pre></td></tr></table></figure>

<h3 id="授權範圍"><a href="#授權範圍" class="headerlink" title="授權範圍"></a>授權範圍</h3><p>當使用密碼授權或客戶端憑證授權，你可能希望驗證的 Token 授權全部範圍的資源。你可以使用 <code>&#39;*&#39;</code> 星號。如果要求的是 <code>&#39;*&#39;</code> 授權範圍（Scope）接著 Token 物件實例的 <code>can</code> 方法會永遠回傳 <code>true</code>。這個範圍只能使用在 <code>password</code> 或 <code>client_credentials</code> 授權。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Http</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = Http::asForm()-&gt;post(<span class="string">&#x27;http://passport-app.test/oauth/token&#x27;</span>, [</span><br><span class="line">  <span class="string">&#x27;grant_type&#x27;</span> =&gt; <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;client_secret&#x27;</span> =&gt; <span class="string">&#x27;client-secret&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;taylor@laravel.com&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;my-password&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;scope&#x27;</span> =&gt; <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="自訂-User-Provider"><a href="#自訂-User-Provider" class="headerlink" title="自訂 User Provider"></a>自訂 User Provider</h3><p>如果我們的應用程式使用多個驗證機制（User Provider），你可以在建立 Client 的時候通過 <code>--provider</code> 指定密碼授權的 Provider。Provider 的名稱應匹配有效且定義在 <code>config/auth.php</code> 設定。</p>
<p>換句話說 User Provider 就是對應登入後那個代表用戶的資料模型，具體實作如下：</p>
<ol>
<li><p>在 <code>config/auth.php</code> 設定假設名為 <code>employees</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;providers&#x27;</span> =&gt; [</span><br><span class="line">  <span class="string">&#x27;users&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;eloquent&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;model&#x27;</span> =&gt; App\Models\User::class,</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="string">&#x27;employees&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;eloquent&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;model&#x27;</span> =&gt; App\Models\Employee::class,</span><br><span class="line">  ],</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
<li><p>使用 <code>php artisan passport:client --password --provider=employees</code></p>
</li>
<li><p>最後搭配路由 <code>Route::middleware(&#39;auth:employees&#39;)</code></p>
</li>
</ol>
<h3 id="自訂用戶帳號欄位"><a href="#自訂用戶帳號欄位" class="headerlink" title="自訂用戶帳號欄位"></a>自訂用戶帳號欄位</h3><p>當使用密碼授權，Passport 會使用 <code>email</code> 欄位來作為驗證的帳號。但你可能希望自訂，此時可以使用 <code>findForPassport</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="title">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Notifications</span>\<span class="title">Notifiable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">HasApiTokens</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">use</span> <span class="title">HasApiTokens</span>, <span class="title">Notifiable</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">findForPassport</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$username</span></span>): <span class="title">User</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;where(<span class="string">&#x27;username&#x27;</span>, <span class="variable">$username</span>)-&gt;first();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自訂驗證密碼"><a href="#自訂驗證密碼" class="headerlink" title="自訂驗證密碼"></a>自訂驗證密碼</h3><p>當使用密碼驗證，Passport 會使用 <code>password</code> 欄位驗證。如果你的資料模型沒有 <code>password</code> 欄位，或你希望自訂驗證邏輯，可以使用 <code>validateForPassportPasswordGrant</code> 方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="title">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Notifications</span>\<span class="title">Notifiable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Hash</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">HasApiTokens</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">use</span> <span class="title">HasApiTokens</span>, <span class="title">Notifiable</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">validateForPassportPasswordGrant</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$password</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Hash::check(<span class="variable">$password</span>, <span class="keyword">$this</span>-&gt;password);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="隱式授權"><a href="#隱式授權" class="headerlink" title="隱式授權"></a>隱式授權</h2><p>隱式授權類似 Authorization Code 授權；但是會直接傳回 Token 給客戶端，而不是 Authorization Code。這種授權通常用在 JavaScript 前端站或行動應用。要啟用授權，在 <code>App\Providers\AuthServiceProvider</code> 的 <code>boot</code> 調用 <code>enableImplicitGrant</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::enableImplicitGrant();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一旦授權啟用，開發者可以使用 Client ID 請求 Access Token。第三方應用應該導向我們的 <code>/oauth/authorize</code> 路由。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/redirect&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$request</span>-&gt;session()-&gt;put(<span class="string">&#x27;state&#x27;</span>, <span class="variable">$state</span> = Str::random(<span class="number">40</span>));</span><br><span class="line"></span><br><span class="line">  <span class="variable">$query</span> = http_build_query([</span><br><span class="line">    <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;redirect_uri&#x27;</span> =&gt; <span class="string">&#x27;http://third-party-app.com/callback&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;response_type&#x27;</span> =&gt; <span class="string">&#x27;token&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;scope&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;state&#x27;</span> =&gt; <span class="variable">$state</span>,</span><br><span class="line">    <span class="comment">// &#x27;prompt&#x27; =&gt; &#x27;&#x27;, // &quot;none&quot;, &quot;consent&quot;, &quot;login&quot;</span></span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> redirect(<span class="string">&#x27;http://passport-app.test/oauth/authorize?&#x27;</span>.<span class="variable">$query</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Client-Credentials-授權"><a href="#Client-Credentials-授權" class="headerlink" title="Client Credentials 授權"></a>Client Credentials 授權</h3><p>Client Credentials 授權適合用於機器對機器驗證。例如你可能授權一個排程 Job 利用 API 執行一些維護的任務。</p>
<p>在我們的應用可以通過 Client Credentials 授權發行金鑰之前，你需要建立 Client Credentials 授權的 Client。使用下面指令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan passport:client --client</span><br></pre></td></tr></table></figure>

<p>接著，為了使用這種授權類型，加入 <code>CheckClientCredentials</code> Middleware 到 <code>app/Http/Kernel.php</code> 的 <code>$middlewareAliases</code> 屬性</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Http</span>\<span class="title">Middleware</span>\<span class="title">CheckClientCredentials</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$middlewareAliases</span> = [</span><br><span class="line">  <span class="string">&#x27;client&#x27;</span> =&gt; CheckClientCredentials::class,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>然後在路由使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/orders&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)-&gt;middleware(<span class="string">&#x27;client&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>為了限制可存取的範圍 Scope 我們可以使用 <code>,</code> 加入 middleware 的後面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/orders&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)-&gt;middleware(<span class="string">&#x27;client:check-status,your-scope&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="讀取-Token"><a href="#讀取-Token" class="headerlink" title="讀取 Token"></a>讀取 Token</h3><p>為了取得這種授權方式的 Token，需要發送請求到 <code>/oauth/token</code> 路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Http</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = Http::asForm()-&gt;post(<span class="string">&#x27;http://passport-app.test/oauth/token&#x27;</span>, [</span><br><span class="line">  <span class="string">&#x27;grant_type&#x27;</span> =&gt; <span class="string">&#x27;client_credentials&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;client_secret&#x27;</span> =&gt; <span class="string">&#x27;client-secret&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;scope&#x27;</span> =&gt; <span class="string">&#x27;your-scope&#x27;</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$response</span>-&gt;json()[<span class="string">&#x27;access_token&#x27;</span>];</span><br></pre></td></tr></table></figure>

<h2 id="個人-Access-Token"><a href="#個人-Access-Token" class="headerlink" title="個人 Access Token"></a>個人 Access Token</h2><p>有時候，我們的用戶希望自己直接取得自己的 Access Token 而不經過完整的驗證流程。允許用戶通過介面取得自己的存取權杖進而讓用戶試驗您 API。</p>
<blockquote>
<p>如果你的應用程式主要只有使用 Passport 來產生個人 Access Token，也可以考慮使用 Laravel Sanctum，這是輕量化用於產生 API Access Token 的套件</p>
</blockquote>
<h3 id="建立個人存取的-Client"><a href="#建立個人存取的-Client" class="headerlink" title="建立個人存取的 Client"></a>建立個人存取的 Client</h3><p>在我們應用可以發行個人 Access Token 之前，你需要建立個人存取 Client。使用 <code>php artisan passport:client</code> 搭配 <code>--personal</code> 建立。如果你使用 <code>passport:install</code> 你可以不用執行這個指令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan passport:client --personal</span><br></pre></td></tr></table></figure>

<p>建立個人存取 Client 之後，將 Client 的 ID 和 Secret 放到 <code>.env</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PASSPORT_PERSONAL_ACCESS_CLIENT_ID=&quot;client-id-value&quot;</span></span><br><span class="line"><span class="string">PASSPORT_PERSONAL_ACCESS_CLIENT_SECRET=&quot;unhashed-client-secret-value&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="管理個人存取權杖-Access-Token"><a href="#管理個人存取權杖-Access-Token" class="headerlink" title="管理個人存取權杖 Access Token"></a>管理個人存取權杖 Access Token</h3><p>一旦你建立了個人存取 Client，就可以使用 <code>App\Models\User</code> 的 <code>createToken</code> 建立 Token 。<code>createToken</code> 方法可以傳入名稱和範圍參數等</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span> = User::find(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$token</span> = <span class="variable">$user</span>-&gt;createToken(<span class="string">&#x27;Token Name&#x27;</span>)-&gt;accessToken;</span><br><span class="line"></span><br><span class="line"><span class="variable">$token</span> = <span class="variable">$user</span>-&gt;createToken(<span class="string">&#x27;My Token&#x27;</span>, [<span class="string">&#x27;place-orders&#x27;</span>])-&gt;accessToken;</span><br></pre></td></tr></table></figure>

<h3 id="JSON-API-2"><a href="#JSON-API-2" class="headerlink" title="JSON API"></a>JSON API</h3><p>Passport 也包含一個 JSON API 用於管理個人 Access Token。你可以搭配你的前端提供用戶管理個人 Access Token 的管理介面。下面將概覽一下全部的 API 為了方便將使用 Axios 示範發送 HTTP 請求。</p>
<p>JSON API 有 <code>web</code> 和 <code>auth</code> Middleware 保護；因此只能在我們的應用呼叫，無法從外部呼叫。</p>
<h4 id="GET-oauth-scopes"><a href="#GET-oauth-scopes" class="headerlink" title="GET /oauth/scopes"></a>GET /oauth/scopes</h4><p>此路由回傳所有的範圍 <code>scopes</code> ，可以顯示範圍列表給用戶並授權給個人 Access Token</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&#x27;/oauth/scopes&#x27;</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(response.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="GET-oauth-personal-access-tokens"><a href="#GET-oauth-personal-access-tokens" class="headerlink" title="GET /oauth/personal-access-tokens"></a>GET /oauth/personal-access-tokens</h4><p>此路由回傳全部的個人 Access Token ，登入的用戶可以管理。用戶 Access Token 列表在提供用戶編輯和撤銷也非常實用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&#x27;/oauth/personal-access-tokens&#x27;</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(response.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="PSOT-oauth-personal-access-tokens"><a href="#PSOT-oauth-personal-access-tokens" class="headerlink" title="PSOT /oauth/personal-access-tokens"></a>PSOT /oauth/personal-access-tokens</h4><p>此路由可以建立新的用戶 Access Token。需要 2 個參數 <code>name</code> 和 <code>scopes</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Token Name&#x27;</span>,</span><br><span class="line">  <span class="attr">scopes</span>: [],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">axios</span><br><span class="line">  .post(<span class="string">&#x27;/oauth/personal-access-tokens&#x27;</span>, data)</span><br><span class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response.data.accessToken);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="DELETE-oauth-personal-access-tokens-token-id"><a href="#DELETE-oauth-personal-access-tokens-token-id" class="headerlink" title="DELETE /oauth/personal-access-tokens/{token-id}"></a>DELETE /oauth/personal-access-tokens/{token-id}</h4><p>此路由可以用於撤銷個人 Access Token</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axios.delete(<span class="string">&#x27;/oauth/personal-access-tokens/&#x27;</span> + tokenId);</span><br></pre></td></tr></table></figure>

<h2 id="保護路由"><a href="#保護路由" class="headerlink" title="保護路由"></a>保護路由</h2><h3 id="使用-Middleware"><a href="#使用-Middleware" class="headerlink" title="使用 Middleware"></a>使用 Middleware</h3><p>Passport 包含一個驗證的 Guard 用於驗證請求的 Access Token 。一旦設定 <code>api </code> Guard 使用 <code>passport</code> Driver，我們只需設定 <code>auth:api</code> Middleware 就可以驗證 Access Token</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/user&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;)-&gt;middleware(<span class="string">&#x27;auth:api&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>如果使用的是 Client 憑證授權則 middleware 需要使用 <code>client</code>。</p>
<h4 id="複數驗證-Guard"><a href="#複數驗證-Guard" class="headerlink" title="複數驗證 Guard"></a>複數驗證 Guard</h4><p>如果我們的應用包含驗證多種不同的用戶類型（使用不同的 Model），會需要為每一個 Provider 類型定義 guard 設定。這讓你可以保護特定用戶的請求。例如在 <code>config/auth.php</code> 提供</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;api&#x27;</span> =&gt; [</span><br><span class="line">  <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;passport&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;provider&#x27;</span> =&gt; <span class="string">&#x27;users&#x27;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&#x27;api-customers&#x27;</span> =&gt; [</span><br><span class="line">  <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;passport&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;provider&#x27;</span> =&gt; <span class="string">&#x27;customers&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>下面路由則使用 <code>api-customers</code> Guard 搭配 <code>customers</code> Provider 來驗證請求</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/customer&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)-&gt;middleware(<span class="string">&#x27;auth:api-customers&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="傳送-Access-Token"><a href="#傳送-Access-Token" class="headerlink" title="傳送 Access Token"></a>傳送 Access Token</h4><p>當呼叫的路由受到 Passport 保護的時候，API 請求應設定 <code>Authorization: Bearer TOKEN</code> Header 。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Http</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = Http::withHeaders([</span><br><span class="line">  <span class="string">&#x27;Accept&#x27;</span> =&gt; <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Authorization&#x27;</span> =&gt; <span class="string">&#x27;Bearer &#x27;</span> . <span class="variable">$accessToekn</span>,</span><br><span class="line">])-&gt;get(<span class="string">&#x27;https://passport-app.test/api/user&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$response</span>-&gt;json();</span><br></pre></td></tr></table></figure>

<h2 id="Token-Scopes"><a href="#Token-Scopes" class="headerlink" title="Token Scopes"></a>Token Scopes</h2><p>範圍 Scope 允許 API 用戶請求驗證存取用戶帳號時指定權限。例如，如果你建立一個購物網站，並非所有調用 API 都需要建立訂單的功能。你可能希望用戶只能請求訂單的出貨狀態。換句話說，scopes 讓用戶可以限制第三方應用可以執行的權限。</p>
<h3 id="定義-Scopes"><a href="#定義-Scopes" class="headerlink" title="定義 Scopes"></a>定義 Scopes</h3><p>你可以在 <code>App\Providers\AuthServiceProvider</code> 的 <code>boot</code> 用 <code>Passport::tokenCan</code> 方法定義 API scope。<code>tokenCan</code> 方法需要一個陣列參數</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::tokenCan([</span><br><span class="line">    <span class="string">&#x27;place-orders&#x27;</span> =&gt; <span class="string">&#x27;Place orders&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;check-status&#x27;</span> =&gt; <span class="string">&#x27;Check order status&#x27;</span>,</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="預設-Scopes"><a href="#預設-Scopes" class="headerlink" title="預設 Scopes"></a>預設 Scopes</h3><p>如果用戶端沒有請求特定 Scopes， 你可以用 <code>setDefaultScope</code> 設定預設的 Scopes 。一樣是在 <code>App\Providers\AuthServiceProvider</code> 類別定義：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Passport</span>;</span><br><span class="line"></span><br><span class="line">Passport::tokenCan([</span><br><span class="line">  <span class="string">&#x27;place-orders&#x27;</span> =&gt; <span class="string">&#x27;Place orders&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;check-status&#x27;</span> =&gt; <span class="string">&#x27;Check order status&#x27;</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">Passport::setDefaultScope([</span><br><span class="line">   <span class="string">&#x27;check-status&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;place-orders&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>預設 Scopes 不會套用在個人 Access Token。</p>
<h3 id="設定-Access-Token-的範圍"><a href="#設定-Access-Token-的範圍" class="headerlink" title="設定 Access Token 的範圍"></a>設定 Access Token 的範圍</h3><h4 id="請求-Authorization-Code"><a href="#請求-Authorization-Code" class="headerlink" title="請求 Authorization Code"></a>請求 Authorization Code</h4><p>當使用 Authorization Code 授權模式請求 Access Token 時，用戶端應在 Query String 設定他們希望的 <code>scope</code></p>
<p><code>scope</code> 使用空白字元分隔範圍清單</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/redirect&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$query</span> = http_build_query([</span><br><span class="line">    <span class="string">&#x27;client_id&#x27;</span> =&gt; <span class="string">&#x27;client-id&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;redirect_uri&#x27;</span> =&gt; <span class="string">&#x27;http://example.com/callback&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;response_type&#x27;</span> =&gt; <span class="string">&#x27;code&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;scope&#x27;</span> =&gt; <span class="string">&#x27;place-orders check-status&#x27;</span>,</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> redirect(<span class="string">&#x27;https://passport-app.test/oauth/authorize?&#x27;</span>.<span class="variable">$query</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="個人-Access-Token-1"><a href="#個人-Access-Token-1" class="headerlink" title="個人 Access Token"></a>個人 Access Token</h4><p>如果你使用 <code>App\Models\User</code> 的 <code>createToken</code> 產生個人 Access Token ，你需要在第二個參數傳入希望的範圍：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$token</span> = <span class="variable">$user</span>-&gt;createToken(<span class="string">&#x27;My Token&#x27;</span>, [<span class="string">&#x27;place-orders&#x27;</span>])-&gt;accessToken;</span><br></pre></td></tr></table></figure>

<h3 id="檢查-Scopes"><a href="#檢查-Scopes" class="headerlink" title="檢查 Scopes"></a>檢查 Scopes</h3><p>Passport 包含兩個 Middleware 可以用來檢查請求是否包含授權範圍的 Token。要使用 Middleware 須在 <code>app/Http/Kernel.php</code> 的 <code>$middlewareAliases</code> 加入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;scopes&#x27;</span> =&gt; \Laravel\Passport\Http\Middleware\CheckScopes::class,</span><br><span class="line"><span class="string">&#x27;scope&#x27;</span> =&gt; \Laravel\passport\Http\Middleware\CheckForAnyScope::class,</span><br></pre></td></tr></table></figure>

<h4 id="檢查全部-Scopes"><a href="#檢查全部-Scopes" class="headerlink" title="檢查全部 Scopes"></a>檢查全部 Scopes</h4><p><code>scopes</code> Middleware 可以設定到路由用於驗證請求的 Access Token 是否具備全部列出的 scopes</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/orders&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)-&gt;middleware([<span class="string">&#x27;auth:api&#x27;</span>, <span class="string">&#x27;scopes:check-status,place-orders&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="檢查任意-Scopes"><a href="#檢查任意-Scopes" class="headerlink" title="檢查任意 Scopes"></a>檢查任意 Scopes</h4><p><code>scope</code> Middleware 可以設定到路由用於檢查請求的 Access Token 至少符合列表其中一項 Scope</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::(<span class="string">&#x27;/orders&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Access Token 至少有 check-status 或 place-orders scope</span></span><br><span class="line">&#125;)-&gt;middleware([<span class="string">&#x27;auth:api&#x27;</span>, <span class="string">&#x27;scope:check-status,place-orders&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="檢查-Token-物件實例的-Scope"><a href="#檢查-Token-物件實例的-Scope" class="headerlink" title="檢查 Token 物件實例的 Scope"></a>檢查 Token 物件實例的 Scope</h4><p>一旦 Access Token 通過驗證到應用程式，還可以用 <code>App\Models\User</code> 的 <code>tokenCan</code> 檢查 Access Token 是否有指定的範圍。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/orders/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">  	<span class="keyword">if</span> (<span class="variable">$request</span>-&gt;user()-&gt;tokenCan(<span class="string">&#x27;place-orders&#x27;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="其他-scope-方法"><a href="#其他-scope-方法" class="headerlink" title="其他 scope 方法"></a>其他 scope 方法</h4><p><code>scopeIds</code> 方法會回傳全部定義 scope 的 ID / 名稱陣列</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Passport</span>;</span><br><span class="line"></span><br><span class="line">Passport::scopeIds();</span><br></pre></td></tr></table></figure>

<p><code>scopes</code> 方法會回傳全部定義的 <code>Laravel\Passport\Scope</code> 物件實例陣列。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Passport::scopes();</span><br></pre></td></tr></table></figure>

<p><code>scopesFor</code> 方法會回傳匹配指定 IDs / 名稱的 <code>Laravel\Passport\Scope</code> 物件實例陣列。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Passport::scopesFor([<span class="string">&#x27;place-orders&#x27;</span>, <span class="string">&#x27;check-status&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p><code>hasScope</code> 檢查是否有定義該範圍</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Passport::hasScope(<span class="string">&#x27;place-orders&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="JavaScript-使用-API"><a href="#JavaScript-使用-API" class="headerlink" title="JavaScript 使用 API"></a>JavaScript 使用 API</h2><p>在開發 API 時，如果您的前端應用（比如用 JavaScript 寫的 SPA）需要訪問這個 API，通常的做法是在每次發送請求時附加一個 Access Token。但是，Laravel Passport 提供了一種更簡便的方法。<br>這種方式讓我們的應用可以使用將對外開放一樣的 API。同樣的 API 可以被我們的網頁應用，行動 app ，第三方應用，任何發佈的 SDK 使用。</p>
<p>一般來說，如果你希望從 JavaScript 應用使用 API，會需要手動發送 Access Token ，不過 Passport 支援一個 Middleware 可以處理這種情況。你只要加入 <code>CreateFreshApiToken</code> Middleware 到 <code>app/Http/Kernel.php</code> 檔案的 <code>web</code> Middleware 群組</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;web&#x27;</span> =&gt; [</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  \Laravel\Passport\Http\Middleware\CreateFreshApiToken::class,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>需要確保這個 <code>CreateFreshApiToken</code> Middleware 在最後。</p>
<p>這個 Middleware 會將一個名為 <code>laravel_token</code> 的 Cookie 附加到 Response。 Cookie 包含一個加密的 JWT ，Passport 會使用這個 JWT 驗證來自你 JavaScript 應用的請求。也就是當讀取頁面時，由於瀏覽器會自動隨所有請求發送這個 Cookie，您的前端應用可以不必在每次請求時明確地傳遞訪問權杖。JWT 的有效時間等於 <code>session.lifetime</code> 設定。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&#x27;/api/user&#x27;</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(response.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="自訂-Cookie-名稱"><a href="#自訂-Cookie-名稱" class="headerlink" title="自訂 Cookie 名稱"></a>自訂 Cookie 名稱</h4><p>如果你需要自訂 <code>laravel_token</code> 的名稱可以使用 <code>Passport::cookie</code> 方法。一般來說，這個方法應該在 <code>App\Providers\AuthServiceProvider</code> 的 <code>boot</code> 使用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::cookie(<span class="string">&#x27;custom_name&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h4><p>當使用這種驗證方式時，你需要確保 CSRF 有效。預設 Laravel 會在 Axsio 的請求自動將 <code>XSRF-TOKEN</code> Cookie 的值加入 <code>X-XSRF-TOKEN</code> Header 裡。</p>
<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><p>當發行 Access Token 或 Refresh Token 時 ，Passport 會引發事件，你可以利用這些事件清除或撤銷其他失效的 Access Token。如果你希望這麼做可以在 <code>App\Providers\EventServiceProvider</code> 註冊監聽。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$listen</span> = [</span><br><span class="line">  <span class="string">&#x27;Laravel\Passport\Events\AccessTokenCreated&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;App\Listeners\RevokeOldTokens&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="string">&#x27;Laravel\Passport\Events\RefreshTokenCreated&#x27;</span> =&gt; [</span><br><span class="line">  	<span class="string">&#x27;App\Listeners\PruneOldTokens&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="測試"><a href="#測試" class="headerlink" title="測試"></a>測試</h2><p>Passport 的 <code>actingAs</code> 方法可以用來指定目前通過驗證的用戶和其 Scopes。<code>actingAs</code> 第一個參數時用戶的物件實例，第二個參數這是 scopes 的陣列</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Passport</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_servers_can_be_created</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::actingAs(</span><br><span class="line">  	User::factory()-&gt;create(),</span><br><span class="line">    [<span class="string">&#x27;create-servers&#x27;</span>]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="variable">$response</span> = <span class="keyword">$this</span>-&gt;post(<span class="string">&#x27;/api/create-server&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$response</span>-&gt;assertStatus(<span class="number">201</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Passport 的 <code>actingAsClient</code> 方法可以用來指定當前通過驗證的 Client 和 Scopes</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Client</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Passport</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_orders_can_be_retrieved</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Passport::actingAsClient(</span><br><span class="line">  	Client::factory()-&gt;create(),</span><br><span class="line">    [<span class="string">&#x27;check-status&#x27;</span>]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="variable">$response</span> = <span class="keyword">$this</span>-&gt;get(<span class="string">&#x27;/api/orders&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$response</span>-&gt;assertStatus(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="實戰練習"><a href="#實戰練習" class="headerlink" title="實戰練習"></a>實戰練習</h2><h3 id="取得-Client-Credentials-Token-amp-JWK-驗證"><a href="#取得-Client-Credentials-Token-amp-JWK-驗證" class="headerlink" title="取得 Client Credentials Token &amp; JWK 驗證"></a>取得 Client Credentials Token &amp; JWK 驗證</h3><p><strong>1. 取得 Client Credentials Token</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan passport:client --client</span><br></pre></td></tr></table></figure>

<p><strong>2. 取得 Access Token</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST http://localhost:8000/oauth/token \</span><br><span class="line">    -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">    -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">        &quot;grant_type&quot;: &quot;client_credentials&quot;,</span></span><br><span class="line"><span class="string">        &quot;client_id&quot;: &quot;your-client-id&quot;,</span></span><br><span class="line"><span class="string">        &quot;client_secret&quot;: &quot;your-client-secret&quot;,</span></span><br><span class="line"><span class="string">        &quot;scope&quot;: &quot;&quot;</span></span><br><span class="line"><span class="string">    &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>3. 取得 JWK</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X GET http://localhost:8000/oauth/jwk</span><br></pre></td></tr></table></figure>

<p><strong>4. 驗證 Access Token</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt <span class="keyword">from</span> <span class="string">&#x27;jsonwebtoken&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> jwkToPem <span class="keyword">from</span> <span class="string">&#x27;jwk-to-pem&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> jwtToken = <span class="string">&#x27;jwt-token&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> jwks = &#123;</span><br><span class="line">  <span class="attr">keys</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">kty</span>: <span class="string">&#x27;RSA&#x27;</span>,</span><br><span class="line">      <span class="attr">alg</span>: <span class="string">&#x27;RS256&#x27;</span>,</span><br><span class="line">      <span class="attr">use</span>: <span class="string">&#x27;sig&#x27;</span>,</span><br><span class="line">      <span class="attr">kid</span>: <span class="string">&#x27;oauth-public-key&#x27;</span>,</span><br><span class="line">      <span class="attr">n</span>: <span class="string">&#x27;---&#x27;</span>,</span><br><span class="line">      <span class="attr">e</span>: <span class="string">&#x27;AQAB&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pem = jwkToPem(jwks.keys[<span class="number">0</span>]);</span><br><span class="line">jwt.verify(jwtToken, pem, &#123; <span class="attr">algorithms</span>: [<span class="string">&#x27;RS256&#x27;</span>] &#125;, <span class="function">(<span class="params">err, decoded</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(decoded);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// decoded</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">aud</span>: <span class="string">&#x27;9ac5c11a-xxx&#x27;</span>, <span class="comment">// oauth_clients.id</span></span><br><span class="line">  <span class="attr">jti</span>: <span class="string">&#x27;c6a8xxx&#x27;</span>, <span class="comment">// oauth_access_tokens.id</span></span><br><span class="line">  <span class="attr">iat</span>: <span class="number">1701741512.363331</span>,</span><br><span class="line">  <span class="attr">nbf</span>: <span class="number">1701741512.363331</span>,</span><br><span class="line">  <span class="attr">exp</span>: <span class="number">1706925512.356904</span>,</span><br><span class="line">  <span class="attr">sub</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">scopes</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>Laravel Passport 和 OAuth2</p><p><a href="https://andyyou.github.io/2023/12/05/laravel-passport/">https://andyyou.github.io/2023/12/05/laravel-passport/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>andyyou(YOU,ZONGYAN)</p></div></div><div class="level-item is-narrow"><div><h6>發表於</h6><p>2023-12-05</p></div></div><div class="level-item is-narrow"><div><h6>更新於</h6><p>2023-12-07</p></div></div><div class="level-item is-narrow"><div><h6>許可協議</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/laravel/">laravel</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜歡這篇文章嗎? 贊助一下作者吧!</h3><div class="buttons is-centered"><a class="button donate" href="https://www.buymeacoffee.com/andyyou" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/01/18/app-engine-static-ip/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">GCP App Engine 設定固定 IP</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/11/16/zero2hero-deploy-laravel-goole-kubernetes-with-ssl/"><span class="level-item">Zero2Hero：部署 Laravel 10 到 GKE</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars2.githubusercontent.com/u/665690?v=3&amp;s=466" alt="andyou"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">andyou</p><p class="is-size-6 is-block">DEVLOG of andyyou</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Taipei</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">227</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分類</p><a href="/categories"><p class="title">9</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">標籤</p><a href="/tags"><p class="title">91</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/andyyou" target="_blank" rel="noopener">追蹤</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/andyyou"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="/"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="/"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="/"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分類</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Cloud/"><span class="level-start"><span class="level-item">Cloud</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Fun/"><span class="level-start"><span class="level-item">Fun</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Management/"><span class="level-start"><span class="level-item">Management</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Mobile/"><span class="level-start"><span class="level-item">Mobile</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Program/"><span class="level-start"><span class="level-item">Program</span></span><span class="level-end"><span class="level-item tag">159</span></span></a></li><li><a class="level is-mobile" href="/categories/System/"><span class="level-start"><span class="level-item">System</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Tools/"><span class="level-start"><span class="level-item">Tools</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/UX/"><span class="level-start"><span class="level-item">UX</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-08T08:07:15.000Z">2024-07-08</time></p><p class="title"><a href="/2024/07/08/laravel-interface/">[譯]Laravel 介面最佳實作</a></p><p class="categories"><a href="/categories/Program/">Program</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-08T08:07:15.000Z">2024-07-08</time></p><p class="title"><a href="/2024/07/08/gh-ost/">gh-ost 無鎖編輯資料結構</a></p><p class="categories"><a href="/categories/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-03T09:04:10.000Z">2024-07-03</time></p><p class="title"><a href="/2024/07/03/edit-gcloud-gke-secrets/">變更 Google Cloud GKE Secrets 值</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-02-26T07:09:57.000Z">2024-02-26</time></p><p class="title"><a href="/2024/02/26/stepping-stone/">逐步執行「階段」，而不是里程碑</a></p><p class="categories"><a href="/categories/Management/">Management</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-18T03:10:07.000Z">2024-01-18</time></p><p class="title"><a href="/2024/01/18/app-engine-static-ip/">GCP App Engine 設定固定 IP</a></p><p class="categories"><a href="/categories/Cloud/">Cloud</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">彙整</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">七月 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">十二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">九月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">十一月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">六月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">三月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">十二月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">十一月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">十月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">九月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">八月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">七月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">六月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">五月 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">四月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/02/"><span class="level-start"><span class="level-item">二月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">一月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">十二月 2016</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">十一月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">十月 2016</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/09/"><span class="level-start"><span class="level-item">九月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/08/"><span class="level-start"><span class="level-item">八月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/06/"><span class="level-start"><span class="level-item">六月 2016</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/05/"><span class="level-start"><span class="level-item">五月 2016</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/04/"><span class="level-start"><span class="level-item">四月 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/03/"><span class="level-start"><span class="level-item">三月 2016</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">二月 2016</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/01/"><span class="level-start"><span class="level-item">一月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/12/"><span class="level-start"><span class="level-item">十二月 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/11/"><span class="level-start"><span class="level-item">十一月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/10/"><span class="level-start"><span class="level-item">十月 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/09/"><span class="level-start"><span class="level-item">九月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/08/"><span class="level-start"><span class="level-item">八月 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">七月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/05/"><span class="level-start"><span class="level-item">五月 2015</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">四月 2015</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/12/"><span class="level-start"><span class="level-item">十二月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/11/"><span class="level-start"><span class="level-item">十一月 2014</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/10/"><span class="level-start"><span class="level-item">十月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/09/"><span class="level-start"><span class="level-item">九月 2014</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/08/"><span class="level-start"><span class="level-item">八月 2014</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/02/"><span class="level-start"><span class="level-item">二月 2014</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/01/"><span class="level-start"><span class="level-item">一月 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/11/"><span class="level-start"><span class="level-item">十一月 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/10/"><span class="level-start"><span class="level-item">十月 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/09/"><span class="level-start"><span class="level-item">九月 2013</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/08/"><span class="level-start"><span class="level-item">八月 2013</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/03/"><span class="level-start"><span class="level-item">三月 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/03/"><span class="level-start"><span class="level-item">三月 2012</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/01/"><span class="level-start"><span class="level-item">一月 2012</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2011/11/"><span class="level-start"><span class="level-item">十一月 2011</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">標籤</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/net-mvc/"><span class="tag">.net mvc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RoR/"><span class="tag">RoR</span><span class="tag">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/api/"><span class="tag">api</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aws/"><span class="tag">aws</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azure/"><span class="tag">azure</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bot/"><span class="tag">bot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bundler/"><span class="tag">bundler</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cache/"><span class="tag">cache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/carrier-wave/"><span class="tag">carrier wave</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/centos/"><span class="tag">centos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chrome/"><span class="tag">chrome</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloudflare/"><span class="tag">cloudflare</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/compass/"><span class="tag">compass</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag">19</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cve/"><span class="tag">cve</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devise/"><span class="tag">devise</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dnd/"><span class="tag">dnd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/e-invoice/"><span class="tag">e-invoice</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/entity-framework/"><span class="tag">entity framework</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/envoy/"><span class="tag">envoy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/es6/"><span class="tag">es6</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/facebook/"><span class="tag">facebook</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flux/"><span class="tag">flux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/framework/"><span class="tag">framework</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gcp/"><span class="tag">gcp</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gitlab/"><span class="tag">gitlab</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/grunt/"><span class="tag">grunt</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gulp/"><span class="tag">gulp</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/heroku/"><span class="tag">heroku</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/html/"><span class="tag">html</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iisexpress/"><span class="tag">iisexpress</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ios/"><span class="tag">ios</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag">88</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript-express-passport/"><span class="tag">javascript express passport</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript-nodejs/"><span class="tag">javascript nodejs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jekyll/"><span class="tag">jekyll</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jetstream/"><span class="tag">jetstream</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jspm/"><span class="tag">jspm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jwt/"><span class="tag">jwt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/laravel/"><span class="tag">laravel</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/letsencrypt/"><span class="tag">letsencrypt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mechanism/"><span class="tag">mechanism</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nextjs/"><span class="tag">nextjs</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/oocss/"><span class="tag">oocss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/osx/"><span class="tag">osx</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/package-manager/"><span class="tag">package manager</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php/"><span class="tag">php</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgres/"><span class="tag">postgres</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgresql/"><span class="tag">postgresql</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/queue/"><span class="tag">queue</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rabbitmq/"><span class="tag">rabbitmq</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rack-server/"><span class="tag">rack server</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rails/"><span class="tag">rails</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rails-webpack-stimulus-javascript-bootstrap/"><span class="tag">rails webpack stimulus javascript bootstrap</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/raspberry-pi/"><span class="tag">raspberry-pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reactjs/"><span class="tag">reactjs</span><span class="tag">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redux/"><span class="tag">redux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ruby/"><span class="tag">ruby</span><span class="tag">18</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sass/"><span class="tag">sass</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/selenium/"><span class="tag">selenium</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/serial-port/"><span class="tag">serial-port</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/slim/"><span class="tag">slim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssl/"><span class="tag">ssl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/stimulus/"><span class="tag">stimulus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/svg-javascript/"><span class="tag">svg javascript</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/task-runner/"><span class="tag">task runner</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tmux/"><span class="tag">tmux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tools/"><span class="tag">tools</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ux/"><span class="tag">ux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vm/"><span class="tag">vm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vue/"><span class="tag">vue</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vuejs/"><span class="tag">vuejs</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webpack/"><span class="tag">webpack</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wsl/"><span class="tag">wsl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xml/"><span class="tag">xml</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zoom/"><span class="tag">zoom</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">廣告</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3038600205998182" data-ad-slot="6442659171" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="DEVLOG of andyyou" height="28"></a><p class="is-size-7"><span>&copy; 2025 andyyou(YOU,ZONGYAN)</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/andyyou/"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-TW");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到頁首" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="請輸入關鍵字..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"請輸入關鍵字...","untitled":"(無標題)","posts":"文章","pages":"頁面","categories":"分類","tags":"標籤"});
        });</script></body></html>