<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>使用 Passport 實作 Nodejs 應用程式驗證機制 - DEVLOG of andyyou</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="DEVLOG of andyyou"><meta name="msapplication-TileImage" content="/img/faicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="DEVLOG of andyyou"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="為應用程式實作穩固的驗證機制一直以來都是令人害怕的工作，當然在 Nodejs 的世界中也不例外。 在這篇文章，我們將要從零開始開發一個 Nodejs 的應用程式搭配一套熱門的驗證 Middleware - passport。passport 本身單純只關注驗證相關的部分，在官方文件中它這麼描述：這是一套簡單，可無縫整合於 Node 的 Middlewre。理解它本質是 Middleware 有助於"><meta property="og:type" content="article"><meta property="og:title" content="DEVLOG of andyyou"><meta property="og:url" content="https://andyyou.github.io/2017/04/11/express-passport/"><meta property="og:site_name" content="DEVLOG of andyyou"><meta property="og:description" content="為應用程式實作穩固的驗證機制一直以來都是令人害怕的工作，當然在 Nodejs 的世界中也不例外。 在這篇文章，我們將要從零開始開發一個 Nodejs 的應用程式搭配一套熱門的驗證 Middleware - passport。passport 本身單純只關注驗證相關的部分，在官方文件中它這麼描述：這是一套簡單，可無縫整合於 Node 的 Middlewre。理解它本質是 Middleware 有助於"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="http://imgur.com/a/KQO2K.png"><meta property="og:image" content="https://cms-assets.tutsplus.com/uploads/users/388/posts/21619/image/Bird_Eye_View_of_PassportJS_App.png"><meta property="article:published_time" content="2017-04-11T01:30:50.000Z"><meta property="article:modified_time" content="2023-05-12T00:48:25.215Z"><meta property="article:author" content="andyyou"><meta property="article:tag" content="javascript express passport"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="http://imgur.com/a/KQO2K.png"><meta property="fb:app_id" content="450470251782295"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://andyyou.github.io/2017/04/11/express-passport/"},"headline":"使用 Passport 實作 Nodejs 應用程式驗證機制","image":["http://imgur.com/a/KQO2K.png","https://cms-assets.tutsplus.com/uploads/users/388/posts/21619/image/Bird_Eye_View_of_PassportJS_App.png"],"datePublished":"2017-04-11T01:30:50.000Z","dateModified":"2023-05-12T00:48:25.215Z","author":{"@type":"Person","name":"https://avatars2.githubusercontent.com/u/665690?v=3&s=466"},"publisher":{"@type":"Organization","name":"DEVLOG of andyyou","logo":{"@type":"ImageObject","url":"https://andyyou.github.io/img/logo.png"}},"description":"為應用程式實作穩固的驗證機制一直以來都是令人害怕的工作，當然在 Nodejs 的世界中也不例外。 在這篇文章，我們將要從零開始開發一個 Nodejs 的應用程式搭配一套熱門的驗證 Middleware - passport。passport 本身單純只關注驗證相關的部分，在官方文件中它這麼描述：這是一套簡單，可無縫整合於 Node 的 Middlewre。理解它本質是 Middleware 有助於"}</script><link rel="canonical" href="https://andyyou.github.io/2017/04/11/express-passport/"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-C93NK5NEGP" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-C93NK5NEGP');</script><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><script data-ad-client="ca-pub-3038600205998182" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="DEVLOG of andyyou" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/andyyou"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜尋" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-11T01:30:50.000Z" title="2017/4/11 上午9:30:50">2017-04-11</time>發表</span><span class="level-item"><time dateTime="2023-05-12T00:48:25.215Z" title="2023/5/12 上午8:48:25">2023-05-12</time>更新</span><span class="level-item">28 分鐘讀完 (大約4265個字)</span></div></div><h1 class="title is-3 is-size-4-mobile">使用 Passport 實作 Nodejs 應用程式驗證機制</h1><div class="content"><p>為應用程式實作穩固的驗證機制一直以來都是令人害怕的工作，當然在 Nodejs 的世界中也不例外。</p>
<p>在這篇文章，我們將要從零開始開發一個 Nodejs 的應用程式搭配一套熱門的驗證 Middleware - <a target="_blank" rel="noopener" href="http://passportjs.org/">passport</a>。<br>passport 本身單純只關注驗證相關的部分，在官方文件中它這麼描述：這是一套簡單，可無縫整合於 Node 的 Middlewre。理解它本質是 Middleware 有助於後續的應用。</p>
<span id="more"></span>

<p>透過 Middleware 的機制，passport 將驗證所需的工作抽離以達到關注點分離的特點。同時這讓 passport 可以簡單的設定任何基於 express 的應用程式，就像我們設定其他 express middleware 一樣，例如 <a target="_blank" rel="noopener" href="https://github.com/expressjs/morgan">logging</a>，<a target="_blank" rel="noopener" href="https://github.com/expressjs/body-parser">body-parser</a>，<a target="_blank" rel="noopener" href="https://github.com/expressjs/cookie-parser">cookie-parser</a> 等等。</p>
<p>這裡我們假設您對於 Nodejs 和 express 有些基本的認識，我們將專注在驗證機制的部分。</p>
<h1 id="驗證機制-策略-Authentication-Strategies"><a href="#驗證機制-策略-Authentication-Strategies" class="headerlink" title="驗證機制/策略 (Authentication Strategies)"></a>驗證機制/策略 (Authentication Strategies)</h1><p>passport 提供了 300 多種驗證機制讓我們選擇。我們可以使用本地端或遠端的資料庫來驗證用戶身分又或者使用 OAuth 來完成單一登入 (SSO) 的功能例如 Facebook，Twitter，Google 等等。我們可以從<a target="_blank" rel="noopener" href="https://github.com/expressjs/cookie-parser">驗證機制列表</a>中選擇 passport 有支援的 Node 模組。</p>
<p>小結來說：passport 是一個 Middleware，負責處理身分驗證，其將 <code>驗證邏輯</code> 抽離並稱其為 <code>驗證策略 Stratety</code> 例如：使用本地端的資料庫驗證是一種策略，Facebook 登入也是一種，我們可以依據需求使用。</p>
<p>先別擔心，我們只需要安裝我們需要的東西即可。每個驗證策略模組都是獨立的，當我們安裝 passport 時，預設<code>不會</code>幫我們安裝任何一種。</p>
<p>在這篇文章我們將會使用最常見的方式 - 本地端驗證策略搭配我們存在本地端 MongoDB 資料庫的帳號。為了要使用本地端驗證機制，我們需要安裝 <code>passport-local</code>。</p>
<p>OK，到這邊我們理解了， <code>passport</code> 需要搭配不同的<code>驗證策略</code>，這裡我們使用 <code>passport-local</code>。</p>
<p>在開始之前，我們還需要一個 express 應用程式。讓我們打開終端機，建立一個 express 應用程式。這個應用程式會有包含登入，註冊，首頁的功能。注意，我們將要使用 express 4 來實作。</p>
<h1 id="設定應用程式"><a href="#設定應用程式" class="headerlink" title="設定應用程式"></a>設定應用程式</h1><p>如果您還沒安裝 express 產生器請先跟著<a target="_blank" rel="noopener" href="https://expressjs.com/en/starter/generator.html">官方文件</a>安裝。然後我們執行下面的指令建立專案。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ express express-mongodb-passport</span><br></pre></td></tr></table></figure>

<p><img src="http://imgur.com/a/KQO2K.png"></p>
<p>為了讓事情單純，不被混淆。我們要移除一些預設 generator 產生的但我們不需要的東西 - 刪除 <code>routes/users.js</code> 和 <code>app.js</code> 中有使用 <code>routes/users.js</code> 部分的程式碼。</p>
<h1 id="安裝-passport-和相關模組"><a href="#安裝-passport-和相關模組" class="headerlink" title="安裝 passport 和相關模組"></a>安裝 passport 和相關模組</h1><p>在終端機上，切換到我們的專案目錄下安裝 <code>passport</code>，<code>passport-local</code> 和預設的模組。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i</span><br><span class="line">$ npm i passport passport-local -S</span><br></pre></td></tr></table></figure>

<p>因為我們要把使用者帳號等資訊存在 MongoDB 中。為了方便，這邊我們會使用 <code>mongoose</code> 這個 ODM 函式庫來協助我們操作 MongoDB。</p>
<p>一樣讓我們來安裝。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i mongoose -S</span><br></pre></td></tr></table></figure>

<p>現在，我們已經安裝好相依的函式庫了，讓我們執行 <code>npm start</code> 來看看程式是否可以正常運作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure>

<p>啟動 Server 之後我們用瀏覽器查看 <code>http://localhost:3000</code> 應該要能看到 express 預設的首頁。</p>
<p>雖然畫面上除了簡單的文字，什麼都沒有。沒關係！我們會接著完成 <code>註冊</code>，<code>登入</code>並使用 passport 驗證已註冊的使用者。</p>
<h1 id="建立-mongoose-資料模型"><a href="#建立-mongoose-資料模型" class="headerlink" title="建立 mongoose 資料模型"></a>建立 mongoose 資料模型</h1><p>因為我們要使用 mongoose 來將使用者帳號資料等存在 MongoDB，要使用 ODM 第一步我們需要先定義資料模型。</p>
<p>在專案目錄下建立 <code>models/user.js</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> Schema = mongoose.Schema;</span><br><span class="line"><span class="keyword">var</span> UserSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="built_in">String</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="built_in">String</span>,</span><br><span class="line">  <span class="attr">firstname</span>: <span class="built_in">String</span>,</span><br><span class="line">  <span class="attr">lastname</span>: <span class="built_in">String</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">&#x27;User&#x27;</span>, UserSchema);</span><br></pre></td></tr></table></figure>

<p>基本上我們建立的這個 mongoose 資料模型是讓我們簡化 CRUD 的操作，參考<a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/models.html">文件</a>中的範例程式碼就能明白為什麼我們需要這麼做。</p>
<h1 id="設定-MongoDB"><a href="#設定-MongoDB" class="headerlink" title="設定 MongoDB"></a>設定 MongoDB</h1><p>如果您本機還沒安裝 MongoDB 請先遵循<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/installation/">官方文件</a>進行安裝。又或者可以使用雲端服務 <a target="_blank" rel="noopener" href="https://mongolab.com/welcome/">MongoLab</a>。</p>
<p>在我們安裝完成 MongoDB 並啟動之後我們就可以使用 <code>mongodb://localhost:27017</code> 來連線。如果您是使用雲端服務您應該會取得一個連線字串像是 <code>mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@&lt;service.url.com&gt;:27017/&lt;dbName&gt;</code>。這個連線字串會決定我們操作的資料庫。</p>
<p>通常在專案中我們會將資料庫設定的部分獨立出來。在這裡我們建立一個 <code>db.js</code> 來負責資料庫相關的部分。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">connection</span>: <span class="string">&#x27;mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@&lt;service.url.com&gt;:27017/&lt;dbName&gt;&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您跟我一樣是使用本機的 MongoDB ，請記得啟動您的 MongoDB 並且設定如下</p>
<blockquote>
<p>資料庫名稱即 <code>&lt;dbName&gt;</code> 的部分可以自行修改。</p>
</blockquote>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = &#123;</span><br><span class="line">  connection: <span class="string">&#x27;mongodb://localhost:27017/express-mongodb-passport-development&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>現在，我們已經完成前置作業，讓我們在 <code>app.js</code> 載人並使用 mongoose </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./db&#x27;</span>);</span><br><span class="line">mongoose.connect(config.connection);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在需要操作 db 的地方記得載入 Model</span></span><br></pre></td></tr></table></figure>

<h1 id="設定-passport"><a href="#設定-passport" class="headerlink" title="設定 passport"></a>設定 passport</h1><p>passport 本身只提供驗證機制，其他過程中如果需要功能像是 session 則是交給其他 Middleware。這邊我們則使用 <code>express-session</code> 來處理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i express-session -S</span><br></pre></td></tr></table></figure>

<p>安裝完之後我們開始在 <code>app.js</code> 中設定 passport</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> passport = <span class="built_in">require</span>(<span class="string">&#x27;passport&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> LocalStrategy = <span class="built_in">require</span>(<span class="string">&#x27;passport-local&#x27;</span>).Strategy</span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.use(session(&#123; </span><br><span class="line">  <span class="attr">secret</span>: <span class="string">&#x27;your secret key&#x27;</span>,</span><br><span class="line">  <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">false</span></span><br><span class="line">&#125;));</span><br><span class="line">app.use(passport.initialize())</span><br><span class="line">app.use(passport.session())</span><br></pre></td></tr></table></figure>

<p>加上 <code>session</code> 的設定是因為我們希望用戶登入後的相關資料可以透過 session 被保留且一致，所以我們才安裝了 <code>express-session</code> 來幫我們處理這部分。<br><code>LocalStrategy</code> 並不強制使用 session，我們也可以透過參數來關閉，但如果沒有使用 session 每一次<code>登入後資料不會自動保留</code>需要自己處理。</p>
<blockquote>
<p>概念：passport 可以 <code>use</code> 多個策略，接著只要在對應的路由使用 <code>passport.authenticate(&#39;&lt;strategy-name&gt;&#39;)</code> 即可。</p>
</blockquote>
<h1 id="序列化與反序列化-User-物件"><a href="#序列化與反序列化-User-物件" class="headerlink" title="序列化與反序列化 User 物件"></a>序列化與反序列化 User 物件</h1><p>序列化指的是一個轉換資料格式的過程。為了支援登入的 session，passport 需要把從 session 取得的資料轉換成帳號資料即 User 的物件實例。<br>因此後續的 request 請求將不會重複包含使用者的認證資訊。為了完成這個功能，passport 提供了兩個方法 <code>serializeUser</code> 和 <code>deserializeUser</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">passport.serializeUser(<span class="function"><span class="keyword">function</span> (<span class="params">user, done</span>) </span>&#123;</span><br><span class="line">  done(<span class="literal">null</span>, user._id);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">passport.deserializeUser(<span class="function"><span class="keyword">function</span> (<span class="params">id, done</span>) </span>&#123;</span><br><span class="line">  User.findById(id, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">    done(err, user);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>看完上面的程式碼，您應該理解了；passport 只把 <code>user._id</code> 存在 session，取回時在反序列化從資料庫找回 User 物件。</p>
<h1 id="使用-passport-驗證機制"><a href="#使用-passport-驗證機制" class="headerlink" title="使用 passport 驗證機制"></a>使用 passport 驗證機制</h1><h3 id="登入機制"><a href="#登入機制" class="headerlink" title="登入機制"></a>登入機制</h3><p>現在，我們終於要為登入和註冊行為定義 passport 的驗證機制。在<code>這個範例</code>中每個<code>驗證策略</code>或者說驗證邏輯比較通順，它們都是一個 passport 的 <code>Local Authentication Strategy</code> 物件，並可以使用 <code>passport.use()</code> 來套用。這裡我們要在加上一個函式庫 <code>connect-flash</code> 來協助我們處理呈現<code>動作結果的資訊</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = <span class="built_in">require</span>(<span class="string">&#x27;./models/user.js);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">passport.use(&#x27;</span>login<span class="string">&#x27;, new LocalStrategy(&#123;</span></span><br><span class="line"><span class="string">    passReqToCallback: true</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  function (req, username, password, done) &#123;</span></span><br><span class="line"><span class="string">    User.findOne(&#123; username: username &#125;, function (err, user) &#123;</span></span><br><span class="line"><span class="string">      if (err) &#123;</span></span><br><span class="line"><span class="string">        return done(err)</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      if (!user) &#123;</span></span><br><span class="line"><span class="string">        return done(null, false, req.flash(&#x27;</span>info<span class="string">&#x27;, &#x27;</span>User not found.<span class="string">&#x27;))</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      if (!isValidPassword(user, password)) &#123;</span></span><br><span class="line"><span class="string">        return done(null, false, req.flash(&#x27;</span>info<span class="string">&#x27;, &#x27;</span>Invalid password<span class="string">&#x27;))</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      return done(null, user)</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">));</span></span><br></pre></td></tr></table></figure>

<p><code>passport.use()</code> 的第一個參數是驗證機制的名稱，稍後這可以用來識別到底是哪一套機制。第二個參數是我們想建立的<code>策略</code>類型，這邊我們使用 <code>LocalStrategy</code>。值得注意的是預設 LocalStrategy 會在 Middleware 傳遞的過程中查找 <code>req.body</code> 和 <code>req.query</code> 的 <code>username</code> 和 <code>password</code> 來取得用戶認證的資訊，但我們也可以使用其他參數名稱。</p>
<p>其中 <code>passReqToCallback</code> 參數設定讓我們可以在後續 callback 中存取 <code>req</code> 物件。如果沒有的話，那麼預設 callback 參數會如下：</p>
<blockquote>
<p>注意 <code>*</code> 註解</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> LocalStrategy(&#123;</span><br><span class="line">  <span class="comment">// 使用其他參數名稱取得用戶認證的資訊</span></span><br><span class="line">  <span class="attr">usernameField</span>: <span class="string">&#x27;email&#x27;</span>,</span><br><span class="line">  <span class="attr">passwordField</span>: <span class="string">&#x27;passwd&#x27;</span>,</span><br><span class="line">  <span class="comment">// 關閉 session</span></span><br><span class="line">  <span class="attr">session</span>: <span class="literal">false</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">username, password, done</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//  * 沒有 passReqToCallback 的話，第一個參數就不是 req</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>詳細 passport-local 的參數與用法請參考<a target="_blank" rel="noopener" href="https://github.com/jaredhanson/passport-local">說明</a></p>
</blockquote>
<p>取得用戶帳密之後就是驗證的邏輯我們會在 callback 參數中處理這件事。下一步，我們將使用 mongoose 取得帳號資訊來驗證帳號是否正確。<br>而在 LocalStrategy 的 callback 中最後一個參數 <code>done</code> 就是我們用來告訴 passport 模組登入結果的方法，假如登入失敗那麼第一個參數需要傳入錯誤訊息，第二個參數則是 <code>false</code>。登入成功的話，第一個參數則傳入 <code>null</code>，第二個則是任何為 <code>真</code> 的值，這個值會被加到 <code>req</code> 物件上以便我們後續使用。</p>
<p>接著，基於存放在 MongoDB 用戶資料的安全性考量，我們應該在儲存之前先將密碼加密。要完成這個需求我們需要使用加解密的函式庫。本文使用 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/bcrypt-nodejs">bcrypt-nodejs</a>，如果您有習慣的函式庫也可以使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i bcrypt-nodejs -S</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isValidPassword = <span class="function"><span class="keyword">function</span> (<span class="params">user, password</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> bcrypt.compareSync(password, user.password)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>讓我們先來看看目前完成的 <code>app.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> favicon = <span class="built_in">require</span>(<span class="string">&#x27;serve-favicon&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> passport = <span class="built_in">require</span>(<span class="string">&#x27;passport&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> LocalStrategy = <span class="built_in">require</span>(<span class="string">&#x27;passport-local&#x27;</span>).Strategy;</span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> flash = <span class="built_in">require</span>(<span class="string">&#x27;connect-flash&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcrypt-nodejs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// DB</span></span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./db&#x27;</span>);</span><br><span class="line">mongoose.connect(config.connection);</span><br><span class="line"></span><br><span class="line">passport.serializeUser(<span class="function"><span class="keyword">function</span> (<span class="params">user, done</span>) </span>&#123;</span><br><span class="line">  done(<span class="literal">null</span>, user._id);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">passport.deserializeUser(<span class="function"><span class="keyword">function</span> (<span class="params">id, done</span>) </span>&#123;</span><br><span class="line">  User.findById(id, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">    done(err, user);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">passport.use(<span class="string">&#x27;login&#x27;</span>, <span class="keyword">new</span> LocalStrategy(&#123;</span><br><span class="line">    <span class="attr">passReqToCallback</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">req, username, password, done</span>) </span>&#123;</span><br><span class="line">    User.findOne(&#123; <span class="attr">username</span>: username &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> done(err)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">        <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>, req.flash(<span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;User not found.&#x27;</span>))</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> isValidPassword = <span class="function"><span class="keyword">function</span> (<span class="params">user, password</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bcrypt.compareSync(password, user.password)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!isValidPassword(user, password)) &#123;</span><br><span class="line">        <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>, req.flash(<span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;Invalid password&#x27;</span>))</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> done(<span class="literal">null</span>, user)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> index = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// view engine setup</span></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, path.join(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;jade&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// uncomment after placing your favicon in /public</span></span><br><span class="line"><span class="comment">//app.use(favicon(path.join(__dirname, &#x27;public&#x27;, &#x27;favicon.ico&#x27;)));</span></span><br><span class="line">app.use(logger(<span class="string">&#x27;dev&#x27;</span>));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(cookieParser());</span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">  <span class="attr">secret</span>: <span class="string">&#x27;your secret key&#x27;</span>,</span><br><span class="line">  <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">false</span></span><br><span class="line">&#125;));</span><br><span class="line">app.use(passport.initialize());</span><br><span class="line">app.use(passport.session());</span><br><span class="line">app.use(flash());</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/&#x27;</span>, index);</span><br><span class="line"></span><br><span class="line"><span class="comment">// catch 404 and forward to error handler</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> err = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Not Found&#x27;</span>);</span><br><span class="line">  err.status = <span class="number">404</span>;</span><br><span class="line">  next(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// error handler</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// set locals, only providing error in development</span></span><br><span class="line">  res.locals.message = err.message;</span><br><span class="line">  res.locals.error = req.app.get(<span class="string">&#x27;env&#x27;</span>) === <span class="string">&#x27;development&#x27;</span> ? err : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// render the error page</span></span><br><span class="line">  res.status(err.status || <span class="number">500</span>);</span><br><span class="line">  res.render(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = app;</span><br></pre></td></tr></table></figure>

<h1 id="註冊機制"><a href="#註冊機制" class="headerlink" title="註冊機制"></a>註冊機制</h1><p>我們定義好登入部分的機制了，接著我們要定義下一個機制來處理新的使用者註冊帳號的部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passport.use(<span class="string">&#x27;signup&#x27;</span>, <span class="keyword">new</span> LocalStrategy(&#123;</span><br><span class="line">  <span class="attr">passReqToCallback</span>: <span class="literal">true</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">req, username, password, done</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> findOrCreateUser = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    User.findOne(&#123; <span class="attr">username</span>: username &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> done(err);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (user) &#123;</span><br><span class="line">        <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>, req.flash(<span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;User already exists&#x27;</span>));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> newUser = <span class="keyword">new</span> User();</span><br><span class="line">        newUser.username = username;</span><br><span class="line">        newUser.password = bcrypt.hashSync(password, bcrypt.genSaltSync(<span class="number">10</span>), <span class="literal">null</span>);</span><br><span class="line">        newUser.email = req.params.email;</span><br><span class="line">        newUser.firstname = req.params.firstname;</span><br><span class="line">        newUser.lastname = req.params.lastname;</span><br><span class="line"></span><br><span class="line">        newUser.save(<span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">throw</span> err;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> done(<span class="literal">null</span>, user);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  process.nextTick(findOrCreateUser)</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>再一次我們使用 mongoose 來查詢看看是否有使用者已經註冊了一樣的 username 。如果沒有那麼我們就建立新的帳號，否則就返回一個錯誤訊息。</p>
<h1 id="建立路由"><a href="#建立路由" class="headerlink" title="建立路由"></a>建立路由</h1><p>讓我們先來看看這個程式的流程圖</p>
<p><img src="https://cms-assets.tutsplus.com/uploads/users/388/posts/21619/image/Bird_Eye_View_of_PassportJS_App.png"></p>
<p>完成登入和註冊的邏輯定義之後，我們要來撰寫路由。預設 express generator 將路由抽離成一個個模組，我們已經刪除了 <code>routes/users.js</code>。為了讓 <code>routes/idnex.js</code> 裡的路由能夠使用剛剛上面定義在 <code>app.js</code> 的 passport 物件，我們將改寫一下 <code>routes/index.js</code> 如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">passport</span>) </span>&#123;</span><br><span class="line">  router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">message</span>: req.flash(<span class="string">&#x27;info&#x27;</span>) &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  router.post(<span class="string">&#x27;/signin&#x27;</span>, passport.authenticate(<span class="string">&#x27;login&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">successRedirect</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    <span class="attr">failureRedirect</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">failureFlash</span>: <span class="literal">true</span></span><br><span class="line">  &#125;));</span><br><span class="line"></span><br><span class="line">  router.get(<span class="string">&#x27;/signup&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">&#x27;signup&#x27;</span>, &#123; <span class="attr">message</span>: req.flash(<span class="string">&#x27;info&#x27;</span>) &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  router.post(<span class="string">&#x27;/signup&#x27;</span>, passport.authenticate(<span class="string">&#x27;signup&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">successRedirect</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    <span class="attr">failureRedirect</span>: <span class="string">&#x27;/signup&#x27;</span>,</span><br><span class="line">    <span class="attr">failureFlash</span>: <span class="literal">true</span></span><br><span class="line">  &#125;));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> router;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面程式碼中最重要的部分就是：當 HTTP 發出 POST 的請求給 <code>login</code> 和 <code>signup</code> 時分別使用 <code>passport.authenticate()</code> 搭配對應的機制(login，signup)來處理。</p>
<p>注意到路由並不需要強制跟驗證機制模組的名稱一樣。</p>
<p>假如您還需要在驗證過程中加入其他處理，則可使用下面這種寫法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/signin&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  passport.authenticate(<span class="string">&#x27;login&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, user, info</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// handle youself</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="comment">// handle youself</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    req.login(user, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> next(err)</span><br><span class="line">      &#125;</span><br><span class="line">      req.flash(<span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;Sign in successfully&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;)(req, res, next)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="樣板"><a href="#樣板" class="headerlink" title="樣板"></a>樣板</h1><p>接著我們需要調整 views 的部分，我們總共需要註冊 <code>signup</code>，登入 <code>index</code>，後續需要登入驗證的頁面 <code>home</code>，以及調整我們的 <code>layout</code>。</p>
<ul>
<li><code>layout.jade</code> </li>
<li><code>index.jade</code> 登入頁</li>
<li><code>signup.jade</code> 註冊頁</li>
<li><code>home.jade</code> </li>
</ul>
<h3 id="layout-jade"><a href="#layout-jade" class="headerlink" title="layout.jade"></a><code>layout.jade</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">    title= title</span><br><span class="line">    link(rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css&quot; integrity=&quot;sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ&quot; crossorigin=&quot;anonymous&quot;)</span><br><span class="line">    script(src=&quot;https://code.jquery.com/jquery-3.1.1.slim.min.js&quot; integrity=&quot;sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n&quot; crossorigin=&quot;anonymous&quot;)</span><br><span class="line">    script(src=&quot;https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js&quot; integrity=&quot;sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb&quot; crossorigin=&quot;anonymous&quot;)</span><br><span class="line">    script(src=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js&quot; integrity=&quot;sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn&quot; crossorigin=&quot;anonymous&quot;)</span><br><span class="line">    link(rel=&#x27;stylesheet&#x27;, href=&#x27;/stylesheets/style.css&#x27;)</span><br><span class="line">  body</span><br><span class="line">    block content</span><br></pre></td></tr></table></figure>

<h3 id="index-jade"><a href="#index-jade" class="headerlink" title="index.jade"></a><code>index.jade</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">extends layout</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">  div(class=&quot;container&quot;)</span><br><span class="line">    div(class=&quot;col-md-4 offset-md-4&quot;)</span><br><span class="line">      h1(class=&quot;text-center login-title&quot;) Sign In</span><br><span class="line">      div(class=&quot;card&quot;)</span><br><span class="line">        div(class=&quot;card-blcok&quot;)</span><br><span class="line">          form(action=&quot;/signin&quot; method=&quot;post&quot;)</span><br><span class="line">            input(type=&quot;text&quot; name=&quot;username&quot; class=&quot;form-control&quot; placeholder=&quot;Email&quot; required=&quot;true&quot; autofocus)</span><br><span class="line">            input(type=&quot;password&quot; name=&quot;password&quot; class=&quot;form-control&quot; placeholder=&quot;Password&quot; required=&quot;true&quot;)</span><br><span class="line">            button(class=&quot;btn btn-primary btn-block&quot; type=&quot;submit&quot;) Sign In</span><br><span class="line">            span(class=&quot;clearfix&quot;)</span><br><span class="line">            if message.length</span><br><span class="line">              div(id=&quot;message&quot;)</span><br><span class="line">                  div(class=&quot;alert alert-danger text-center&quot;) #&#123;message&#125;</span><br></pre></td></tr></table></figure>

<h3 id="signup-jade"><a href="#signup-jade" class="headerlink" title="signup.jade"></a><code>signup.jade</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">extends layout</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">  div(class=&quot;container&quot;)</span><br><span class="line">    div(class=&quot;col-md-4 offset-md-4&quot;)</span><br><span class="line">      h1(class=&quot;text-center login-title&quot;) Sign Up</span><br><span class="line">      div(class=&quot;card&quot;)</span><br><span class="line">        div(class=&quot;card-blcok&quot;)</span><br><span class="line">          form(action=&quot;/signup&quot; method=&quot;post&quot;)</span><br><span class="line">            input(type=&quot;text&quot; name=&quot;username&quot; class=&quot;form-control&quot; placeholder=&quot;Email&quot; required=&quot;true&quot; autofocus)</span><br><span class="line">            input(type=&quot;password&quot; name=&quot;password&quot; class=&quot;form-control&quot; placeholder=&quot;Password&quot; required=&quot;true&quot;)</span><br><span class="line">            button(class=&quot;btn btn-primary btn-block&quot; type=&quot;submit&quot;) Sign In</span><br><span class="line">            span(class=&quot;clearfix&quot;)</span><br><span class="line">            if message.length</span><br><span class="line">              div(id=&quot;message&quot;)</span><br><span class="line">                  div(class=&quot;alert alert-danger text-center&quot;) #&#123;message&#125; </span><br></pre></td></tr></table></figure>

<h3 id="home-jade"><a href="#home-jade" class="headerlink" title="home.jade"></a><code>home.jade</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">extends layout</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">  div(class=&quot;container&quot;)</span><br><span class="line">    div(class=&quot;row&quot;)</span><br><span class="line">      div(class=&quot;col-12&quot;)</span><br><span class="line">        p(class=&quot;alert alert-primary&quot;) This is page will protected by passport.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>基於商標因素 jade 樣板引擎已<a target="_blank" rel="noopener" href="https://github.com/pugjs/pug/issues/2184">改名為 pug</a>，雖然目前仍然支援但官方已警告 <code>deprecated</code> 建議更換為 pug。</p>
</blockquote>
<h1 id="登出"><a href="#登出" class="headerlink" title="登出"></a>登出</h1><p>passport 作爲一個 Middleware 它是具備加入屬性和方法到 <code>req</code> 和 <code>res</code> 物件的能力的。為了方便使用，它加了 <code>req.logout()</code> 這個方法讓我們可以將使用者存在 session 的資料作廢。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/signout&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  req.logout()</span><br><span class="line">  res.redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="驗證存取權限"><a href="#驗證存取權限" class="headerlink" title="驗證存取權限"></a>驗證存取權限</h1><p>passport 也賦予我們控制存取權限的能力，用來保護不能匿名存取的路由。從這個例子來說就是；當使用者沒有登入的情況下是無法存取 <code>http://localhost:3000/home</code> 我們會將他們導向登入或其他公開的頁面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">authenticated</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (req.isAuthenticated()) &#123;</span><br><span class="line">    <span class="keyword">return</span> next()</span><br><span class="line">  &#125;</span><br><span class="line">  res.redirect(<span class="string">&#x27;/)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">router.get(&#x27;</span>/home<span class="string">&#x27;, authenticated, function (req, res, next) &#123;</span></span><br><span class="line"><span class="string">  res.render(&#x27;</span>home<span class="string">&#x27;, &#123; user: req.user &#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>

<h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>歸納來說，passport 這個 Middleware 會在整個 request 的過程中幫我們處理<code>驗證流程</code>，透過使用 <code>策略</code> 決定是否登入成功。在本例子中後續 Middleware 的 <code>req</code> 物件中我們就可以取得 <code>req.isAuthenticated()</code> 和 <code>req.user</code>。由於驗證是否登入可能會有很多路由需要使用，故上面我們將這部分抽成一個 Middleware function 方便後續使用。</p>
<p>另外關於 Node.js 世界的驗證套件 ， passport 並不是這個領域唯一的函式庫，還有像是 <code>everyauth</code> 等的函式庫。不過在社群支援度，模組化等部分的確相對優秀，這也是為什麼我們選擇 passport。</p>
<p>關於詳細的比較您可以參考<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/11974947/everyauth-vs-passport-js">everyauth vs passport</a>。</p>
<h1 id="參考資源"><a href="#參考資源" class="headerlink" title="參考資源"></a>參考資源</h1><ul>
<li><a target="_blank" rel="noopener" href="https://code.tutsplus.com/tutorials/authenticating-nodejs-applications-with-passport--cms-21619">Authenticating Node.js Applications With Passport</a></li>
<li><a target="_blank" rel="noopener" href="https://nodejust.com/nodejs-passport-auth-tutorial/">Node.js 身份認證：Passport 入門</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>使用 Passport 實作 Nodejs 應用程式驗證機制</p><p><a href="https://andyyou.github.io/2017/04/11/express-passport/">https://andyyou.github.io/2017/04/11/express-passport/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>andyyou(YOU,ZONGYAN)</p></div></div><div class="level-item is-narrow"><div><h6>發表於</h6><p>2017-04-11</p></div></div><div class="level-item is-narrow"><div><h6>更新於</h6><p>2023-05-12</p></div></div><div class="level-item is-narrow"><div><h6>許可協議</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/javascript-express-passport/">javascript express passport</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜歡這篇文章嗎? 贊助一下作者吧!</h3><div class="buttons is-centered"><a class="button donate" href="https://www.buymeacoffee.com/andyyou" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2017/05/22/better-json-through-stream/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">[譯] 使用 stream 的方式處理 JSON 傳輸</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2017/04/02/svg-coordinate-3/"><span class="level-item">[譯] 理解 SVG 座標系統與 Transformation - 3 建立 viewpor</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars2.githubusercontent.com/u/665690?v=3&amp;s=466" alt="andyou"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">andyou</p><p class="is-size-6 is-block">DEVLOG of andyyou</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Taipei</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">215</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分類</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">標籤</p><a href="/tags"><p class="title">88</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/andyyou" target="_blank" rel="noopener">追蹤</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/andyyou"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="/"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="/"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="/"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分類</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Cloud/"><span class="level-start"><span class="level-item">Cloud</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Fun/"><span class="level-start"><span class="level-item">Fun</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Mobile/"><span class="level-start"><span class="level-item">Mobile</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Program/"><span class="level-start"><span class="level-item">Program</span></span><span class="level-end"><span class="level-item tag">152</span></span></a></li><li><a class="level is-mobile" href="/categories/System/"><span class="level-start"><span class="level-item">System</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Tools/"><span class="level-start"><span class="level-item">Tools</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/UX/"><span class="level-start"><span class="level-item">UX</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-12T01:09:12.000Z">2023-04-12</time></p><p class="title"><a href="/2023/04/12/gke-quick-guide/">[譯]部署應用程式到 GKE 叢集</a></p><p class="categories"><a href="/categories/Cloud/">Cloud</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-12T01:05:40.000Z">2023-04-12</time></p><p class="title"><a href="/2023/04/12/fail2ban-quick-guide/">防禦 DDoS - 限制 IP 時間內大量請求 Nginx + fail2ban</a></p><p class="categories"><a href="/categories/System/">System</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-01-21T15:20:36.000Z">2023-01-21</time></p><p class="title"><a href="/2023/01/21/all-you-need-to-know-about-react-concurrent/">(譯) 關於 React 併發功能與 Suspense 您所需要了解的事</a></p><p class="categories"><a href="/categories/Program/">Program</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-01-12T10:11:53.000Z">2023-01-12</time></p><p class="title"><a href="/2023/01/12/deploy-nextjs-to-cloud-run-with-gitlab-ci/">2023 部署 Next.js 至 Google Cloud Run (混搭 Cloud Build, Gitlab CI, Secret Manager)</a></p><p class="categories"><a href="/categories/Cloud/">Cloud</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-08-17T07:24:36.000Z">2022-08-17</time></p><p class="title"><a href="/2022/08/17/avoiding-use-effect-with-callback-refs/">使用 Callback Refs 取代 useEffect 避免問題產生</a></p><p class="categories"><a href="/categories/Program/">Program</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">彙整</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">十一月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">六月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">三月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">十二月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">十一月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">十月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">九月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">八月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">七月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">六月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">五月 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">四月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/02/"><span class="level-start"><span class="level-item">二月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">一月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">十二月 2016</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">十一月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">十月 2016</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/09/"><span class="level-start"><span class="level-item">九月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/08/"><span class="level-start"><span class="level-item">八月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/06/"><span class="level-start"><span class="level-item">六月 2016</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/05/"><span class="level-start"><span class="level-item">五月 2016</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/04/"><span class="level-start"><span class="level-item">四月 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/03/"><span class="level-start"><span class="level-item">三月 2016</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">二月 2016</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/01/"><span class="level-start"><span class="level-item">一月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/12/"><span class="level-start"><span class="level-item">十二月 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/11/"><span class="level-start"><span class="level-item">十一月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/10/"><span class="level-start"><span class="level-item">十月 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/09/"><span class="level-start"><span class="level-item">九月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/08/"><span class="level-start"><span class="level-item">八月 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">七月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/05/"><span class="level-start"><span class="level-item">五月 2015</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">四月 2015</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/12/"><span class="level-start"><span class="level-item">十二月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/11/"><span class="level-start"><span class="level-item">十一月 2014</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/10/"><span class="level-start"><span class="level-item">十月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/09/"><span class="level-start"><span class="level-item">九月 2014</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/08/"><span class="level-start"><span class="level-item">八月 2014</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/02/"><span class="level-start"><span class="level-item">二月 2014</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/01/"><span class="level-start"><span class="level-item">一月 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/11/"><span class="level-start"><span class="level-item">十一月 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/10/"><span class="level-start"><span class="level-item">十月 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/09/"><span class="level-start"><span class="level-item">九月 2013</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/08/"><span class="level-start"><span class="level-item">八月 2013</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/03/"><span class="level-start"><span class="level-item">三月 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/03/"><span class="level-start"><span class="level-item">三月 2012</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/01/"><span class="level-start"><span class="level-item">一月 2012</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2011/11/"><span class="level-start"><span class="level-item">十一月 2011</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">標籤</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/net-mvc/"><span class="tag">.net mvc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RoR/"><span class="tag">RoR</span><span class="tag">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/api/"><span class="tag">api</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aws/"><span class="tag">aws</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azure/"><span class="tag">azure</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bot/"><span class="tag">bot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bundler/"><span class="tag">bundler</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cache/"><span class="tag">cache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/carrier-wave/"><span class="tag">carrier wave</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/centos/"><span class="tag">centos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chrome/"><span class="tag">chrome</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloudflare/"><span class="tag">cloudflare</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/compass/"><span class="tag">compass</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag">19</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cve/"><span class="tag">cve</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devise/"><span class="tag">devise</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dnd/"><span class="tag">dnd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/e-invoice/"><span class="tag">e-invoice</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/entity-framework/"><span class="tag">entity framework</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/envoy/"><span class="tag">envoy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/es6/"><span class="tag">es6</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/facebook/"><span class="tag">facebook</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flux/"><span class="tag">flux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/framework/"><span class="tag">framework</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gcp/"><span class="tag">gcp</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gitlab/"><span class="tag">gitlab</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/grunt/"><span class="tag">grunt</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gulp/"><span class="tag">gulp</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/heroku/"><span class="tag">heroku</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/html/"><span class="tag">html</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iisexpress/"><span class="tag">iisexpress</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ios/"><span class="tag">ios</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag">84</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript-express-passport/"><span class="tag">javascript express passport</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript-nodejs/"><span class="tag">javascript nodejs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jekyll/"><span class="tag">jekyll</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jetstream/"><span class="tag">jetstream</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jspm/"><span class="tag">jspm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jwt/"><span class="tag">jwt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/laravel/"><span class="tag">laravel</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/letsencrypt/"><span class="tag">letsencrypt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mechanism/"><span class="tag">mechanism</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/oocss/"><span class="tag">oocss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/osx/"><span class="tag">osx</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/package-manager/"><span class="tag">package manager</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php/"><span class="tag">php</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgres/"><span class="tag">postgres</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgresql/"><span class="tag">postgresql</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/queue/"><span class="tag">queue</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rabbitmq/"><span class="tag">rabbitmq</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rack-server/"><span class="tag">rack server</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rails/"><span class="tag">rails</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rails-webpack-stimulus-javascript-bootstrap/"><span class="tag">rails webpack stimulus javascript bootstrap</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/raspberry-pi/"><span class="tag">raspberry-pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reactjs/"><span class="tag">reactjs</span><span class="tag">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redux/"><span class="tag">redux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ruby/"><span class="tag">ruby</span><span class="tag">18</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sass/"><span class="tag">sass</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/selenium/"><span class="tag">selenium</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/serial-port/"><span class="tag">serial-port</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/slim/"><span class="tag">slim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssl/"><span class="tag">ssl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/stimulus/"><span class="tag">stimulus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/svg-javascript/"><span class="tag">svg javascript</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/task-runner/"><span class="tag">task runner</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tmux/"><span class="tag">tmux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tools/"><span class="tag">tools</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ux/"><span class="tag">ux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vm/"><span class="tag">vm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vue/"><span class="tag">vue</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vuejs/"><span class="tag">vuejs</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webpack/"><span class="tag">webpack</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wsl/"><span class="tag">wsl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xml/"><span class="tag">xml</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zoom/"><span class="tag">zoom</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">廣告</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3038600205998182" data-ad-slot="6442659171" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="DEVLOG of andyyou" height="28"></a><p class="is-size-7"><span>&copy; 2023 andyyou(YOU,ZONGYAN)</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/andyyou/"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-TW");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到頁首" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="請輸入關鍵字..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"請輸入關鍵字...","untitled":"(無標題)","posts":"文章","pages":"頁面","categories":"分類","tags":"標籤"});
        });</script></body></html>