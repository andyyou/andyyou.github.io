<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>React Native å¯¦ä½œ iOS Live Activity - DEVLOG of andyyou</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="DEVLOG of andyyou"><meta name="msapplication-TileImage" content="/img/faicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="DEVLOG of andyyou"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Live Activityç°¡å–®çš„èªª iOS Live Activity è®“æˆ‘å€‘å¯ä»¥é¡¯ç¤ºä¸€äº›ç•¶å‰çš„å³æ™‚è³‡æ–™è€Œä¸ç”¨é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼ï¼Œé¡¯è‘—çš„æå‡ç”¨æˆ¶é«”é©—ã€‚é¦–æ¬¡æ”¯æ´æ˜¯åœ¨ iOS 16.1 å’Œ iPadOS 17 ï¼Œé‡é»æ˜¯å¯ä»¥åœ¨é–å®šè¢å¹•ã€å¾…æ©Ÿç•«é¢ã€ä»¥åŠå‹•æ…‹å³¶å³ä½¿æ›´æ–°é¡¯ç¤ºè³‡è¨Šï¼Œæ¸›å°‘åè¦†é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼çš„æ¬¡æ•¸ã€‚  Lock Screen é–å®šè¢å¹• - å–šé†’ iPhone æ™‚çœ‹åˆ°çš„ç•«é¢ï¼Œé€™è£¡å¯ä»¥é¡¯ç¤ºé€šçŸ¥ Push Not"><meta property="og:type" content="article"><meta property="og:title" content="DEVLOG of andyyou"><meta property="og:url" content="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/"><meta property="og:site_name" content="DEVLOG of andyyou"><meta property="og:description" content="Live Activityç°¡å–®çš„èªª iOS Live Activity è®“æˆ‘å€‘å¯ä»¥é¡¯ç¤ºä¸€äº›ç•¶å‰çš„å³æ™‚è³‡æ–™è€Œä¸ç”¨é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼ï¼Œé¡¯è‘—çš„æå‡ç”¨æˆ¶é«”é©—ã€‚é¦–æ¬¡æ”¯æ´æ˜¯åœ¨ iOS 16.1 å’Œ iPadOS 17 ï¼Œé‡é»æ˜¯å¯ä»¥åœ¨é–å®šè¢å¹•ã€å¾…æ©Ÿç•«é¢ã€ä»¥åŠå‹•æ…‹å³¶å³ä½¿æ›´æ–°é¡¯ç¤ºè³‡è¨Šï¼Œæ¸›å°‘åè¦†é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼çš„æ¬¡æ•¸ã€‚  Lock Screen é–å®šè¢å¹• - å–šé†’ iPhone æ™‚çœ‹åˆ°çš„ç•«é¢ï¼Œé€™è£¡å¯ä»¥é¡¯ç¤ºé€šçŸ¥ Push Not"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-1.webp"><meta property="og:image" content="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-2.webp"><meta property="og:image" content="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-3.webp"><meta property="og:image" content="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-4.webp"><meta property="og:image" content="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-5.webp"><meta property="og:image" content="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-6.webp"><meta property="og:image" content="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-7.png"><meta property="article:published_time" content="2024-10-28T09:04:56.000Z"><meta property="article:modified_time" content="2025-10-16T02:57:35.141Z"><meta property="article:author" content="andyyou"><meta property="article:tag" content="react-native"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="la-1.webp"><meta property="fb:app_id" content="450470251782295"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/"},"headline":"React Native å¯¦ä½œ iOS Live Activity","image":["https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-1.webp","https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-2.webp","https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-3.webp","https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-4.webp","https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-5.webp","https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-6.webp","https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/la-7.png"],"datePublished":"2024-10-28T09:04:56.000Z","dateModified":"2025-10-16T02:57:35.141Z","author":{"@type":"Person","name":"https://avatars2.githubusercontent.com/u/665690?v=3&s=466"},"publisher":{"@type":"Organization","name":"DEVLOG of andyyou","logo":{"@type":"ImageObject","url":"https://andyyou.github.io/img/logo.png"}},"description":"Live Activityç°¡å–®çš„èªª iOS Live Activity è®“æˆ‘å€‘å¯ä»¥é¡¯ç¤ºä¸€äº›ç•¶å‰çš„å³æ™‚è³‡æ–™è€Œä¸ç”¨é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼ï¼Œé¡¯è‘—çš„æå‡ç”¨æˆ¶é«”é©—ã€‚é¦–æ¬¡æ”¯æ´æ˜¯åœ¨ iOS 16.1 å’Œ iPadOS 17 ï¼Œé‡é»æ˜¯å¯ä»¥åœ¨é–å®šè¢å¹•ã€å¾…æ©Ÿç•«é¢ã€ä»¥åŠå‹•æ…‹å³¶å³ä½¿æ›´æ–°é¡¯ç¤ºè³‡è¨Šï¼Œæ¸›å°‘åè¦†é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼çš„æ¬¡æ•¸ã€‚  Lock Screen é–å®šè¢å¹• - å–šé†’ iPhone æ™‚çœ‹åˆ°çš„ç•«é¢ï¼Œé€™è£¡å¯ä»¥é¡¯ç¤ºé€šçŸ¥ Push Not"}</script><link rel="canonical" href="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-C93NK5NEGP" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-C93NK5NEGP');</script><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><script data-ad-client="ca-pub-3038600205998182" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="DEVLOG of andyyou" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/andyyou"><i class="fab fa-github"></i></a><a class="navbar-item search" title="æœå°‹" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-10-28T09:04:56.000Z" title="10/28/2024, 5:04:56 PM">2024-10-28</time>ç™¼è¡¨</span><span class="level-item"><time dateTime="2025-10-16T02:57:35.141Z" title="10/16/2025, 10:57:35 AM">2025-10-16</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/Program/">Program</a></span><span class="level-item">1 å°æ™‚è®€å®Œ (å¤§ç´„9163å€‹å­—)</span></div></div><h1 class="title is-3 is-size-4-mobile">React Native å¯¦ä½œ iOS Live Activity</h1><div class="content"><h2 id="Live-Activity"><a href="#Live-Activity" class="headerlink" title="Live Activity"></a>Live Activity</h2><p>ç°¡å–®çš„èªª iOS Live Activity è®“æˆ‘å€‘å¯ä»¥é¡¯ç¤ºä¸€äº›ç•¶å‰çš„å³æ™‚è³‡æ–™è€Œä¸ç”¨é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼ï¼Œé¡¯è‘—çš„æå‡ç”¨æˆ¶é«”é©—ã€‚é¦–æ¬¡æ”¯æ´æ˜¯åœ¨ iOS 16.1 å’Œ iPadOS 17 ï¼Œé‡é»æ˜¯å¯ä»¥åœ¨é–å®šè¢å¹•ã€å¾…æ©Ÿç•«é¢ã€ä»¥åŠå‹•æ…‹å³¶å³ä½¿æ›´æ–°é¡¯ç¤ºè³‡è¨Šï¼Œæ¸›å°‘åè¦†é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼çš„æ¬¡æ•¸ã€‚</p>
<ul>
<li>Lock Screen é–å®šè¢å¹• - å–šé†’ iPhone æ™‚çœ‹åˆ°çš„ç•«é¢ï¼Œé€™è£¡å¯ä»¥é¡¯ç¤ºé€šçŸ¥ Push Notification å’Œ Live Activityã€‚</li>
<li>Stand By æ˜¯ iOS 17 çš„æ™‚å€™åŠ å…¥çš„ï¼Œåœ¨å……é›»æ™‚å¯ä»¥é¡¯ç¤ºçš„å€å¡Šã€‚</li>
<li>Dynamic Island å‹•æ…‹å³¶å‰‡æ˜¯ iPhone 14 Pro é–‹å§‹æ–°å¢çš„åŠŸèƒ½ã€‚</li>
</ul>
<p>é€²ä¸€æ­¥æˆ‘å€‘é‡æ¸…åœ¨ iOS 14 åŠ å…¥çš„ Widget å’Œ Live Activity çš„å·®åˆ¥ã€‚Live Activity ä»¥æä¾›å³æ™‚è³‡è¨Šç‚ºæ ¸å¿ƒä¾‹å¦‚è¿½è¹¤æŸå€‹äº‹ä»¶çš„ç‹€æ…‹ï¼Œæ¯”è³½åˆ†æ•¸ã€Uber å¸æ©Ÿæ˜¯å¦æŠµé”ç­‰è³‡è¨Šã€‚Widget æ¯”è¼ƒåˆé©çš„æƒ…å¢ƒæ˜¯æä¾›è·ŸçŸ­æ™‚é–“å³æ™‚æ€§æ¯”è¼ƒæ²’æœ‰é‚£éº¼å¼·çƒˆé—œä¿‚çš„è³‡æ–™ä¾‹å¦‚å¤©æ°£ç­‰ã€‚</p>
<span id="more"></span>

<h2 id="å»ºç½®ç¬¬ä¸€å€‹-Live-Activity"><a href="#å»ºç½®ç¬¬ä¸€å€‹-Live-Activity" class="headerlink" title="å»ºç½®ç¬¬ä¸€å€‹ Live Activity"></a>å»ºç½®ç¬¬ä¸€å€‹ Live Activity</h2><p>åœ¨ React Native å°ˆæ¡ˆè¦æ”¯æ´ Live Activity æˆ‘å€‘ç„¡æ³•é¿å…æœƒéœ€è¦æ›´å¤šåŸç”Ÿé–‹ç™¼çš„çŸ¥è­˜ï¼Œå¾ŒçºŒæˆ‘å€‘æœƒé€æ­¥æ•™å­¸ã€‚</p>
<ol>
<li>å»ºç«‹å°ˆæ¡ˆ</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npx @react-native-community/cli init Timer</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>å»ºç«‹ Widget Extension</p>
<ol>
<li>ä½¿ç”¨ Xcode é–‹å•Ÿå°ˆæ¡ˆ<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ open ios/Timer.xcworkspace</span><br></pre></td></tr></table></figure></li>
<li>File &gt; New &gt; Target é¸æ“‡ Widget Extension</li>
<li>è¼¸å…¥ Widget åç¨±ã€ŒTimerWidgetã€</li>
<li>å‹¾é¸ã€ŒInclude Live Activityã€ï¼Œå–æ¶ˆã€ŒInclude Configuration App Intentã€</li>
<li>é»æ“Šå®Œæˆ</li>
<li>é»æ“Šã€ŒActivateã€Extension scheme</li>
</ol>
</li>
<li><p>ç‚ºäº†ç°¡åŒ–æˆ‘å€‘çš„å¯¦ä½œç¯„ä¾‹ï¼Œå°‡ Project çš„ã€ŒiOS Deployment Targetã€èª¿æ•´ç‚º 17.2ã€‚Targets åº•ä¸‹æˆ‘å€‘çš„æ‡‰ç”¨ã€ŒMinimum Deploymentsã€ä¹Ÿèª¿æ•´æˆ 17.2ã€‚è‹¥éœ€è¦é‡å°ç‰¹å®šç‰ˆæœ¬åŸ·è¡Œå°æ‡‰æ“ä½œå‰‡åƒè€ƒ<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/xcode/running-code-on-a-specific-version/">å®˜æ–¹èªªæ˜</a></p>
</li>
<li><p><code>Info.plist</code> è¨­å®šã€ŒSupports Live Activitiesã€ç‚º YES</p>
</li>
<li><p>åˆªé™¤ <code>TimerWidget.swift</code></p>
</li>
<li><p>æ›´æ–° <code>TimerWidgetBundle.swift</code> ç§»é™¤ <code>TimerWidget()</code></p>
</li>
<li><p>é è¦½</p>
<ol>
<li>é–‹å•Ÿ <code>TimerWidgetLiveActivity.swift</code></li>
<li>åœ¨å³é‚Šå€å¡Šé»æ“Šåˆ·æ–°åœ–ç¤º</li>
<li>é€™å€‹å‹•ä½œæœƒé–‹å§‹å»ºç½®æµç¨‹</li>
<li>ä¸€æ—¦å»ºç½®å®Œæˆæ¨¡æ“¬å™¨æœƒé¡¯ç¤º Live Activity</li>
<li>å¦‚æœé‡åˆ°é€¾æ™‚éŒ¯èª¤å¯ä»¥åŸ·è¡Œ <code>xcrun simctl --set previews delete all</code></li>
</ol>
</li>
</ol>
<h2 id="èªè­˜-iOS-Target"><a href="#èªè­˜-iOS-Target" class="headerlink" title="èªè­˜ iOS Target"></a>èªè­˜ iOS Target</h2><p>åœ¨æ·±å…¥ä¹‹å‰ï¼Œè®“æˆ‘å€‘ä¾†ç­è§£ä¸€ä¸‹ä½•è¬‚ iOS Targetï¼Œé‡æ¸…ä¸€äº›è¡“èªã€‚åœ¨ iOS é–‹ç™¼ä¸­ï¼Œä¸€å€‹ Target æœ¬è³ªä¸Šæ˜¯ä¸€ç³»åˆ—çš„è¨­å®šå’Œæª”æ¡ˆï¼Œå¦‚é‚£äº›æª”æ¡ˆéœ€è¦ç·¨è­¯ã€é€£çµæ–¹æ³•ç­‰ã€‚å¯ä»¥æŠŠ Target ç•¶æˆå°ˆæ¡ˆä¸­ç¨ç«‹çš„ç”¢å“æˆ–å…ƒä»¶ã€‚Target çš„é¡å‹åŒ…å«ï¼š</p>
<ul>
<li>æ‡‰ç”¨ç¨‹å¼</li>
<li>æ¸¬è©¦</li>
<li>æ¡†æ¶æˆ–å‡½å¼åº«</li>
<li>æ“´å……æ’ä»¶ Extension</li>
</ul>
<h2 id="Swift-UI-æ¦‚å¿µ"><a href="#Swift-UI-æ¦‚å¿µ" class="headerlink" title="Swift UI æ¦‚å¿µ"></a>Swift UI æ¦‚å¿µ</h2><p>åœ¨æˆ‘å€‘æ–°å¢çš„ Widget Extension ç›®éŒ„ä¸‹æœ‰ <code>TimerWidgetBundle.swift</code> æª”æ¡ˆï¼Œå®ƒæ˜¯é€²å…¥é»ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WidgetKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimerWidgetBundle</span>: <span class="title">WidgetBundle</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Widget</span> &#123;</span><br><span class="line">    <span class="type">TimerWidget</span>()</span><br><span class="line">    <span class="type">TimerWidgetLiveActivity</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æœ€ä¸Šæ–¹åŒ¯å…¥äº† <code>WidgetKit</code> å’Œ <code>SwiftUI</code> ã€‚<code>WidgetKit</code> æä¾›å»ºç«‹ã€è¨­å®šã€é¡¯ç¤º Widget å’Œ Live Activity çš„å·¥å…·ã€‚<code>SwitUI</code> å‰‡æ˜¯å»ºç«‹ä½¿ç”¨è€…ä»‹é¢çš„æ¡†æ¶</li>
<li><code>@main</code> è¨»è¨˜ç¨‹å¼çš„é€²å…¥é»</li>
<li><code>struct TimerWidgetBundle</code> å®£å‘Šäº†çµæ§‹ <code>struct</code> åç¨±ç‚º <code>TimerWidgetBundle</code> ã€‚Swift ä¸­çš„ <code>struct</code> æ˜¯ä¸€å€‹ç¨‹å¼çš„å»ºç½®å€å¡Šã€‚å’Œ C çš„ <code>struct</code> ä¸åŒå®ƒä¸å–®ç´”åªèƒ½å„²å­˜è³‡æ–™ã€‚Swift çš„çµæ§‹å¯ä»¥æœ‰æ–¹æ³•ï¼Œå‡½å¼å’Œå»ºæ§‹å­ã€‚å¯¦éš›ä¸Šéå¸¸é¡ä¼¼ Class ä½†æ˜¯ä¸èƒ½è¢«ç¹¼æ‰¿ã€‚</li>
<li><code>WidgetBundle</code> ç‚ºå”å®šé¡ä¼¼å…¶ä»–èªè¨€çš„ä»‹é¢ Interfaceï¼Œå®šç¾©äº†ä¸€å€‹æ“´å……æ’ä»¶åŒ…å¿…é ˆæä¾›çš„æ±è¥¿ã€‚æœ¬èº«æ˜¯ Widget å’Œ Live Activity çš„é›†åˆã€‚ç”¨ä¾†å°‡ Widget å’Œ Live Activity ç¾¤çµ„ã€‚</li>
<li><code>struct TimerWidgetBundle: WidgetBundle</code> å°‡ä¸Šé¢ 2 å€‹æ±è¥¿çµ„åˆèµ·ä¾†ï¼Œé€™ä¸€è¡Œç¨‹å¼è¡¨ç¤º <code>TimerWidgetBundle</code> å…·å‚™ <code>WidgetBundle</code> çš„è¡Œç‚ºå’ŒåŠŸèƒ½ã€‚é€™å°±æ˜¯ protocol-oriented ç¨‹å¼è¨­è¨ˆçš„é«”ç¾ã€‚ä¸€å€‹å‹åˆ¥å¯ä»¥ç¬¦åˆå¤šå€‹ã€Œå”å®šã€çš„æè¿°ã€‚</li>
<li>è‹¥ <code>TimerWidgetBundle</code> éµå¾ª <code>WidgetBundle</code> å”è­°ï¼Œé‚£éº¼å°±é ˆæä¾› <code>body</code> å±¬æ€§</li>
<li><code>var body: some Widget</code> å®£å‘Šäº† <code>body</code> å±¬æ€§ï¼Œ<code>some</code> é—œéµå­—é¡ä¼¼æ–¼ TS çš„æ³›å‹ï¼Œä¹Ÿå°±æ˜¯åªè¦ä½¿ç”¨çš„å‹åˆ¥æœ‰å¯¦ä½œ <code>Widget</code> å”è­°å³ç¬¦åˆ</li>
<li><code>some Widget &#123;&#125;</code> å¾Œé¢çš„å¤§æ‹¬è™Ÿç”¨ä¾†å®šç¾©è¨ˆç®—å±¬æ€§çš„ç¨‹å¼å…§å®¹ã€‚</li>
<li>è£¡é¢çš„ <code>TimerWidget()</code> å’Œ <code>TimerWidgetLiveActivity()</code> å°±æ˜¯ç¬¦åˆ <code>Widget</code> å”è­°çš„ <code>struct</code> ã€‚å®ƒå€‘å°±æ˜¯ Widget å’Œ Live Activityã€‚</li>
</ul>
<h2 id="è§£æ-Live-Activity"><a href="#è§£æ-Live-Activity" class="headerlink" title="è§£æ Live Activity"></a>è§£æ Live Activity</h2><p>ç•¶æˆ‘å€‘å»ºç«‹ Widget Extensionï¼ŒXcode æœƒè‡ªå‹•å¹«æˆ‘å€‘ç”¢ç”Ÿ <code>TimerWidgetLiveActivity.swfit</code> ä¸¦æä¾›åŸºæœ¬çš„ç¯„ä¾‹ã€‚</p>
<p><img src="la-1.webp"></p>
<p><img src="la-2.webp"></p>
<p><img src="la-3.webp"></p>
<p>æ¨¡æ“¬ç•«é¢æ˜¯ç”±ç¨‹å¼ä¸­çš„ <code>#Preivew</code> é©…å‹•çš„ã€‚</p>
<h2 id="Data-Model"><a href="#Data-Model" class="headerlink" title="Data Model"></a>Data Model</h2><p><code>Activity Attributes</code> æ˜¯ Live Activity çš„æ ¸å¿ƒé‡é»ï¼Œå®£å‘ŠåŒ…å«éœæ…‹å’Œå‹•æ…‹è³‡æ–™ä¾†çµ„æˆ Live Activity çš„ç•«é¢ã€‚ä¸€èˆ¬ä¾†èªªæˆ‘å€‘æœƒåœ¨é€™è£¡çµ„ç¹”éœ€è¦çš„ç‹€æ…‹ã€‚é‡é»æ˜¯é ˆä½¿ç”¨ <code>ActivityAttributes</code> å”è­°</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimerWidgetAttributes</span>: <span class="title">ActivityAttributes</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ç‹€æ…‹</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ContentState</span>: <span class="title">Codable</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> emoji: <span class="type">String</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å›ºå®šå€¼</span></span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ActivityAttributes</code> å”è­°å¿…é ˆå¯¦ä½œå…§éƒ¨ <code>struct ContentState</code> ï¼Œ<code>ContentState</code> çµæ§‹ç”¨æ–¼å°è£å¯è®Šå‹•çš„è³‡æ–™ï¼Œä¸€èˆ¬ <code>ActivityAttributes</code> çš„å±¬æ€§å‰‡æ˜¯å›ºå®šå€¼ã€‚å¾ŒçºŒæˆ‘å€‘åœ¨ Live Activity ä»‹é¢å¯ä»¥é€šé <code>context.state.emoji</code> æˆ– <code>context.attributes.name</code> ä½¿ç”¨ã€‚</p>
<h2 id="ä½ˆå±€"><a href="#ä½ˆå±€" class="headerlink" title="ä½ˆå±€"></a>ä½ˆå±€</h2><p>è¦èª¿æ•´ Live Activity çš„ä½ˆå±€å’Œæ¨£å¼æˆ‘å€‘éœ€è¦éµå¾ª <code>Widget</code> å”è­°ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimerWidgetLiveActivity</span>: <span class="title">Widget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">WidgetConfiguration</span> &#123;</span><br><span class="line">    <span class="type">ActivityConfiguration</span>(for: <span class="type">TimerWidgetAttributes</span>.<span class="keyword">self</span>) &#123; context <span class="keyword">in</span></span><br><span class="line">      <span class="comment">// é–å®šè¢å¹•çš„è¨­è¨ˆåœ¨é€™è£¡</span></span><br><span class="line">    	<span class="type">VStack</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello <span class="subst">\(context.state.emoji)</span>&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .activityBackgroundTint(<span class="type">Color</span>.cyan)</span><br><span class="line">      .activitySystemActionForegroundColor(<span class="type">Color</span>.black)</span><br><span class="line">    &#125; dynamicIsland: &#123; context <span class="keyword">in</span></span><br><span class="line">      <span class="type">DynamicIsland</span> &#123;</span><br><span class="line">        <span class="comment">// å‹•æ…‹å³¶ä»‹é¢</span></span><br><span class="line">        <span class="type">DynamicIslandExpandedRegion</span>(.leading) &#123;</span><br><span class="line">          <span class="type">Text</span>(<span class="string">&quot;Leading&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">DynamicIslandExpandedRegion</span>(.trailing) &#123;</span><br><span class="line">          <span class="type">Text</span>(<span class="string">&quot;Trailing&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">DynamicIslandExpandedRegion</span>(.bottom) &#123;</span><br><span class="line">          <span class="type">Text</span>(<span class="string">&quot;Bottom <span class="subst">\(context.state.emoji)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; compactLeading: &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;L&quot;</span>)</span><br><span class="line">      &#125; compactTrailing: &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;T<span class="subst">\(context.state.emoji)</span>&quot;</span>)</span><br><span class="line">      &#125; minimal: &#123;</span><br><span class="line">        <span class="type">Text</span>(context.state.emoji)</span><br><span class="line">      &#125;</span><br><span class="line">      .widgetURL(<span class="type">URL</span>(string: <span class="string">&quot;http://www.apple.com&quot;</span>))</span><br><span class="line">      .keylineTint(<span class="type">Color</span>.red)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ç¨‹å¼ç¢¼æœ¬è³ªä¸Šå°±æ˜¯ä¸€å€‹ Widget - å…¶å…§å®¹å’Œè¡Œç‚ºå°è£åœ¨ <code>body</code> å±¬æ€§ï¼Œè©²å±¬æ€§å›å‚³çš„å‹åˆ¥é ˆç¬¦åˆ <code>WidgetConfiguration</code>ã€‚</p>
<p>åœ¨ Swift UI æˆ‘å€‘å°‡éœ€è¦è™•ç†å¾ˆå¤š <code>struct</code> ï¼Œä¾‹å¦‚çœ‹åˆ°ä¸Šé¢çš„ <code>ActivityConfiguration(for: TimerWidgetAttributes.self)</code> ï¼Œé€™å¥ç¨‹å¼ç¢¼å»ºç«‹äº† <code>ActivityConfiguraition</code> çµæ§‹çš„ç‰©ä»¶å¯¦ä¾‹ï¼Œ<code>Text(&quot;Hello \(context.state.emoji)&quot;)</code> å»ºç«‹ <code>Text</code> çµæ§‹çš„ç‰©ä»¶å¯¦ä¾‹ã€‚</p>
<p>å…¶ä¸­å…©è€…çš„å·®åˆ¥æ˜¯ <code>ActivityConfiguration</code> ä½¿ç”¨äº†å…·ååƒæ•¸ <code>for</code> ä¾†è¨­å®šè³‡æ–™æ¨¡å‹çš„å‹åˆ¥ã€‚<code>Text</code> æ²’æœ‰ä½¿ç”¨å…·ååƒæ•¸ã€‚</p>
<blockquote>
<p>ã€Œoutward-facing labelã€å¤–éƒ¨å¯è¦‹æ¨™ç±¤åœ¨ Swift å°¤å…¶ Swift UI ä¸­é€™å€‹è¡“èªæŒ‡çš„å…¶å¯¦å°±æ˜¯å…·ååƒæ•¸ï¼Œä¹Ÿå°±æ˜¯åœ¨å¯¦ä¾‹åŒ–æ™‚ä½¿ç”¨çš„æ¨™ç±¤ã€‚</p>
</blockquote>
<p>æœ€ä½³å¯¦è¸æ˜¯å¦‚æœåƒæ•¸ç„¡æ³•å¾ˆæ˜ç¢ºè¡¨ç¤ºå…¶æ„æ€æ™‚ä½¿ç”¨å…·ååƒæ•¸ï¼Œå¦‚æœåŠŸèƒ½æ˜ç¢ºå‰‡ä½¿ç”¨åŒ¿å/ä½ç½®åƒæ•¸ã€‚</p>
<p><code>ActivityConfiguration</code> ä¸­æˆ‘å€‘å¾ˆå¿«æ³¨æ„åˆ° <code>VStack</code>ï¼Œè€Œä¸”å®ƒä¸åƒ <code>Text</code> ä¸€æ¨£æœ‰ä½¿ç”¨å°æ‹¬è™Ÿ <code>()</code>ã€‚<code>VStack</code> ä¹Ÿæ˜¯ä¸€å€‹ <code>struct</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;Hello <span class="subst">\(context.state.emoji)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Swift æ”¯æ´ <code>struct</code> é è¨­åƒæ•¸ï¼Œä¸”å¯ä»¥å¿½ç•¥ <code>()</code> ä¹Ÿå°±æ˜¯èªªä¸Šé¢çš„ç¨‹å¼ç¢¼å’Œä¸‹é¢æ˜¯ç­‰åƒ¹çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span>() &#123;</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;Hello <span class="subst">\(context.state.emoji)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦ä¸€å€‹å•é¡Œæ˜¯é‚£éº¼å¾Œé¢çš„ <code>&#123;&#125;</code> æ˜¯ä»€éº¼ï¼Ÿé€™å¯¦éš›ä¸Šæ˜¯ä¸€å€‹ä½œç‚ºåƒæ•¸å‚³å…¥çš„å‡½å¼ - Swift Closure ã€‚</p>
<p>é€™å€‹ <code>&#123;&#125;</code> æ˜¯å¦å¤–ä¸€å€‹ç‰¹æ®Šèªæ³•å«ä½œ Trailing Closure å¾Œç½®é–‰åŒ…ã€‚å’Œä¸‹é¢çš„ç¨‹å¼ç¢¼ç­‰åƒ¹</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span>(content: &#123;</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;Hello <span class="subst">\(context.state.emoji)</span>&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å› ç‚º <code>content</code> æ˜¯æœ€å¾Œä¸€å€‹åƒæ•¸ï¼Œä¸”é¡å‹æ˜¯ä¸€å€‹é–‰åŒ…ã€‚ åœ¨ Swift ä¸­ï¼Œå¦‚æœä¸€å€‹å‡½æ•¸çš„æœ€å¾Œä¸€å€‹åƒæ•¸æ˜¯é–‰åŒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨å¾Œç½®é–‰åŒ…èªæ³•ã€‚</p>
<p>é€™å€‹å¾Œç½®é–‰åŒ…å‡½å¼å…§éƒ¨å°±æ˜¯è¦–åœ–åˆ—è¡¨ï¼ŒSwift UI ä½¿ç”¨ä¸€ç¨® DSL ä¾†è¨­è¨ˆä»‹é¢ï¼Œ<code>VStack</code> çµæ§‹å°±æ˜¯ç”¨ä¾†ç”¢ç”Ÿä¸€å€‹åˆ—è¡¨çš„å…§å®¹ã€‚åœ¨åº•å±¤é€™å€‹å‡½å¼çš„å…§å®¹æ˜¯ä¸€å€‹ <code>@ViewBuilder</code> æˆ‘å€‘å¯ä»¥åœ¨è£¡é¢æ”¾å…¥å­å…ƒç´ ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;Hello <span class="subst">\(context.state.emoji)</span>&quot;</span>)</span><br><span class="line">  <span class="type">Image</span>(systemName: <span class="string">&quot;star&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SwiftUI ä¸­çš„æŸäº›ç‰¹æ®Šå‡½æ•¸å¦‚ <code>VStack</code> ã€<code>HStack</code>ã€<code>List</code> å¯ä»¥æ¥å—å¤šå€‹å­è¦–åœ–ä½œç‚ºåƒæ•¸ï¼Œé€™äº›å‡½æ•¸çš„ä¸»è¦ç›®çš„æ˜¯çµ„ç¹”å’Œæ’åˆ—å¤šå€‹å­è¦–åœ–ã€‚æˆ‘å€‘å¯ä»¥ç›´æ¥åˆ—å‡ºè¦åŒ…å«çš„è¦–åœ–ï¼Œå¦‚ <code>VStack &#123; Text(&quot;Hello&quot;) Text(&quot;World&quot;) &#125;</code>ã€‚</p>
<p>å®ƒå€‘æœ‰äº›é™åˆ¶ï¼š</p>
<ul>
<li>å‡½å¼åªèƒ½ç”¨ä¾†çµ„ç¹”è¦–åœ–</li>
<li>å…è¨±ä½¿ç”¨ <code>if</code> <code>switch</code></li>
<li>å…è¨±ä½¿ç”¨å€åŸŸè®Šæ•¸</li>
</ul>
<p>æ¥è‘—æˆ‘å€‘ä¾†é€²ä¸€æ­¥æ·±å…¥ <code>ActivityConfiguration</code> ï¼Œé¦–å…ˆé€™å€‹ <code>struct</code> çš„ <code>init</code> æ–¹æ³•ï¼ˆå»ºæ§‹å­ï¼‰æ¥æ”¶ 3 å€‹åƒæ•¸ï¼š</p>
<ul>
<li><code>for</code> æ­¤å…·ååƒæ•¸æŒ‡å®š Live Activity è³‡æ–™æ¨¡å‹çš„å‹åˆ¥ï¼Œé€™è£¡æ˜¯ <code>TimerWidgetAttributes.self</code>ã€‚<code>.self</code> æŒ‡å‘å‹åˆ¥æœ¬èº«ï¼Œä¸¦éç‰©ä»¶å¯¦ä¾‹ï¼Œè€Œæ˜¯å‹åˆ¥ç‰©ä»¶æˆ–ç¨±ç‚º Metatypeã€‚åéä¾†èªªä¸€å€‹ç‰©ä»¶çš„ <code>.self</code> å°±æœƒæŒ‡å‘è©²ç‰©ä»¶å¯¦ä¾‹ã€‚</li>
<li><code>content</code> å»ºç«‹ Live Activity è¦–åœ–çš„é–‰åŒ…ã€‚é€™å€‹ä»‹é¢æœƒåœ¨ Lock Screen é¡¯ç¤ºæˆ–åœ¨é‚£äº›æ²’æœ‰å‹•æ…‹å³¶çš„è£ç½®é¦–é ä½œä½œç‚ºæ©«å¹…</li>
<li><code>dynamicIsland</code> å¦ä¸€å€‹é–‰åŒ…ï¼Œåœ¨å‹•æ…‹å³¶å»ºç«‹ Live Activity</li>
</ul>
<blockquote>
<p>åœ¨ Swift ä¸­çš„çµæ§‹å¦‚æœæ²’æœ‰å®šç¾© <code>init</code> è‡ªå‹•ç²å¾—ä¸€å€‹åˆå§‹åŒ–å™¨ä¾‹å¦‚ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  	<span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  	<span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">      <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœç§»é™¤ init ä¾èˆŠå¯ä»¥ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">let</span> john <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;John&quot;</span>, age: <span class="number">30</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>åœ¨ Swift 5.3 ä¹‹å‰ï¼Œå¾Œç½®é–‰åŒ…èªæ³•åªé©ç”¨æ–¼å‡½æ•¸çš„æœ€å¾Œä¸€å€‹åƒæ•¸ã€‚Swift 5.3 å¼•å…¥äº†å¤šå€‹å¾Œç½®é–‰åŒ…åŠŸèƒ½ã€‚é€™äº›é–‰åŒ…æœƒä¾åºå°æ‡‰åˆ°å‡½æ•¸çš„åƒæ•¸åˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯ç‚ºä»€éº¼ <code>ActivityConfiguration</code> å¯ä»¥æœ‰å…©å€‹å¾Œç½®é–‰åŒ…ã€‚</p>
<p>æ¯ä¸€å€‹é–‰åŒ…å¯ä»¥æ¥æ”¶åƒæ•¸ä¾‹å¦‚ <code>content</code> å’Œ <code>dynamicIsland</code> çš„ <code>context</code> åƒæ•¸ã€‚åœ¨ Swift é–‰åŒ…èªæ³•ä¸­ï¼Œ<code>in</code> é—œéµå­—ä½œç‚ºåƒæ•¸åˆ—è¡¨å’Œé–‰åŒ…ä¸»é«”ä¹‹é–“çš„åˆ†ç•Œã€‚<code>context</code> æ˜¯ <code>TimerWidgetAttributes</code> çš„ç‰©ä»¶å¯¦ä¾‹ï¼Œè®“æˆ‘å€‘å¯ä»¥æ ¹æ“šè³‡æ–™é€²è¡Œæ¸²æŸ“ã€‚ä¾‹å¦‚å‹•æ…‹è³‡æ–™é€šé <code>context.state</code>ï¼Œéœæ…‹è³‡æ–™å‰‡é€šé <code>context.attributes</code>ã€‚</p>
<p><code>ActivityAttributes</code> å”è­°è¦ç¯„äº† <code>struct ContentState</code> å’Œéœæ…‹å±¬æ€§çš„è¦å‰‡ï¼Œç„¶å¾Œæ¡†æ¶å”åŠ©è™•ç†å°‡è³‡æ–™æ”¾ç½®åˆ° <code>context.state</code> å’Œ <code>context.attributes</code>ä¸Šã€‚</p>
<p><code>ActivityConfiguration</code> ç‰©ä»¶æ˜¯é€šéæŒ‡å®šçš„è³‡æ–™æ¨¡å‹å‹ <code>TimerWidgetAttributes</code> åŠ ä¸Š 2 å€‹é–‰åŒ…å»ºç«‹çš„ã€‚å…©å€‹é–‰åŒ…åˆ†åˆ¥å®šç¾©äº†åœ¨æ‰‹æ©Ÿé–å®šæ™‚ Live Activity çš„ä½ˆå±€ä»¥åŠæ‰‹æ©Ÿè§£é–ä¸”è™•æ–¼å‹•æ…‹å³¶æ¨¡å¼ iOS 16.1+ çš„ä½ˆå±€</p>
<p><img src="la-4.webp"></p>
<p>ç”±å·¦è‡³å³åˆ†åˆ¥ç‚º Compact, Minimal, å’Œ Expanded</p>
<p>ç•¶åªæœ‰ä¸€å€‹ Live Activity è™•æ–¼æ´»å‹•ç‹€æ…‹å‰‡å‹•æ…‹å³¶ç‚ºç·Šæ¹Š Compact æ¨¡å¼ã€‚æ­¤æ¨¡å¼æœ‰å…©å€‹åˆ†é–‹çš„å…ƒç´ åˆ†åˆ¥åœ¨å‰é¡é ­çš„é ­å°¾ leading å’Œ trailingã€‚æ­¤æ¨¡å¼çš„äº’å‹•åŒ…å«ï¼š</p>
<ul>
<li><p>é»æ“Šä»»ä½•ä¸€å´éƒ½æœƒæ‰“é–‹æ‡‰ç”¨ç¨‹å¼</p>
</li>
<li><p>æä¾›äº†ç›´æ¥è·³è½‰åˆ°æ‡‰ç”¨ç¨‹å¼ç‰¹å®šé é¢ Deep Linkï¼Œé€™å€‹è¡Œç‚ºä½¿ç”¨å‹•æ…‹å³¶çš„ <code>widgetURL</code> å‡½å¼è¨­å®šï¼Œé€™å€‹è¨­å®šæœƒè®Šæˆ Live Activity æ¯å€‹ç•«é¢é è¨­çš„ Deep Link ï¼Œå¦‚æœæˆ‘å€‘åœ¨ Live Activity ä½¿ç”¨ <code>struct Link</code> å‰‡æœƒè¦†è“‹é è¨­é€£çµã€‚</p>
</li>
<li><p>é•·æŒ‰æœƒå°‡å‹•æ…‹å³¶å¾ç·Šæ¹Šæ¨¡å¼ Compact åˆ‡æ›æ›ç‚ºå±•é–‹æ¨¡å¼ Expandedã€‚</p>
</li>
</ul>
<p>ç•¶æœ‰å¤šå€‹ Live Activity è™•æ–¼æ´»å‹•ç‹€æ…‹æ™‚å‰‡é€²å…¥æœ€å°æ¨¡å¼ Minimal ï¼Œæ­¤æ™‚ä¸€å€‹ Activity æœƒæ˜¯æ›è¼‰ç‹€æ…‹ attachedï¼Œå¦ä¸€å€‹é€™æ˜¯åˆ†é›¢ç‹€æ…‹ detachedã€‚é¡ä¼¼ç·Šæ¹Šæ¨¡å¼é»æ“Šæœ€å°åŒ–çš„ Live Activity æœƒæ‰“é–‹æ‡‰ç”¨ã€‚é•·æŒ‰ä¸€æ¨£æ˜¯åˆ‡æ›ç‚ºå±•é–‹æ¨¡å¼ã€‚</p>
<p>é•·æŒ‰ä¹‹å¾Œé€²å…¥å±•é–‹æ¨¡å¼å…¶å¯¦å°±æ˜¯æä¾›æ›´å¤šå…§å®¹å’Œè³‡è¨Šã€‚</p>
<h2 id="é—œæ–¼é è¦½"><a href="#é—œæ–¼é è¦½" class="headerlink" title="é—œæ–¼é è¦½"></a>é—œæ–¼é è¦½</h2><p>åœ¨æˆ‘å€‘çš„ <code>TimerWidgetLiveActivity.swift</code> ç¨‹å¼ç¢¼å¾Œé¢</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">TimerWidgetAttributes</span> </span>&#123;</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">static</span> <span class="keyword">var</span> preview: <span class="type">TimerWidgetAttributes</span> &#123;</span><br><span class="line">        <span class="type">TimerWidgetAttributes</span>(name: <span class="string">&quot;World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">TimerWidgetAttributes</span>.<span class="title">ContentState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">static</span> <span class="keyword">var</span> smiley: <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span> &#123;</span><br><span class="line">        <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>(emoji: <span class="string">&quot;ğŸ˜€&quot;</span>)</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">fileprivate</span> <span class="keyword">static</span> <span class="keyword">var</span> starEyes: <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span> &#123;</span><br><span class="line">         <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>(emoji: <span class="string">&quot;ğŸ¤©&quot;</span>)</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="type">Preview</span>(<span class="string">&quot;Notification&quot;</span>, as: .content, using: <span class="type">TimerWidgetAttributes</span>.preview) &#123;</span><br><span class="line">   <span class="type">TimerWidgetLiveActivity</span>()</span><br><span class="line">&#125; contentStates: &#123;</span><br><span class="line">    <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>.smiley</span><br><span class="line">    <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>.starEyes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€™äº›ç¨‹å¼ç¢¼å¯ä»¥ç”¨ä¾†æ§åˆ¶é è¦½ã€‚</p>
<ul>
<li><code>extension</code> é—œéµå­—ç”¨ä¾†åŠ å…¥æ–°åŠŸèƒ½åˆ°å·²å­˜åœ¨çš„é¡åˆ¥ï¼Œçµæ§‹ï¼Œenum æˆ–å”è­°ã€‚é€™è£¡æˆ‘å€‘ç”¨ä¾†é å…ˆå»ºç«‹ <code>TimerWidgetAttributes</code> çš„ç‰©ä»¶å¯¦ä¾‹ï¼Œä¸»è¦åªæ˜¯ç‚ºäº†æ¸¬è©¦å’Œé è¦½ã€‚</li>
<li><code>fileprivate</code> é—œéµå­—å°‡å­˜å–æ¬Šé™é™åˆ¶åœ¨åŒä¸€å€‹æª”æ¡ˆå…§</li>
<li><code>#Preview</code> ç·¨è­¯å™¨æŒ‡ä»¤ directive è¨­å®šäº†é è¦½çš„åç¨± Notificationï¼Œä¸¦è¨­å®šå…¶é è¦½å…§å®¹ç”¨æ–¼é è¦½ <code>TimerWidgetAttributes</code> ç‰©ä»¶</li>
<li>åœ¨å¤§æ‹¬è™Ÿ <code>&#123; TimerWidgetLiveActivity() &#125;</code> å…§ï¼Œå®ƒå®šç¾©äº†è¦é è¦½çš„ Widget æˆ– Live Activityã€‚</li>
<li><code>contentStates: &#123; ... &#125;</code>ï¼šé€™å€‹é–‰åŒ…å®šç¾©äº†é è¦½ä¸­è¦ä½¿ç”¨çš„ä¸åŒå…§å®¹ç‹€æ…‹ã€‚å®ƒå¼•ç”¨äº†åœ¨ <code>extension TimerWidgetAttributes.ContentState</code> ä¸­å®šç¾©çš„ <code>smiley</code> å’Œ <code>starEyes</code> ç‹€æ…‹ã€‚å¾ŒçºŒæˆ‘å€‘å¯ä»¥åœ¨æ¨¡æ“¬ç•«é¢åˆ‡æ›ã€‚</li>
</ul>
<p><img src="la-5.webp"></p>
<h2 id="Native-Module"><a href="#Native-Module" class="headerlink" title="Native Module"></a>Native Module</h2><p>æ·±å…¥ Navtive Module ä¹‹å‰æˆ‘å€‘å…ˆæ¦‚è¦½æˆ‘å€‘å¯¦ä½œçš„æ•ˆæœåœ¨å‹•æ…‹å³¶çš„å„ç¨®æ¨¡å¼å¦‚ä¸‹è¨­è¨ˆ</p>
<p><img src="la-6.webp"></p>
<p>React Native çš„ Native Module è®“æˆ‘å€‘å¯ä»¥å¾ JavaScript è§¸ç™¼åŸ·è¡Œä»»æ„åŸç”Ÿç¨‹å¼ç¢¼ä¾‹å¦‚ Swiftã€Object-Cã€Javaã€Kotlinã€‚ç•¶éœ€è¦å­˜å–ç‰¹å®šå¹³å°åŠŸèƒ½æ™‚å°¤å…¶å¯¦ç”¨ã€‚ç•¶æŸäº›åŠŸèƒ½ä¸¦æœªåœ¨ React Native æ¡†æ¶ä¸­æä¾›æ™‚ã€‚ä¾‹å¦‚ iOS çš„ Live Activitiesï¼ˆå³æ™‚æ´»å‹•ï¼‰åŠŸèƒ½å°±æ˜¯ä¸€å€‹å¾ˆå¥½çš„ä¾‹å­ã€‚ä¸‹é¢æˆ‘å€‘å°‡å»ºç«‹ Native Module æä¾›éœ€è¦çš„æ–¹æ³•çµ¦ React Native ç„¡ç¸«æ•´åˆ Live Activity ã€‚</p>
<p>æ¥çºŒä¸Šé¢å»ºç«‹çš„ã€ŒTimerWidgetã€ï¼Œåœ¨ Xcode å·¦é‚Šå°èˆªåˆ—æœƒçœ‹åˆ° <code>TimerWidget</code> ç›®éŒ„ï¼ˆGroupï¼‰ï¼Œå³éµ New File &gt; é¸æ“‡ Swift æª”æ¡ˆ &gt; å‘½åç‚º <code>TimerWidgetModule.swift</code> ã€‚<strong>è¨˜å¾—è¦ Target åŠ å…¥ã€Œå°ˆæ¡ˆæ‡‰ç”¨ç¨‹å¼ã€å’Œã€ŒWidget Extensionã€ã€‚</strong></p>
<p>ç•¶æˆ‘å€‘åŸ·è¡Œä¸Šé¢çš„æ“ä½œï¼Œæˆ‘å€‘å¯èƒ½æœƒçœ‹åˆ°å½ˆå‡ºè¦–çª—è©¢å•æ˜¯å¦è¨­å®š Objective-C bridging headerã€‚å¦‚æœæ‚¨æ‰“ç®—å°‡ Swift èˆ‡ Objective-C ç¨‹å¼ç¢¼æ··åˆä½¿ç”¨ï¼Œæˆ‘å€‘éœ€è¦å®ƒã€‚</p>
<p>ç”±æ–¼ React Native ä½¿ç”¨ Objective-C æª”æ¡ˆä¾†åŒ¯å‡º Native Module æ–¹æ³•ï¼Œ<strong>å› æ­¤é ˆé¸æ“‡ã€ŒCreate Brdiging Headerã€ã€‚</strong></p>
<blockquote>
<p>è‹¥æ²’æœ‰å½ˆå‡ºè¦–çª—å‰‡æˆ‘å€‘è¦è‡ªå·±å»ºç«‹ New &gt; File &gt; Header File ä¸¦è¼¸å…¥ã€Œ <code>å°ˆæ¡ˆåç¨±-Bridging-Header</code> ã€ï¼Œé€™è£¡æ˜¯ <code>Timer-Bridging-Header</code></p>
</blockquote>
<p>æˆ‘å€‘çš„ Native Module æœƒåˆå§‹åŒ–æä¾›å¹¾å€‹åŸºæœ¬çš„æ–¹æ³•ï¼›ä¸€å€‹æ˜¯å•Ÿå‹• Live Activity çš„è¨ˆæ™‚å™¨ï¼Œå¦ä¸€å€‹æ˜¯åœæ­¢ã€‚ç”±æ–¼ Swift ç¼ºå°‘å°å·¨é›†çš„æ”¯æ´ï¼Œå› æ­¤æˆ‘å€‘ä½¿ç”¨ <code>@objc</code>ä¿®é£¾å­ã€‚é€™å€‹ä¿®é£¾å­éå¸¸é‡è¦ï¼Œå› ç‚ºå®ƒç¢ºä¿æˆ‘å€‘çš„é¡åˆ¥å’Œå‡½å¼æ­£ç¢ºåŒ¯å‡ºåˆ° React Native ç›¸ä¾çš„ Objective-C åŸ·è¡Œç’°å¢ƒã€‚<strong>ä½¿ç”¨ <code>@objc(TimerWidgetModule)</code> ç¢ºä¿æ¨¡çµ„å¯ä»¥åœ¨ React Native ä¸­é€é <code>NativeModules.TimerWidgetModule</code> å­˜å–ã€‚</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc(TimerWidgetModule)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimerWidgetModule</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">startLiveActivity</span>()</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">stopLiveActivity</span>()</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹ä¸€æ­¥æˆ‘å€‘å»ºç«‹ä¸€å€‹ Ojbective-C çš„æª”æ¡ˆ <code>TimerWidgetBridge.m</code> å‘ React Native è¨»å†Šå¿…è¦çš„æ–¹æ³•ã€‚è¨˜ä½é€™å€‹æª”æ¡ˆæ˜¯ React Native å°ˆç”¨ï¼Œæˆ‘å€‘ <strong>Target åªé ˆåŠ å…¥ä¸»è¦æ‡‰ç”¨ç¨‹å¼ã€‚</strong></p>
<p>åœ¨ Xcode å·¦å´å°è¦½åˆ—æ‰¾åˆ° <code>TimerWidget</code> ç›®éŒ„ï¼Œå³éµ New File &gt; é¸æ“‡ Objective-C æª”æ¡ˆ &gt; è¼¸å…¥ <code>TimerWidgetBridge</code> &gt; é¸æ“‡ä¸»è¦ React Native æ‡‰ç”¨ç¨‹å¼ç‚º Targetï¼Œä¸é¸ TimerWidgetExtension</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TimerWidgetBridge.m</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;React/RCTBridgeModule.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RCT_EXTERN_MODULE</span>(<span class="title">TimerWidgetModule</span>, <span class="title">NSObject</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">bool</span>)requiresMainQueueSetup &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RCT_EXTERN_METHOD(startLiveActivity)</span><br><span class="line">RCT_EXTERN_METHOD(stopLiveActivity)</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p><code>requiresMainQueueSetup</code> æ–¹æ³•æœƒé€šçŸ¥ React Native æ˜¯å¦éœ€è¦åœ¨åŸ·è¡Œä»»ä½• JavaScript ç¨‹å¼ç¢¼ä¹‹å‰ï¼Œå…ˆåœ¨ä¸»åŸ·è¡Œç·’ä¸Šé€²è¡Œåˆå§‹åŒ–ã€‚</p>
<p>ç”±æ–¼æˆ‘å€‘çš„æ¨¡çµ„ä¸æ¶‰åŠ UI å…ƒç´ ä»¥åŠåœ¨ä¸»åŸ·è¡Œç·’åŸ·è¡Œçš„ API ä¾‹å¦‚ UIKit ç­‰ï¼Œå› æ­¤æˆ‘å€‘å›å‚³ <code>NO</code> ã€‚æˆ‘å€‘çš„æ¨¡çµ„æœƒåœ¨èƒŒæ™¯åŸ·è¡Œç·’åˆå§‹åŒ–ã€‚</p>
<p>ç‚ºäº†å°‡é€™äº›é—œè¯èµ·ä¾†ï¼Œæˆ‘å€‘æ‰¾åˆ° Xcode ç¨æ—©å¹«æˆ‘å€‘å»ºç«‹çš„ <code>Timer-Gridging-Header.h</code> æª”æ¡ˆä¸¦åŒ¯å…¥ <code>RCTBridgeModule.h</code>ï¼Œè©²å”è­°æœƒæä¾›å¿…é ˆçš„ Interface ä»¥åŠ Macrosï¼Œé€™æ˜¯ä¸€å€‹æ©‹æ¥å™¨è®“æˆ‘å€‘å¯ä»¥å¾ Swift å­˜å– React Native æ ¸å¿ƒæ¨¡çµ„å’Œ APIï¼Œé€™äº›æ¨¡çµ„å’Œ API ä¸»è¦ä½¿ç”¨ Objective-C é–‹ç™¼ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;React/RCTBridgeModule.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘å€‘å¯ä»¥æ·±å…¥ Swift UI ä¾†å»ºç«‹æˆ‘å€‘ Live Activity çš„ä»‹é¢ã€‚æˆ‘å€‘å¾ <code>ActivityAttributes</code> é–‹å§‹ã€‚è¨˜å¾—æˆ‘å€‘èªªç‹€æ…‹å„²æ‡‰å„²å­˜åœ¨ <code>ContentState</code> çµæ§‹ä¸­ã€‚é‡å°è¨ˆæ™‚å™¨ï¼Œå”¯ä¸€å¿…è¦çš„è³‡è¨Šæ˜¯å•Ÿå‹•çš„æ™‚é–“æˆ³è¨˜ï¼Œå› æ­¤æˆ‘å€‘å›åˆ° <code>TimerWidgetLiveActivity.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ActivityKit</span><br><span class="line"><span class="keyword">import</span> WidgetKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimerWidgetAttributes</span>: <span class="title">ActivityAttributes</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ContentState</span>: <span class="title">Codable</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> startedAt: <span class="type">Date</span>? <span class="comment">// &lt;- æ›´æ–°é€™</span></span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimerWidgetLiveActivity</span>: <span class="title">Widget</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸‹ä¸€æ­¥æˆ‘å€‘è¦é€²å…¥ SwiftUI ä¸¦ä½¿ç”¨ View å…ƒä»¶è¨­è¨ˆç•«é¢ï¼Œå…¶ä¸­ <code>startedAt</code> ç‹€æ…‹è®Šæ•¸æœƒç´€éŒ„æˆ‘å€‘é»æ“Šé–‹å§‹æŒ‰éˆ•çš„æ™‚é–“ã€‚ç„¶è€Œä½œç‚ºä¸€å€‹è¨ˆæ™‚å™¨ï¼Œæˆ‘å€‘éœ€è¦ä¸€ç¨®æ–¹å¼æ¯ç§’æ›´æ–° Live Activity çš„å…§å®¹é”æˆè¨ˆæ™‚æ•ˆæœã€‚æˆ‘å€‘å¯èƒ½æœƒç›´è¦ºçš„æƒ³èªªåœ¨ Swift å•Ÿå‹•ä¸€å€‹ Interval åœ¨é–“éš”æ™‚é–“å®šæœŸåŸ·è¡Œä¸€æ®µç¨‹å¼ï¼Œè¨ˆç®—ç¶“éçš„æ™‚é–“ä¸¦æ ¼å¼åŒ–ç‚º <code>m:ss</code> æ ¼å¼ã€‚é›–ç„¶é€™ç¨®æ–¹å¼å¯è¡Œï¼Œä½†æœ‰æ›´å¥½çš„é¸æ“‡ï¼Œæˆ‘å€‘å¯ä»¥è‡ªå‹•æ›´æ–° Live Activity ä¸­çš„è¨ˆæ™‚å™¨è€Œä¸ç”¨ Native Module ã€‚é€™å€‹æŠ€å·§å°±æ˜¯ä½¿ç”¨ <code>.timer</code> å°‡æ›´æ–°çš„æ“ä½œå§”æ´¾çµ¦ä½œæ¥­ç³»çµ±çš„æ™‚é–“ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(</span><br><span class="line">	<span class="type">Date</span>(timeIntervalSinceNow: context.state.startedAt.timeIntervalSince1970 <span class="operator">-</span> <span class="type">Date</span>().timeIntervalSince1970),</span><br><span class="line">  style: .timer</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è£œå……ï¼šé¦–å…ˆé€™æ˜¯ä¸€å€‹æ­£å‘è¨ˆæ™‚å™¨</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡è¨­ 10:00:00 æŒ‰ä¸‹é–‹å§‹è¨ˆæ™‚</span></span><br><span class="line">context.state.startedAt <span class="operator">=</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¾åœ¨æ˜¯ 10:01:30 éäº† 1 åˆ† 30 ç§’</span></span><br><span class="line"><span class="keyword">let</span> elapsed <span class="operator">=</span> context.state.startedAt.timeIntervalSince1970 <span class="operator">-</span> <span class="type">Date</span>().timeIntervalSince1970</span><br><span class="line"><span class="comment">// å¾—åˆ° -90 è¡¨ç¤ºéäº† 90 ç§’</span></span><br></pre></td></tr></table></figure>

<p>é—œæ–¼ Text</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(</span><br><span class="line">	<span class="comment">// ç¬¬ä¸€å€‹åƒæ•¸æ˜¯ä¸€å€‹ã€Œç›¸å°æ–¼ç¾åœ¨ã€çš„æ™‚é–“é»</span></span><br><span class="line">	<span class="type">Date</span>(timeIntervalSinceNow: <span class="operator">-</span><span class="number">90</span>), <span class="comment">// è² æ•¸è¡¨ç¤ºéå»æ™‚é–“ã€Œæ­£å‘è¨ˆæ™‚ã€ï¼Œæ­£æ•¸è¡¨ç¤ºæœªä¾†çš„æ™‚é–“é»ã€Œå€’æ•¸è¨ˆæ™‚ã€</span></span><br><span class="line">	style: .timer</span><br><span class="line">  )</span><br><span class="line">  <span class="comment">// ç•¶ç¶“é 1 åˆ† 30 ç§’æ™‚ï¼Œé¡¯ç¤ºï¼šã€Œ1:30ã€ï¼Œè‡ªå‹•æ¯ç§’æ›´æ–°</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä½¿ç”¨é€™å€‹æ–¹å¼ Native Module ä¸ç”¨è² æ“”è¨ˆç®—ä»»å‹™ï¼ŒWidget å¯ä»¥ç¨ç«‹é‹ä½œå¢åŠ è¨ˆæ•¸å™¨çš„æ•ˆèƒ½å’Œç³»çµ±çš„åŒæ­¥æ€§ï¼Œæ›´ä¸æ˜“å‡ºéŒ¯ã€‚</p>
<p>æ¥è‘—æˆ‘å€‘å®Œæˆ <code>TimerWidgetLiveActivity.swift</code> çš„ç¨‹å¼ç¢¼</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ActivityKit</span><br><span class="line"><span class="keyword">import</span> WidgetKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimerWidgetAttributes</span>: <span class="title">ActivityAttributes</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ContentState</span>: <span class="title">Codable</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> startedAt: <span class="type">Date</span>?</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getTimeIntervalSinceNow</span>()</span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> startedAt <span class="operator">=</span> <span class="keyword">self</span>.startedAt <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> startedAt.timeIntervalSince1970 <span class="operator">-</span> <span class="type">Date</span>().timeIntervalSince1970</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimerWidgetLiveActivity</span>: <span class="title">Widget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">WidgetConfiguration</span> &#123;</span><br><span class="line">    <span class="type">ActivityConfiguration</span>(for: <span class="type">TimerWidgetAttributes</span>.<span class="keyword">self</span>) &#123; context <span class="keyword">in</span></span><br><span class="line">      <span class="type">VStack</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(</span><br><span class="line">          <span class="type">Date</span>(timeIntervalSinceNow: context.state.getTimeIntervalSinceNow()),</span><br><span class="line">          style: .timer</span><br><span class="line">        )</span><br><span class="line">        .font(.title)</span><br><span class="line">        .fontWeight(.medium)</span><br><span class="line">        .monospacedDigit()</span><br><span class="line">      &#125;</span><br><span class="line">      .activityBackgroundTint(<span class="type">Color</span>.cyan)</span><br><span class="line">      .activitySystemActionForegroundColor(<span class="type">Color</span>.black)</span><br><span class="line">    &#125; dynamicIsland: &#123; context <span class="keyword">in</span></span><br><span class="line">      <span class="type">DynamicIsland</span> &#123;</span><br><span class="line">        <span class="type">DynamicIslandExpandedRegion</span>(.center) &#123;</span><br><span class="line">          <span class="type">Text</span>(</span><br><span class="line">            <span class="type">Date</span>(timeIntervalSinceNow: context.state.getTimeIntervalSinceNow()),</span><br><span class="line">            style: .timer</span><br><span class="line">          )</span><br><span class="line">          .font(.title)</span><br><span class="line">          .foregroundColor(.cyan)</span><br><span class="line">          .fontWeight(.medium)</span><br><span class="line">          .monospacedDigit()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; compactLeading: &#123;</span><br><span class="line">        <span class="type">Image</span>(systemName: <span class="string">&quot;timer&quot;</span>)</span><br><span class="line">          .imageScale(.medium)</span><br><span class="line">          .foregroundColor(.cyan)</span><br><span class="line">      &#125; compactTrailing: &#123;</span><br><span class="line">        <span class="type">Text</span>(</span><br><span class="line">          <span class="type">Date</span>(timeIntervalSinceNow: context.state.getTimeIntervalSinceNow()),</span><br><span class="line">          style: .timer</span><br><span class="line">        )</span><br><span class="line">        .foregroundColor(.cyan)</span><br><span class="line">        .frame(maxWidth: <span class="number">32</span>)</span><br><span class="line">        .monospacedDigit()</span><br><span class="line">      &#125; minimal: &#123;</span><br><span class="line">        <span class="type">Image</span>(systemName: <span class="string">&quot;timer&quot;</span>)</span><br><span class="line">          .imageScale(.medium)</span><br><span class="line">          .foregroundColor(.cyan)</span><br><span class="line">      &#125;</span><br><span class="line">      .widgetURL(<span class="type">URL</span>(string: <span class="string">&quot;http://www.apple.com&quot;</span>))</span><br><span class="line">      .keylineTint(<span class="type">Color</span>.red)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€™è£¡æˆ‘å€‘ä½¿ç”¨äº†ç³»çµ±é è¨­çš„åœ–ç¤ºï¼Œæ‚¨å¯ä»¥ä¸‹è¼‰ <a target="_blank" rel="noopener" href="https://developer.apple.com/sf-symbols/">SF Symbols æ‡‰ç”¨ç¨‹å¼</a> æŸ¥è©¢æ‚¨éœ€è¦çš„åœ–ç¤ºã€‚ä¸Šé¢çš„ç¨‹å¼ç¢¼æˆ‘å€‘å¤§é‡çš„ä½¿ç”¨äº†è¦–åœ–ä¿®é£¾æ–¹æ³• <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/viewmodifier">ViewModifier</a>ï¼Œå°±æ˜¯ <code>.font()</code>ã€<code>.monospacedDigit()</code>ã€‚</p>
<p>ç‚ºäº†é è¦½æˆ‘å€‘çš„è®Šæ›´æˆ‘å€‘å¯ä»¥åŠ å…¥ä¸‹é¢é è¦½çš„ç¨‹å¼ç¢¼</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimerWidgetLiveActivity</span>: <span class="title">Widget</span> </span>&#123;<span class="operator">...</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¤‡è£½ä¸‹é¢æ®µè½åˆ° TimerWidgetLiveActivity.swift ä¸‹æ–¹å³å¯é è¦½</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨ extension æ”¯æ´é è¦½çš„è³‡æ–™</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">TimerWidgetAttributes</span> </span>&#123;</span><br><span class="line">  <span class="comment">// fileprivate è¡¨ç¤ºè©²å±¬æ€§åªèƒ½åœ¨åŒä¸€å€‹æª”æ¡ˆä¸­ä½¿ç”¨</span></span><br><span class="line">  <span class="comment">// static è¡¨ç¤ºæ­¤è®Šæ•¸ä¸éœ€å¯¦ä¾‹åŒ–</span></span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">static</span> <span class="keyword">var</span> preview: <span class="type">TimerWidgetAttributes</span> &#123;</span><br><span class="line">    <span class="comment">// return TimerWidgetAttributes å¯¦ä¾‹</span></span><br><span class="line">    <span class="type">TimerWidgetAttributes</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ å…¥ ContentState å¯¦ä¾‹</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">TimerWidgetAttributes</span>.<span class="title">ContentState</span> </span>&#123;</span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">static</span> <span class="keyword">var</span> initState: <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span> &#123;</span><br><span class="line">    <span class="comment">// è¨­ç½®é–‹å§‹æ™‚é–“ç‚ºç•¶å‰æ™‚é–“</span></span><br><span class="line">    <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>(startedAt: <span class="type">Date</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="type">Preview</span>(<span class="string">&quot;Notification&quot;</span>,  <span class="comment">// é è¦½çš„æ¨™é¡Œ</span></span><br><span class="line">	as: .content,  <span class="comment">// é è¦½é¡å‹ç‚º content</span></span><br><span class="line">	using: <span class="type">TimerWidgetAttributes</span>.preview) &#123; <span class="comment">// ä½¿ç”¨ä¸Šé¢å®šç¾©çš„é è¦½å±¬æ€§ preview</span></span><br><span class="line">    <span class="comment">// è¦é è¦½çš„ Widget</span></span><br><span class="line">  	<span class="type">TimerWidgetLiveActivity</span>()</span><br><span class="line">&#125; contentStates: &#123;  <span class="comment">// å®šç¾©é è¦½æ™‚çš„ç‹€æ…‹</span></span><br><span class="line">    <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>.initState  <span class="comment">// ä½¿ç”¨ä¸Šé¢å®šç¾©çš„åˆå§‹ç‹€æ…‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåˆ°ç›®å‰ç‚ºæ­¢çš„æ­¥é©Ÿéƒ½æ­£ç¢ºï¼Œæ‡‰è©²å¯ä»¥é»æ“Šå³é‚Šçš„åˆ·æ–°æŒ‰éˆ•é è¦½ã€‚</p>
<h2 id="æ¨¡çµ„å¯¦ä½œ"><a href="#æ¨¡çµ„å¯¦ä½œ" class="headerlink" title="æ¨¡çµ„å¯¦ä½œ"></a>æ¨¡çµ„å¯¦ä½œ</h2><p>ç›®å‰ç‚ºæ­¢æˆ‘å€‘å»ºç«‹ Native Module çš„ Swift æª”æ¡ˆä¸­åªå–®ç´”å®šç¾©äº†æ–¹æ³•ï¼Œæ¥ä¸‹ä¾†éœ€è¦å¯¦ä½œã€‚æˆ‘å€‘åˆ° <code>TimerWidgetModule.swift</code> æª”æ¡ˆä½¿ç”¨ <code>ActivityKit</code> ä¾†æ§åˆ¶ iOS çš„ Live Activity</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> ActivityKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc(TimerWidgetModule)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimerWidgetModule</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">areActivitiesEnabled</span>()</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">ActivityAuthorizationInfo</span>().areActivitiesEnabled</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">startLiveActivity</span>()</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="operator">!</span>areActivitiesEnabled()) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœä½¿ç”¨è€…é—œé–‰ Live Activity å‰‡ä¸åŸ·è¡Œå…¶ä»–æ“ä½œ</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> activityAttributes <span class="operator">=</span> <span class="type">TimerWidgetAttributes</span>()</span><br><span class="line">    <span class="keyword">let</span> contentState <span class="operator">=</span> <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>(startedAt: <span class="type">Date</span>())</span><br><span class="line">    <span class="keyword">let</span> activityContent <span class="operator">=</span> <span class="type">ActivityContent</span>(state: contentState, staleDate: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> <span class="type">Activity</span>.request(</span><br><span class="line">        attributes: activityAttributes,</span><br><span class="line">        content: activityContent</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">stopLiveActivity</span>()</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="type">Task</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> activity <span class="keyword">in</span> <span class="type">Activity</span>&lt;<span class="type">TimerWidgetAttributes</span>&gt;.activities &#123;</span><br><span class="line">        <span class="keyword">await</span> activity.end(<span class="literal">nil</span>, dismissalPolicy: .immediate)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è‹¥é‡åˆ° Cannot find â€˜TimerWidgetAttributesâ€™ in scope éŒ¯èª¤ï¼Œè«‹è¨˜å¾—æª¢æŸ¥ä¸€ä¸‹ TimerWidgetLiveActivity.swift çš„ Target</p>
<p><img src="la-7.png"></p>
</blockquote>
<p>ä¸Šé¢ç¨‹å¼ç¢¼æˆ‘å€‘é¦–å…ˆæª¢æŸ¥äº†ä½¿ç”¨è€…æ˜¯å¦æœ‰é–‹å•Ÿ Live Activity çš„åŠŸèƒ½ã€‚ç„¶å¾Œåœ¨ <code>startLiveActivity()</code> ä½¿ç”¨ <code>Activity.request</code> ã€‚é¡å¤–è£œå……ä¸€é»ï¼Œè‹¥åœ¨ <code>TimerWidgetBridge.m</code> æ­éœ²äº†ä¸åŒåç¨±çš„æ–¹æ³•ä¾‹å¦‚ <code>startActivity</code> å¦‚æ­¤åœ¨ <code>TimerWidgetModule.swift</code> é€™é‚Šå°±è¦ä½¿ç”¨ <code>@objc(startActivity)</code> ã€‚æœ€å¾Œæˆ‘å€‘ä½¿ç”¨ <code>Task</code> ä½µç™¼åŸ·è¡Œç¨‹å¼ç¢ºä¿ä¸»åŸ·è¡Œç·’ä¸æœƒè¢«é˜»å¡ã€‚åœæ­¢æ–¹æ³•ä¸­æˆ‘å€‘åæ­·äº†å…¨éƒ¨ <code>TimerWidgetAttributes</code> çš„æ´»å‹•ä¸¦ç«‹åˆ»çµ‚æ­¢å®ƒå€‘ã€‚<code>await</code> æ˜¯å¿…é ˆçš„å› ç‚º <code>activity.end()</code> æ˜¯éåŒæ­¥æ“ä½œã€‚</p>
<h2 id="React-Native-çš„éƒ¨åˆ†"><a href="#React-Native-çš„éƒ¨åˆ†" class="headerlink" title="React Native çš„éƒ¨åˆ†"></a>React Native çš„éƒ¨åˆ†</h2><p>æ¥è‘—æˆ‘å€‘å°±å¯ä»¥å›åˆ°æˆ‘å€‘ç†Ÿæ‚‰çš„ <code>App.tsx</code> é—œéµçš„ç”¨æ³•å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; NativeModules &#125; from &#x27;react-native&#x27;;</span><br><span class="line">const &#123; TimerWidgetModule &#125; = NativeModules;</span><br><span class="line"></span><br><span class="line">// ...</span><br><span class="line">function App(): React.JSX.Element &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Button</span><br><span class="line">      onPress=&#123;() =&gt; &#123;</span><br><span class="line">        TimerWidgetModule.startLiveActivity();</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®Œæ•´ç¯„ä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123;</span><br><span class="line">  Button,</span><br><span class="line">  SafeAreaView,</span><br><span class="line">  NativeModules,</span><br><span class="line">  View,</span><br><span class="line">  StyleSheet,</span><br><span class="line">&#125; from &#x27;react-native&#x27;;</span><br><span class="line"></span><br><span class="line">const &#123; TimerWidgetModule &#125; = NativeModules;</span><br><span class="line"></span><br><span class="line">function App(): React.JSX.Element &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;SafeAreaView style=&#123;styles.container&#125;&gt;</span><br><span class="line">      &lt;View style=&#123;styles.row&#125;&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">          title=&#x27;é–‹å§‹&#x27;</span><br><span class="line">          onPress=&#123;() =&gt; &#123;</span><br><span class="line">            TimerWidgetModule.startLiveActivity();</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">          title=&#x27;åœæ­¢&#x27;</span><br><span class="line">          onPress=&#123;() =&gt; &#123;</span><br><span class="line">            TimerWidgetModule.stopLiveActivity();</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">    &lt;/SafeAreaView&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">  container: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    justifyContent: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  row: &#123;</span><br><span class="line">    flexDirection: &#x27;row&#x27;,</span><br><span class="line">    justifyContent: &#x27;space-between&#x27;,</span><br><span class="line">    paddingHorizontal: 48,</span><br><span class="line">  &#125;,</span><br><span class="line">  button: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    marginHorizontal: 16,</span><br><span class="line">    backgroundColor: &#x27;cyan&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤æˆ‘å€‘å¯ä»¥æ¸¬è©¦å•Ÿå‹•æˆ‘å€‘çš„ Live Activityï¼Œé»æ“Šé–‹å§‹æŒ‰éˆ•ï¼Œç„¶å¾Œé€€å‡ºæ‡‰ç”¨ç¨‹å¼å°±æœƒçœ‹åˆ° Compact æ¨¡å¼çš„ Live Activityã€‚</p>
<p>æ¥è‘—æˆ‘å€‘å¯ä»¥é€²ä¸€æ­¥ä¾†èª¿æ•´ React Natvie çš„å¯¦ä½œï¼Œæˆ‘å€‘å¸Œæœ›æŠŠ <code>TimerWidgetModule</code> çš„åŠŸèƒ½ä½¿ç”¨ä¸€å€‹ Hook <code>useTimer</code> ä¾†ç®¡ç†å¯¦ä½œã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NativeModules &#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; TimerWidgetModule &#125; = NativeModules;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useTimer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [elapsedTimeInMs, setElapsedTimeInMs] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> startTime = useRef(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> intervalId = useRef(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> elapsedTimeInSeconds = <span class="built_in">Math</span>.floor(elapsedTimeInMs / <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">const</span> secondsOnesDigit = elapsedTimeInSeconds % <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">const</span> secondsTensDigit = <span class="built_in">Math</span>.floor(elapsedTimeInSeconds / <span class="number">10</span>) % <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">const</span> minutes = <span class="built_in">Math</span>.floor(elapsedTimeInSeconds / <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> value = <span class="string">`<span class="subst">$&#123;minutes&#125;</span>:<span class="subst">$&#123;secondsTensDigit&#125;</span><span class="subst">$&#123;secondsOnesDigit&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">play</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!startTime.current) &#123;</span><br><span class="line">      startTime.current = <span class="built_in">Date</span>.now();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TimerWidgetModule.startLiveActivity();</span><br><span class="line"></span><br><span class="line">    intervalId.current = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setElapsedTimeInMs(<span class="built_in">Date</span>.now() - startTime.current);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(intervalId.current);</span><br><span class="line">      intervalId.current = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    startTime.current = <span class="literal">null</span>;</span><br><span class="line">    setElapsedTimeInMs(<span class="number">0</span>);</span><br><span class="line">    TimerWidgetModule.stopLiveActivity();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; value, play, reset &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è£œå……ï¼šé—œæ–¼ Swift çš„æ™‚é–“è³‡æ–™ï¼Œåœ¨ Swift ä¸­çš„æ™‚é–“æˆ³è¨˜å’Œ JavaScript æœ‰äº›ä¸åŒã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> now <span class="operator">=</span> <span class="type">Date</span>()  <span class="comment">// ç•¶å‰æ™‚é–“</span></span><br><span class="line"><span class="keyword">let</span> timestamp <span class="operator">=</span> now.timeIntervalSince1970 <span class="comment">// å¾ 1970-01-01 00:00:00 UTC é–‹å§‹çš„ç§’æ•¸</span></span><br><span class="line"><span class="built_in">print</span>(timestamp) <span class="comment">// 1729945467.745205</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾æ™‚é–“æˆ³è¨˜å»ºç«‹ Date</span></span><br><span class="line"><span class="keyword">let</span> timestamp <span class="operator">=</span> <span class="number">1698393600</span>  <span class="comment">// ä¾‹å¦‚ï¼š2023-10-27 12:00:00 UTC</span></span><br><span class="line"><span class="keyword">let</span> date <span class="operator">=</span> <span class="type">Date</span>(timeIntervalSince1970: timestamp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> start <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"><span class="keyword">let</span> end <span class="operator">=</span> <span class="type">Date</span>().addingTimeInterval(<span class="number">3600</span>) <span class="comment">// åŠ ä¸€å°æ™‚</span></span><br></pre></td></tr></table></figure>

<p>è€Œåœ¨ JavaScript ä¸­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// ç•¶å‰æ™‚é–“</span></span><br><span class="line"><span class="keyword">var</span> timestamp = <span class="built_in">Date</span>.now(); <span class="comment">// è¿”å›æ¯«ç§’æ•¸</span></span><br><span class="line">timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(); <span class="comment">// è¿”å›æ¯«ç§’æ•¸</span></span><br><span class="line"><span class="comment">// å¾æ™‚é–“æˆ³è¨˜å»ºç«‹ Date éœ€è¦ * 1000</span></span><br><span class="line"><span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1698393600</span> * <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line"><span class="keyword">const</span> end = start + <span class="number">3600</span> * <span class="number">1000</span>; <span class="comment">// åŠ ä¸€å°æ™‚ï¼ˆéœ€è¦è½‰æ›ç‚ºæ¯«ç§’ï¼‰</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>æ¥è‘—æˆ‘å€‘å›åˆ° <code>App.tsx</code> ä½¿ç”¨ <code>useTimer</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123;</span><br><span class="line">  Button,</span><br><span class="line">  SafeAreaView,</span><br><span class="line">  NativeModules,</span><br><span class="line">  View,</span><br><span class="line">  StyleSheet,</span><br><span class="line">  Text,</span><br><span class="line">&#125; from &#x27;react-native&#x27;;</span><br><span class="line">import useTimer from &#x27;./useTimer&#x27;;</span><br><span class="line"></span><br><span class="line">function App(): React.JSX.Element &#123;</span><br><span class="line">  const &#123; value, play, reset &#125; = useTimer();</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;SafeAreaView style=&#123;styles.container&#125;&gt;</span><br><span class="line">      &lt;View style=&#123;styles.timer&#125;&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.timerText&#125;&gt;&#123;value&#125;&lt;/Text&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">      &lt;View style=&#123;styles.row&#125;&gt;</span><br><span class="line">        &lt;Button title=&#x27;é–‹å§‹&#x27; onPress=&#123;play&#125; /&gt;</span><br><span class="line">        &lt;Button title=&#x27;åœæ­¢&#x27; onPress=&#123;reset&#125; /&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">    &lt;/SafeAreaView&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">  container: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    justifyContent: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  row: &#123;</span><br><span class="line">    flexDirection: &#x27;row&#x27;,</span><br><span class="line">    justifyContent: &#x27;space-between&#x27;,</span><br><span class="line">    paddingHorizontal: 48,</span><br><span class="line">  &#125;,</span><br><span class="line">  timer: &#123;</span><br><span class="line">    paddingVertical: 32,</span><br><span class="line">  &#125;,</span><br><span class="line">  timerText: &#123;</span><br><span class="line">    fontSize: 80,</span><br><span class="line">    fontVariant: [&#x27;tabular-nums&#x27;],</span><br><span class="line">  &#125;,</span><br><span class="line">  button: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    marginHorizontal: 16,</span><br><span class="line">    backgroundColor: &#x27;cyan&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤æˆ‘å€‘å®Œæˆäº†ä¸€å€‹æ”¯æ´ Live Activity è¨ˆæ™‚å™¨çš„åŸºæœ¬åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘å€‘é‚„æ²’æœ‰å¾ JavaScript é€²ä¸€æ­¥å‚³å…¥åƒæ•¸æ§åˆ¶ã€‚</p>
<p>åœ¨ä»»ä½• React Native æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œæ‡‰ç”¨ç¨‹å¼çš„ç‹€æ…‹é€šå¸¸éƒ½å­˜åœ¨æ–¼ React ç’°å¢ƒä¸­ï¼Œé€™äº›ç‹€æ…‹é€šå¸¸è¢«å­˜æ”¾åœ¨å€åŸŸç‹€æ…‹ä¸­ <code>useState</code>ï¼Œæˆ–æ˜¯ä½¿ç”¨ Context API ã€‚å¦‚æ­¤ä¸€ä¾†æˆ‘å€‘çš„ä»‹é¢å°±å¯ä»¥ä¾æ“šé€™äº›ç‹€æ…‹è®ŠåŒ–ã€‚ä¾‹å¦‚ <code>useTimer</code> ä¸­çš„ <code>elapsedTimeInMs</code> è®Šæ•¸ç”¨æ–¼è¡¨ç¤ºå¾é–‹å§‹ç¶“éäº†å¤šå°‘æ™‚é–“ã€‚é€™å€‹è®Šæ•¸é€šé <code>setInterval</code> æ¯ç§’é€²è¡Œæ›´æ–°ã€‚</p>
<p>é™¤äº†ç›´æ¥é©…å‹•è¦–åœ–çš„è³‡æ–™ï¼Œæœ‰æ™‚å€™é‚„æœ‰ä¸€äº›æœƒå½±éŸ¿æ‡‰ç”¨ç¨‹å¼æ•´é«”çš„é‹ä½œç‹€æ…‹ï¼Œã€Œä¸ç›´æ¥å½±éŸ¿è¦–åœ–ä½†å¾ˆé‡è¦çš„è³‡æ–™ã€ã€‚ä¾‹å¦‚è¨ˆæ™‚å™¨é–‹å§‹æ™‚å–å¾—çš„æ™‚é–“æˆ³è¨˜ã€‚ç•¶æˆ‘å€‘é»æ“Šã€Œé–‹å§‹ã€æŒ‰éˆ•ï¼Œæ‡‰ç”¨ç¨‹å¼æ“·å–äº†ç•¶ä¸‹çš„æ™‚é–“ä¸¦ä½¿ç”¨ <code>useRef</code> ç´€éŒ„ä¸‹ä¾†ã€‚</p>
<p>Native Module çš„æ“ä½œå’Œ JavaScript åœ¨ä¸åŒåŸ·è¡Œç·’ï¼Œé€™è¡¨ç¤ºå•Ÿå‹• Live Activity å’Œæˆ‘å€‘åœ¨ React ä¸­çš„ Interval å¯èƒ½ç„¡æ³•ç²¾æº–ä¸€è‡´ã€‚ç‚ºäº†å½Œè£œé€™å€‹å·®è·æˆ‘å€‘å¯ä»¥å°‡é–‹å§‹çš„æ™‚é–“æˆ³è¨˜å‚³å…¥ Native Moduleã€‚å¦‚æ­¤æˆ‘å€‘å¯ä»¥æ¸¬é‡æ©‹æ¥æ‰€èŠ±è²»çš„æ™‚é–“ï¼Œä¸¦åœ¨ Live Activity è¨ˆæ™‚å•Ÿå‹•ä¹‹å‰é€šçŸ¥ Swift åç§»çš„æ•¸æ“šï¼Œå¢å¼·å…©å€‹ç³»çµ±ä¹‹é–“çš„åŒæ­¥æ€§ã€‚</p>
<p>ä¸éæ³¨æ„åˆ°æˆ‘å€‘æ˜¯èªªã€Œå¢å¼·ã€è€Œä¸æ˜¯ä¿®æ­£ã€‚å› ç‚ºä¸€äº›å¤–éƒ¨å› ç´ æœƒå½±éŸ¿äº†å…©å€‹è¨ˆæ™‚çš„ç²¾åº¦ï¼Œä¾‹å¦‚æ¸²æŸ“éç¨‹ï¼Œé‚„æœ‰ä¸åŒç³»çµ±çš„æ™‚é–“ tick é‚„æ˜¯æœ‰æ‰€å·®ç•°ã€‚</p>
<p>ä»¥ React ç‚ºä¾‹ï¼Œæ‡‰ç”¨ç¨‹å¼éœ€è¦æ‰‹å‹•è¨­å®šä¸€å€‹è¨ˆæ™‚å™¨ï¼Œæ¯ 32 æ¯«ç§’ï¼ˆç´„ 30FPSï¼‰è¨ˆç®—ä¸€æ¬¡ç¶“éçš„æ™‚é–“ï¼Œé€™æ˜¯ç‚ºäº†åœ¨è¦–è¦ºé«”é©—å’Œæ•ˆèƒ½ä¹‹é–“å–å¾—å¹³è¡¡ã€‚ç›¸è¼ƒä¹‹ä¸‹ï¼Œåœ¨ Live Activity ä¸­ï¼Œé€™å€‹è¨ˆæ™‚çš„è·è²¬æ˜¯ç›´æ¥å§”è¨—çµ¦ä½œæ¥­ç³»çµ±çš„ï¼Œåªéœ€è¦åœ¨ <code>Date</code> ç‰©ä»¶ä¸Šä½¿ç”¨ <code>.timer</code> æ¨£å¼å³å¯ã€‚é€™å°±æ˜¯å…©å€‹ç³»çµ±åœ¨è™•ç†æ™‚é–“ä¸Šçš„å€åˆ¥ã€‚</p>
<p>è¦å°‡åƒæ•¸å¾ JavaScript å‚³å…¥ Native Moduleï¼š</p>
<ol>
<li>æ›´æ–° <code>TimerWidgetBridge.m</code> ç‚º <code>startLiveActivity</code> æ–¹æ³•å®šç¾©åƒæ•¸</li>
<li>åœ¨ <code>TimerWidgetModule.swift</code> ä¸­ä½¿ç”¨åƒæ•¸</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;React/RCTBridgeModule.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RCT_EXTERN_MODULE</span>(<span class="title">TimerWidgetModule</span>, <span class="title">NSObject</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">bool</span>)requiresMainQueueSetup &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RCT_EXTERN_METHOD(startLiveActivity:(<span class="keyword">nonnull</span> <span class="keyword">double</span> *)timestamp)</span><br><span class="line">RCT_EXTERN_METHOD(stopLiveActivity)</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ iOS ï¼Œ<code>Date</code> é¡åˆ¥æ˜¯å¾ <code>Foundation</code> æ¡†æ¶å–å¾—çš„ï¼Œä¸€èˆ¬ç”¨ä¾†è™•ç†æ™‚é–“æˆ³è¨˜ï¼Œé è¨­ä½¿ç”¨å–®ä½ç‚ºã€Œç§’ã€ã€‚ä½†æ˜¯ JavaScript å‰‡æ˜¯æ¯«ç§’ msã€‚ä¹Ÿå°±æ˜¯æˆ‘å€‘éœ€è¦åœ¨å…©è€…å‚³è¼¸éç¨‹é€²è¡Œè™•ç†ï¼Œç‚ºäº†é¿å…å¤±å»ç²¾åº¦ï¼Œæˆ‘å€‘ä½¿ç”¨ <code>double</code> å‹åˆ¥ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> ActivityKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc(TimerWidgetModule)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimerWidgetModule</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> startedAt: <span class="type">Date</span>?</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">areActivitiesEnabled</span>()</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">ActivityAuthorizationInfo</span>().areActivitiesEnabled</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">startLiveActivity</span>(<span class="keyword">_</span> <span class="params">timestamp</span>: <span class="type">Double</span>)</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="operator">!</span>areActivitiesEnabled()) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœä½¿ç”¨è€…é—œé–‰ Live Activity å‰‡ä¸åŸ·è¡Œå…¶ä»–æ“ä½œ</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    startedAt <span class="operator">=</span> <span class="type">Date</span>(timeIntervalSince1970: timestamp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> activityAttributes <span class="operator">=</span> <span class="type">TimerWidgetAttributes</span>()</span><br><span class="line">    <span class="keyword">let</span> contentState <span class="operator">=</span> <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>(startedAt: startedAt)</span><br><span class="line">    <span class="keyword">let</span> activityContent <span class="operator">=</span> <span class="type">ActivityContent</span>(state: contentState, staleDate: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> <span class="type">Activity</span>.request(</span><br><span class="line">        attributes: activityAttributes,</span><br><span class="line">        content: activityContent</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">stopLiveActivity</span>()</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    startedAt <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">    <span class="type">Task</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> activity <span class="keyword">in</span> <span class="type">Activity</span>&lt;<span class="type">TimerWidgetAttributes</span>&gt;.activities &#123;</span><br><span class="line">        <span class="keyword">await</span> activity.end(<span class="literal">nil</span>, dismissalPolicy: .immediate)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨æˆ‘å€‘çš„ <code>startLiveActivity</code> æ–¹æ³•å¯ä»¥å‚³å…¥åƒæ•¸ã€‚æ™‚é–“æˆ³è¨˜ <code>timestamp</code> å‚³å…¥ä¸¦å„²å­˜åœ¨ <code>startedAt</code> å±¬æ€§æ–¹ä¾¿å¾ŒçºŒ Live Activity ä½¿ç”¨ã€‚æœ€å¾Œæˆ‘å€‘å°±å¯ä»¥åœ¨ <code>useTimer</code> å°‡åƒæ•¸å‚³å…¥ Native Module</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TimerWidgetModule.startLiveActivity(startTime.current / <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p><strong>å¯¦ä½œæš«åœå’Œæ¢å¾©</strong></p>
<p>åˆ°æ­¤æˆ‘å€‘çš„è¨ˆæ™‚å™¨æœ‰ 2 å€‹åŸºæœ¬çš„åŠŸèƒ½ï¼šé–‹å§‹ã€åœæ­¢ã€‚ä¸‹ä¸€æ­¥æˆ‘å€‘å°‡åŠ å…¥æš«åœçš„åŠŸèƒ½ã€‚é€™è£¡æˆ‘å€‘å¾ <code>useTimer</code> é–‹å§‹è‘—æ‰‹èª¿æ•´æ‰€éœ€çš„é‚è¼¯ä½¿å…¶å¯ä»¥æš«åœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NativeModules &#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; TimerWidgetModule &#125; = NativeModules;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useTimer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [elapsedTimeInMs, setElapsedTimeInMs] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isPlaying, setIsPlaying] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> startTime = useRef(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> pausedTime = useRef(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> intervalId = useRef(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> elapsedTimeInSeconds = <span class="built_in">Math</span>.floor(elapsedTimeInMs / <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">const</span> secondsOnesDigit = elapsedTimeInSeconds % <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">const</span> secondsTensDigit = <span class="built_in">Math</span>.floor(elapsedTimeInSeconds / <span class="number">10</span>) % <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">const</span> minutes = <span class="built_in">Math</span>.floor(elapsedTimeInSeconds / <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> value = <span class="string">`<span class="subst">$&#123;minutes&#125;</span>:<span class="subst">$&#123;secondsTensDigit&#125;</span><span class="subst">$&#123;secondsOnesDigit&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">play</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIsPlaying(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!startTime.current) &#123;</span><br><span class="line">      startTime.current = <span class="built_in">Date</span>.now();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pausedTime.current) &#123;</span><br><span class="line">      <span class="comment">// è‹¥è¨ˆæ™‚å™¨è™•æ–¼æš«åœï¼Œå‰‡æ›´æ–° startTime</span></span><br><span class="line">      <span class="keyword">const</span> elapsedSincePaused = <span class="built_in">Date</span>.now() - pausedTime.current;</span><br><span class="line">      startTime.current = startTime.current + elapsedSincePaused;</span><br><span class="line">      pausedTime.current = <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      TimerWidgetModule.startLiveActivity(startTime.current / <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    intervalId.current = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setElapsedTimeInMs(<span class="built_in">Date</span>.now() - startTime.current);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">pause</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIsPlaying(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(intervalId.current);</span><br><span class="line">      intervalId.current = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (startTime.current &amp;&amp; !pausedTime.current) &#123;</span><br><span class="line">      pausedTime.current = <span class="built_in">Date</span>.now();</span><br><span class="line">      setElapsedTimeInMs(pausedTime.current - startTime.current);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIsPlaying(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(intervalId.current);</span><br><span class="line">      intervalId.current = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    startTime.current = <span class="literal">null</span>;</span><br><span class="line">    pausedTime.current = <span class="literal">null</span>;</span><br><span class="line">    setElapsedTimeInMs(<span class="number">0</span>);</span><br><span class="line">    TimerWidgetModule.stopLiveActivity();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; value, play, pause, reset, isPlaying &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤æˆ‘å€‘çš„ <code>useTimer</code> æ–°å¢äº† <code>pause()</code> å’Œ <code>isPlaying</code> æˆ‘å€‘å¯ä»¥å›åˆ° <code>App</code> åŠ å…¥æ–°åŠŸèƒ½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; Button, SafeAreaView, View, StyleSheet, Text &#125; from &#x27;react-native&#x27;;</span><br><span class="line">import useTimer from &#x27;./useTimer&#x27;;</span><br><span class="line"></span><br><span class="line">function App(): React.JSX.Element &#123;</span><br><span class="line">  const &#123; value, play, reset, pause, isPlaying &#125; = useTimer();</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;SafeAreaView style=&#123;styles.container&#125;&gt;</span><br><span class="line">      &lt;View style=&#123;styles.timer&#125;&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.timerText&#125;&gt;&#123;value&#125;&lt;/Text&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">      &lt;View style=&#123;styles.row&#125;&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">          title=&#123;isPlaying ? &#x27;æš«åœ&#x27; : &#x27;é–‹å§‹&#x27;&#125;</span><br><span class="line">          onPress=&#123;isPlaying ? pause : play&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;Button title=&#x27;åœæ­¢&#x27; onPress=&#123;reset&#125; /&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">    &lt;/SafeAreaView&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">  container: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    justifyContent: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  row: &#123;</span><br><span class="line">    flexDirection: &#x27;row&#x27;,</span><br><span class="line">    justifyContent: &#x27;space-between&#x27;,</span><br><span class="line">    paddingHorizontal: 48,</span><br><span class="line">  &#125;,</span><br><span class="line">  timer: &#123;</span><br><span class="line">    paddingVertical: 32,</span><br><span class="line">    alignItems: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  timerText: &#123;</span><br><span class="line">    fontSize: 80,</span><br><span class="line">    fontVariant: [&#x27;tabular-nums&#x27;],</span><br><span class="line">  &#125;,</span><br><span class="line">  button: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    marginHorizontal: 16,</span><br><span class="line">    backgroundColor: &#x27;cyan&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<p>åœ¨ React çš„éƒ¨åˆ†æˆ‘å€‘å®Œæˆäº†ï¼Œä½†æ˜¯ Native Module ç›®å‰æ²’æœ‰æš«åœï¼Œä¹Ÿå°±æ˜¯ç•¶æˆ‘å€‘é»æ“Šæš«åœçš„æ™‚å€™ï¼ŒLive Activity ä¾ç„¶ç¹¼çºŒè¨ˆæ™‚ï¼Œç›´åˆ°æˆ‘å€‘é»æ“Šäº†åœæ­¢ã€‚æ¥è‘—ï¼Œæˆ‘å€‘è¦å¢åŠ  Native Module çš„åŠŸèƒ½ã€‚</p>
<p>ç•¶è¨ˆæ™‚å™¨é»æ“Šæš«åœçš„ç¬é–“ï¼Œæ‡‰ç”¨ç¨‹å¼æœƒæ“·å–ç•¶ä¸‹çš„æ™‚é–“æˆ³è¨˜ï¼Œé€™å€‹è³‡æ–™æˆ‘å€‘éœ€è¦å‚³éçµ¦ iOS ç«¯ã€‚æˆ‘å€‘éœ€è¦åœ¨ <code>TimerWidgetBridge.m</code> æ–°å¢ 2 å€‹æ–¹æ³• <code>pause</code> å’Œ <code>resume</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  TimerWidgetBridge.m</span></span><br><span class="line"><span class="comment">//  Timer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by YOUZONGYAN on 2024/10/26.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;React/RCTBridgeModule.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RCT_EXTERN_MODULE</span>(<span class="title">TimerWidgetModule</span>, <span class="title">NSObject</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">bool</span>)requiresMainQueueSetup &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RCT_EXTERN_METHOD(startLiveActivity:(<span class="keyword">nonnull</span> <span class="keyword">double</span> *)timestamp)</span><br><span class="line">RCT_EXTERN_METHOD(pause:(<span class="keyword">nonnull</span> <span class="keyword">double</span> *)timestamp)</span><br><span class="line">RCT_EXTERN_METHOD(resume)</span><br><span class="line">RCT_EXTERN_METHOD(stopLiveActivity)</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>ç‚ºäº†å¯¦ä½œæš«åœåŠŸèƒ½æˆ‘å€‘éœ€è¦åœ¨ <code>TimerWidgetAttributes</code> åŠ å…¥æ–°çš„ç‹€æ…‹ - <code>pausedAt</code>ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘å€‘ç›®å‰çš„è¨ˆæ™‚å™¨å¯¦ä½œä¸»è¦æ˜¯ä¾è³´ <code>Date</code> åŠ ä¸Š <code>.timer</code> æ¨£å¼é”æˆçš„ï¼Œä½†æ˜¯ç³»çµ±ä¸¦æ²’æœ‰æä¾›æš«åœå’Œæ¢å¾©è¨ˆæ™‚çš„åŠŸèƒ½ã€‚å› æ­¤æˆ‘å€‘é‚„æ˜¯å¾—è‡ªè¡Œè¨ˆç®—ã€‚ç‚ºæ­¤æˆ‘å€‘èª¿æ•´ <code>TimerWidgetLiveActivity.swift</code> åŠ å…¥ <code>getPausedTime</code> ç­‰</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ActivityKit</span><br><span class="line"><span class="keyword">import</span> WidgetKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimerWidgetAttributes</span>: <span class="title">ActivityAttributes</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ContentState</span>: <span class="title">Codable</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> startedAt: <span class="type">Date</span>?</span><br><span class="line">    <span class="keyword">var</span> pausedAt: <span class="type">Date</span>?</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getElapsedTimeInSeconds</span>()</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> now <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> startedAt <span class="operator">=</span> <span class="keyword">self</span>.startedAt <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> pausedAt <span class="operator">=</span> <span class="keyword">self</span>.pausedAt <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Int</span>(now.timeIntervalSince1970 <span class="operator">-</span> startedAt.timeIntervalSince1970)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">Int</span>(pausedAt.timeIntervalSince1970 <span class="operator">-</span> startedAt.timeIntervalSince1970)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getPausedTime</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> elapsedTimeInSeconds <span class="operator">=</span> getElapsedTimeInSeconds()</span><br><span class="line">      <span class="keyword">let</span> minutes <span class="operator">=</span> (elapsedTimeInSeconds <span class="operator">%</span> <span class="number">3600</span>) <span class="operator">/</span> <span class="number">60</span></span><br><span class="line">      <span class="keyword">let</span> seconds <span class="operator">=</span> elapsedTimeInSeconds <span class="operator">%</span> <span class="number">60</span></span><br><span class="line">      <span class="keyword">return</span> <span class="type">String</span>(format: <span class="string">&quot;%d:%02d&quot;</span>, minutes, seconds)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getTimeIntervalSinceNow</span>()</span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> startedAt <span class="operator">=</span> <span class="keyword">self</span>.startedAt <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> startedAt.timeIntervalSince1970 <span class="operator">-</span> <span class="type">Date</span>().timeIntervalSince1970</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isRunning</span>()</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> pausedAt <span class="operator">==</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç‹€æ…‹è™•ç†å¥½äº†ä¹‹å¾Œæˆ‘å€‘é‚„éœ€è¦è™•ç† UI çš„éƒ¨åˆ†ï¼Œæ³¨æ„æœ‰ä½¿ç”¨ <code>.timer</code> çš„åœ°æ–¹éƒ½éœ€è¦èª¿æ•´</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DynamicIslandExpandedRegion</span>(.center) &#123;</span><br><span class="line">  <span class="keyword">if</span> (context.state.isRunning()) &#123;</span><br><span class="line">    <span class="type">Text</span>(</span><br><span class="line">      <span class="type">Date</span>(timeIntervalSinceNow: context.state.getTimeIntervalSinceNow()),</span><br><span class="line">      style: .timer</span><br><span class="line">    )</span><br><span class="line">    .font(.title)</span><br><span class="line">    .foregroundColor(.cyan)</span><br><span class="line">    .fontWeight(.medium)</span><br><span class="line">    .monospacedDigit()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="type">Text</span>(</span><br><span class="line">      context.state.getPausedTime()</span><br><span class="line">    )</span><br><span class="line">    .font(.title)</span><br><span class="line">    .foregroundColor(.cyan)</span><br><span class="line">    .fontWeight(.medium)</span><br><span class="line">    .monospacedDigit()</span><br><span class="line">    .transition(.identity)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125; compactTrailing: &#123;</span><br><span class="line">  <span class="keyword">if</span> (context.state.isRunning()) &#123;</span><br><span class="line">    <span class="type">Text</span>(</span><br><span class="line">      <span class="type">Date</span>(timeIntervalSinceNow: context.state.getTimeIntervalSinceNow()),</span><br><span class="line">      style: .timer</span><br><span class="line">    )</span><br><span class="line">    .foregroundColor(.cyan)</span><br><span class="line">    .frame(maxWidth: <span class="number">32</span>)</span><br><span class="line">    .monospacedDigit()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="type">Text</span>(</span><br><span class="line">      context.state.getPausedTime()</span><br><span class="line">    )</span><br><span class="line">    .font(.title)</span><br><span class="line">    .foregroundColor(.cyan)</span><br><span class="line">    .fontWeight(.medium)</span><br><span class="line">    .monospacedDigit()</span><br><span class="line">    .transition(.identity)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>TimerWidgetModule</code> é¡åˆ¥ä¸»è¦è² è²¬æ˜¯åœ¨ Swift ä¸­ç®¡ç†è¨ˆæ™‚å™¨çš„ç‹€æ…‹ã€‚åˆ°ç›®å‰ç‚ºæ­¢ï¼Œå®ƒåªè™•ç† <code>startedAt</code> ã€‚æ¥è‘—æˆ‘å€‘éœ€è¦åœ¨ <code>TimerWidgetModule</code> è™•ç† <code>pausedAt</code>ï¼Œä¸¦ä¸”å¯¦ä½œæˆ‘å€‘ä¸€é–‹å§‹å®šç¾©å¥½çš„ <code>pause</code> å’Œ <code>resume</code> æ–¹æ³• ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘å€‘é‚„éœ€è¦åŠ å…¥ <code>currentActivity</code> å±¬æ€§ï¼Œå¦‚æ­¤æˆ‘å€‘æ‰èƒ½å¤ ç›´æ¥æ›´æ–° Live Activity çš„ç‹€æ…‹ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> ActivityKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc(TimerWidgetModule)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimerWidgetModule</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> currentActivity: <span class="type">Activity</span>&lt;<span class="type">TimerWidgetAttributes</span>&gt;?</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> startedAt: <span class="type">Date</span>?</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> pausedAt: <span class="type">Date</span>?</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">areActivitiesEnabled</span>()</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">ActivityAuthorizationInfo</span>().areActivitiesEnabled</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">resetValues</span>()</span> &#123;</span><br><span class="line">    startedAt <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">    pausedAt <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">    currentActivity <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">startLiveActivity</span>(<span class="keyword">_</span> <span class="params">timestamp</span>: <span class="type">Double</span>)</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="operator">!</span>areActivitiesEnabled()) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœä½¿ç”¨è€…é—œé–‰ Live Activity å‰‡ä¸åŸ·è¡Œå…¶ä»–æ“ä½œ</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    startedAt <span class="operator">=</span> <span class="type">Date</span>(timeIntervalSince1970: timestamp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> activityAttributes <span class="operator">=</span> <span class="type">TimerWidgetAttributes</span>()</span><br><span class="line">    <span class="keyword">let</span> contentState <span class="operator">=</span> <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>(startedAt: startedAt)</span><br><span class="line">    <span class="keyword">let</span> activityContent <span class="operator">=</span> <span class="type">ActivityContent</span>(state: contentState, staleDate: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      currentActivity <span class="operator">=</span> <span class="keyword">try</span> <span class="type">Activity</span>.request(</span><br><span class="line">        attributes: activityAttributes,</span><br><span class="line">        content: activityContent</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pause</span>(<span class="keyword">_</span> <span class="params">timestamp</span>: <span class="type">Double</span>)</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    pausedAt <span class="operator">=</span> <span class="type">Date</span>(timeIntervalSince1970: timestamp)</span><br><span class="line">    <span class="keyword">let</span> contentState <span class="operator">=</span> <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>(startedAt: startedAt, pausedAt: pausedAt)</span><br><span class="line"></span><br><span class="line">    <span class="type">Task</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> currentActivity<span class="operator">?</span>.update(</span><br><span class="line">        <span class="type">ActivityContent</span>&lt;<span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>&gt;(</span><br><span class="line">          state: contentState,</span><br><span class="line">          staleDate: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">resume</span>()</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> startTime <span class="operator">=</span> <span class="keyword">self</span>.startedAt <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> pauseTime <span class="operator">=</span> <span class="keyword">self</span>.pausedAt <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">let</span> elapsedSincePaused <span class="operator">=</span> <span class="type">Date</span>().timeIntervalSince1970 <span class="operator">-</span> pauseTime.timeIntervalSince1970</span><br><span class="line">    startedAt <span class="operator">=</span> <span class="type">Date</span>(timeIntervalSince1970: startTime.timeIntervalSince1970 <span class="operator">+</span> elapsedSincePaused)</span><br><span class="line">    pausedAt <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">let</span> contentState <span class="operator">=</span> <span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>(startedAt: startedAt, pausedAt: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    <span class="type">Task</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> currentActivity<span class="operator">?</span>.update(</span><br><span class="line">        <span class="type">ActivityContent</span>&lt;<span class="type">TimerWidgetAttributes</span>.<span class="type">ContentState</span>&gt;(</span><br><span class="line">          state: contentState,</span><br><span class="line">          staleDate: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@objc</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">stopLiveActivity</span>()</span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    resetValues()</span><br><span class="line">    <span class="type">Task</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> activity <span class="keyword">in</span> <span class="type">Activity</span>&lt;<span class="type">TimerWidgetAttributes</span>&gt;.activities &#123;</span><br><span class="line">        <span class="keyword">await</span> activity.end(<span class="literal">nil</span>, dismissalPolicy: .immediate)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘å€‘åœ¨ <code>useTimer</code> ä½¿ç”¨å¯¦ä½œå¥½çš„ <code>pause()</code> å’Œ <code>resume()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NativeModules &#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; TimerWidgetModule &#125; = NativeModules;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useTimer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [elapsedTimeInMs, setElapsedTimeInMs] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isPlaying, setIsPlaying] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> startTime = useRef(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> pausedTime = useRef(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> intervalId = useRef(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> elapsedTimeInSeconds = <span class="built_in">Math</span>.floor(elapsedTimeInMs / <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">const</span> secondsOnesDigit = elapsedTimeInSeconds % <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">const</span> secondsTensDigit = <span class="built_in">Math</span>.floor(elapsedTimeInSeconds / <span class="number">10</span>) % <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">const</span> minutes = <span class="built_in">Math</span>.floor(elapsedTimeInSeconds / <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> value = <span class="string">`<span class="subst">$&#123;minutes&#125;</span>:<span class="subst">$&#123;secondsTensDigit&#125;</span><span class="subst">$&#123;secondsOnesDigit&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">play</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIsPlaying(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!startTime.current) &#123;</span><br><span class="line">      startTime.current = <span class="built_in">Date</span>.now();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pausedTime.current) &#123;</span><br><span class="line">      <span class="comment">// è‹¥è¨ˆæ™‚å™¨è™•æ–¼æš«åœï¼Œå‰‡æ›´æ–° startTime</span></span><br><span class="line">      <span class="keyword">const</span> elapsedSincePaused = <span class="built_in">Date</span>.now() - pausedTime.current;</span><br><span class="line">      startTime.current = startTime.current + elapsedSincePaused;</span><br><span class="line">      pausedTime.current = <span class="literal">null</span>;</span><br><span class="line">      TimerWidgetModule.resume();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      TimerWidgetModule.startLiveActivity(startTime.current / <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    intervalId.current = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setElapsedTimeInMs(<span class="built_in">Date</span>.now() - startTime.current);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">pause</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIsPlaying(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(intervalId.current);</span><br><span class="line">      intervalId.current = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (startTime.current &amp;&amp; !pausedTime.current) &#123;</span><br><span class="line">      pausedTime.current = <span class="built_in">Date</span>.now();</span><br><span class="line">      TimerWidgetModule.pause(pausedTime.current / <span class="number">1000</span>);</span><br><span class="line">      setElapsedTimeInMs(pausedTime.current - startTime.current);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIsPlaying(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(intervalId.current);</span><br><span class="line">      intervalId.current = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    startTime.current = <span class="literal">null</span>;</span><br><span class="line">    pausedTime.current = <span class="literal">null</span>;</span><br><span class="line">    setElapsedTimeInMs(<span class="number">0</span>);</span><br><span class="line">    TimerWidgetModule.stopLiveActivity();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; value, play, pause, reset, isPlaying &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤æˆ‘å€‘å®Œæˆã€Œæš«åœã€åŠŸèƒ½ã€‚</p>
<p>å¾ iOS 17 é–‹å§‹ï¼Œè˜‹æœåŠ å…¥äº†å¯äº’å‹•çš„ Live Activity ã€‚è—‰ç”±æ­é… App Intent åœ¨ Live Activity ä¸ŠåŠ å…¥ä¸€äº›æ§åˆ¶åŠŸèƒ½ç­‰ã€‚ä¾‹å¦‚æˆ‘å€‘çš„è¨ˆæ™‚å™¨å¯ä»¥åœ¨ Live Activity æä¾›æš«åœå’Œåœæ­¢åŠŸèƒ½çš„æŒ‰éˆ•ã€‚</p>
<p>App Intent æ˜¯ iOS æ”¯æ´çš„ä¸€å€‹åŠŸèƒ½ï¼Œä¸»è¦ç”¨ä¾†å»ºç«‹å’Œç®¡ç†ã€Œæ·å¾‘ã€ä»¥åŠè™•ç†è‡ªå‹•åŒ–ã€‚é¦–æ¬¡ç™¼ä½ˆæ–¼ iOS 16ï¼Œé€™å€‹åŠŸèƒ½å¯ä»¥è®“é–‹ç™¼è€…å°‡åŠŸèƒ½æ“´å±•ç‚º iOS ç³»çµ±å…ƒä»¶ï¼Œä¾‹å¦‚ Live Activityã€Siriã€æ·å¾‘ã€‚æ¯ä¸€å€‹ Live Activity ä¸­çš„äº’å‹•æ“ä½œå°æ‡‰ä¸€å€‹ <code>LiveActivityIntent</code> é€™æ˜¯åŸºæ–¼ <code>AppIntent</code> æ“´å……çš„å”è­°ã€‚é‡å°æˆ‘å€‘çš„ç›®æ¨™æˆ‘å€‘å¯ä»¥å®£å‘Š 3 å€‹ä½¿ç”¨è€…æœƒä½¿ç”¨åˆ°çš„æ“ä½œ <code>resume</code> ã€<code>pause</code> ã€<code>stop</code>ã€‚</p>
<p>æˆ‘å€‘å¾å»ºç«‹ <code>TimerWidgetLiveActivityIntent.swift</code> é–‹å§‹ã€‚è«‹æª¢æŸ¥ Target è¦å‹¾é¸æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼è€Œä¸æ˜¯ Widget Extension</p>
<p>å¯¦ä½œ <code>LiveActivityIntent</code> é ˆæä¾› <code>title</code> å’Œ <code>perform</code> å‡½å¼ï¼Œ<code>perform</code> å‡½å¼å¿…é ˆå›å‚³ä¸€å€‹ <code>IntentResult</code>ï¼ˆæ„åœ–çµæœï¼‰ã€‚æœ€å¸¸è¦‹çš„ä¾‹å­å°±æ˜¯ä½¿ç”¨ Swift å®šç¾©çš„ <code>.result()</code> ä¾†è¡¨ç¤ºé€™å€‹ App Intent çš„åŸ·è¡Œå·²ç¶“å®Œæˆã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> AppIntents</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">PauseIntent</span>: <span class="title">LiveActivityIntent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">LocalizedStringResource</span> <span class="operator">=</span> <span class="string">&quot;æš«åœ&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">perform</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="keyword">some</span> <span class="type">IntentResult</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> .result()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ResumeIntent</span>: <span class="title">LiveActivityIntent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">LocalizedStringResource</span> <span class="operator">=</span> <span class="string">&quot;ç¹¼çºŒ&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">perform</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="keyword">some</span> <span class="type">IntentResult</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> .result()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ResetIntent</span>: <span class="title">LiveActivityIntent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">LocalizedStringResource</span> <span class="operator">=</span> <span class="string">&quot;é‡ç½®&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">perform</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="keyword">some</span> <span class="type">IntentResult</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> .result()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å›åˆ° <code>TimerWidgetLiveActivity.swift</code> åœ¨å±•é–‹æ¨¡å¼ Expanded å¯¦ä½œæŒ‰éˆ•</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DynamicIsland</span> &#123;</span><br><span class="line">  <span class="type">DynamicIslandExpandedRegion</span>(.center) &#123;</span><br><span class="line">    <span class="type">ZStack</span> &#123;</span><br><span class="line">      <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">24</span>).strokeBorder(<span class="type">Color</span>(red: <span class="number">148</span><span class="operator">/</span><span class="number">255.0</span>, green: <span class="number">164</span><span class="operator">/</span><span class="number">255.0</span>, blue: <span class="number">184</span><span class="operator">/</span><span class="number">255.0</span>), lineWidth: <span class="number">2</span>)</span><br><span class="line">      <span class="type">HStack</span> &#123;</span><br><span class="line">        <span class="type">HStack</span>(spacing: <span class="number">8.0</span>, content: &#123;</span><br><span class="line">          <span class="keyword">if</span> (context.state.isRunning()) &#123;</span><br><span class="line">            <span class="type">Button</span>(intent: <span class="type">PauseIntent</span>()) &#123;</span><br><span class="line">              <span class="type">ZStack</span> &#123;</span><br><span class="line">                <span class="type">Circle</span>().fill(<span class="type">Color</span>.cyan.opacity(<span class="number">0.5</span>))</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;pause.fill&quot;</span>)</span><br><span class="line">                  .imageScale(.large)</span><br><span class="line">                  .foregroundColor(.cyan)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;.buttonStyle(<span class="type">PlainButtonStyle</span>())</span><br><span class="line">              .contentShape(<span class="type">Rectangle</span>())</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Button</span>(intent: <span class="type">ResumeIntent</span>()) &#123;</span><br><span class="line">              <span class="type">ZStack</span> &#123;</span><br><span class="line">                <span class="type">Circle</span>().fill(<span class="type">Color</span>.cyan.opacity(<span class="number">0.5</span>))</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;play.fill&quot;</span>)</span><br><span class="line">                  .imageScale(.large)</span><br><span class="line">                  .foregroundColor(.cyan)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .buttonStyle(<span class="type">PlainButtonStyle</span>())</span><br><span class="line">            .contentShape(<span class="type">Rectangle</span>())</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="type">Button</span>(intent: <span class="type">ResetIntent</span>()) &#123;</span><br><span class="line">            <span class="type">ZStack</span> &#123;</span><br><span class="line">              <span class="type">Circle</span>().fill(.gray.opacity(<span class="number">0.5</span>))</span><br><span class="line">              <span class="type">Image</span>(systemName: <span class="string">&quot;xmark&quot;</span>)</span><br><span class="line">                .imageScale(.medium)</span><br><span class="line">                .foregroundColor(.white)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          .buttonStyle(<span class="type">PlainButtonStyle</span>())</span><br><span class="line">          .contentShape(<span class="type">Rectangle</span>())</span><br><span class="line"></span><br><span class="line">          <span class="type">Spacer</span>()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (context.state.isRunning()) &#123;</span><br><span class="line">          <span class="type">Text</span>(</span><br><span class="line">            <span class="type">Date</span>(timeIntervalSinceNow: context.state.getTimeIntervalSinceNow()),</span><br><span class="line">            style: .timer</span><br><span class="line">          )</span><br><span class="line">          .font(.title)</span><br><span class="line">          .foregroundColor(.cyan)</span><br><span class="line">          .fontWeight(.medium)</span><br><span class="line">          .monospacedDigit()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="type">Text</span>(</span><br><span class="line">            context.state.getPausedTime()</span><br><span class="line">          )</span><br><span class="line">          .font(.title)</span><br><span class="line">          .foregroundColor(.cyan)</span><br><span class="line">          .fontWeight(.medium)</span><br><span class="line">          .monospacedDigit()</span><br><span class="line">          .transition(.identity)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;.padding()</span><br><span class="line">    &#125;.padding()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç•¶æˆ‘å€‘å¯¦ä½œäº†ä¸Šé¢çš„ç¨‹å¼ç¢¼æœƒç™¼ç¾ <code>TimerWidgetLiveActivity.swift</code> å»ºç½®å¤±æ•—ã€‚Live Activity çš„ Target åŒæ™‚å‹¾é¸äº†æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼å’Œ Widget Extensionã€‚ä½†æ˜¯æˆ‘å€‘çš„ Intent Target åªæœ‰æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼ï¼Œå› æ­¤åœ¨ <code>TimerWidgetLiveActivity.swift</code> ç„¡æ³•å­˜å– <code>PauseIntent()</code>ã€‚</p>
<p>è§£æ³•è¾¦æ³•ç‚ºå»ºç«‹ä¸€å€‹æ–°æª”æ¡ˆæ˜ å°„ <code>TimerWidgetLiveActivityIntent.swift</code> çš„åŠŸèƒ½ï¼Œä½†é€™å€‹æ–°æª”æ¡ˆçš„ Target å‹¾é¸ Extensionã€‚</p>
<p>æˆ‘å€‘å»ºç«‹ <code>IntentPlaceholder.swift</code>ï¼Œå®ƒè¤‡è£½ <code>TimerWidgetLiveActivityIntent.swift</code> ï¼Œä½†ä¸åŒ…å«ä»»ä½•å¯¦éš›çš„å¯¦ä½œé‚è¼¯</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IntentPlaceholder.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> AppIntents</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">PauseIntent</span>: <span class="title">LiveActivityIntent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">LocalizedStringResource</span> <span class="operator">=</span> <span class="string">&quot;æš«åœ&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">perform</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="keyword">some</span> <span class="type">IntentResult</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> .result()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ResumeIntent</span>: <span class="title">LiveActivityIntent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">LocalizedStringResource</span> <span class="operator">=</span> <span class="string">&quot;ç¹¼çºŒ&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">perform</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="keyword">some</span> <span class="type">IntentResult</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> .result()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ResetIntent</span>: <span class="title">LiveActivityIntent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">LocalizedStringResource</span> <span class="operator">=</span> <span class="string">&quot;é‡ç½®&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">perform</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="keyword">some</span> <span class="type">IntentResult</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> .result()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Live Activity çš„æŒ‰éˆ•æ¥è‘—éœ€è¦å¯¦ä½œåŠŸèƒ½ï¼Œæˆ‘å€‘å¯èƒ½éå¸¸ç›´è§€çš„å¾ Live Activity Intent å‘¼å« Native Module æ–¹æ³•ã€‚ç¢ºå¯¦é€™ç¨®æ–¹å¼å¯ä»¥é‹ä½œï¼Œä½†æœ‰å€‹å•é¡Œï¼ŒReact Native æ‡‰ç”¨ç¨‹å¼ä¸æœƒçŸ¥é“é€™äº›æ–¹æ³•è§¸ç™¼äº†ã€‚</p>
<p>æˆªæ­¢ç›®å‰ç‚ºæ­¢çš„æ•™å­¸ï¼Œæˆ‘å€‘å·²ç¶“ç†Ÿæ‚‰å¦‚ä½•å¾ JavaScript å¦‚ä½•å’ŒåŸç”Ÿç’°å¢ƒæºé€šï¼Œä½†å•é¡Œæ˜¯å¦‚ä½•åéä¾†å¾åŸç”Ÿç’°å¢ƒå‘ JavaScript æºé€šã€‚</p>
<p>Native Module èƒ½å¤ ä½¿ç”¨äº‹ä»¶ç™¼é€æ©Ÿåˆ¶å‘ JavaScript ç™¼é€äº‹ä»¶ï¼Œè¦å»ºç«‹é€™å€‹æºé€šéœ€è¦ï¼š</p>
<ol>
<li>å»ºç«‹ <code>RCTEventEmitter</code> çš„å­é¡åˆ¥å¯¦ä½œ <code>supportedEvents</code> æ–¹æ³•å’Œ <code>self.sendEventWithName</code></li>
<li>åœ¨ JavaScript é€šé <code>NativeEventEmitter</code>è¨‚é–±é€™äº›äº‹ä»¶</li>
</ol>
<p>ç¬¬ä¸€æ­¥æˆ‘å€‘å»ºç«‹ä¸€å€‹å°ˆé–€ç”¨æ–¼ç™¼é€äº‹ä»¶çš„ Native Module é€™è£¡éœ€è¦å»ºç«‹ 2 å€‹æª”æ¡ˆ</p>
<ul>
<li>Bridge</li>
<li>å¯¦ä½œæª”æ¡ˆ</li>
</ul>
<p>é€™äº›æª”æ¡ˆéƒ½æ‡‰è©²åªåŠ å…¥åˆ°æ‡‰ç”¨ç¨‹å¼çš„ Target ï¼Œæˆ‘å€‘å…ˆå»ºç«‹ Objective-C æª”æ¡ˆ <code>TimerEventEmitter.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;React/RCTBridgeModule.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;React/RCTEventEmitter.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RCT_EXTERN_MODULE</span>(<span class="title">TimerEventEmitter</span>, <span class="title">RCTEventEmitter</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">bool</span>)requiresMainQueueSetup &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RCT_EXTERN_METHOD(supportedEvents)</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p><code>supportedEvents</code> æ–¹æ³•åœ¨é€™å€‹è¨­å®šè‡³é—œé‡è¦ï¼Œå®ƒéœ€è¦è¢«åŒ¯å‡ºåˆ° JavaScriptï¼Œä½¿ React Native èƒ½å¤ è­˜åˆ¥ä¸¦è¨»å†Šæ‚¨çš„æ¨¡çµ„å°‡ç™¼å‡ºçš„äº‹ä»¶ã€‚</p>
<p>æ¥è‘—ï¼Œå»ºç«‹ <code>TimerEventEmitter.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc(TimerEventEmitter)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimerEventEmitter</span>: <span class="title">RCTEventEmitter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> emitter: <span class="type">TimerEventEmitter</span>?</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">    <span class="type">TimerEventEmitter</span>.emitter <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">supportedEvents</span>()</span> -&gt; [<span class="type">String</span>]<span class="operator">!</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&quot;onPause&quot;</span>, <span class="string">&quot;onResume&quot;</span>, <span class="string">&quot;onReset&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>TimerEventEmitter</code> é¡åˆ¥ç¹¼æ‰¿äº† React Native äº‹ä»¶è§¸ç™¼é¡åˆ¥ï¼Œä¸¦è¨­å®šäº† <code>onPause</code>ã€<code>onResume</code>ã€<code>onReset</code> äº‹ä»¶å¯ä»¥å¾ Swift è§¸ç™¼ï¼Œç„¶å¾Œæˆ‘å€‘å¯ä»¥å¾ JavaScript é€™é‚Šæ“·å–ã€‚å¯¦ä½œä¸Šé¢æ‡‰è©²æœƒé‡åˆ°ç„¡æ³•è¼‰å…¥ <code>RCTEventEmitter</code> ç­‰çš„å•é¡Œï¼Œæˆ‘å€‘éœ€è¦åœ¨ <code>Timer-Bridging-Header.h</code> è¼‰å…¥</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;React/RCTEventEmitter.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;React/RCTBridgeModule.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>æ¥è‘—æˆ‘å€‘å°±å¯ä»¥åœ¨ <code>TimerWidgetLiveActivityIntent.swift</code> è£¡ä½¿ç”¨ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> AppIntents</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">PauseIntent</span>: <span class="title">LiveActivityIntent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">LocalizedStringResource</span> <span class="operator">=</span> <span class="string">&quot;æš«åœ&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">perform</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="keyword">some</span> <span class="type">IntentResult</span> &#123;</span><br><span class="line">    <span class="type">TimerEventEmitter</span>.emitter<span class="operator">?</span>.sendEvent(withName: <span class="string">&quot;onPause&quot;</span>, body: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">return</span> .result()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ResumeIntent</span>: <span class="title">LiveActivityIntent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">LocalizedStringResource</span> <span class="operator">=</span> <span class="string">&quot;ç¹¼çºŒ&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">perform</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="keyword">some</span> <span class="type">IntentResult</span> &#123;</span><br><span class="line">    <span class="type">TimerEventEmitter</span>.emitter<span class="operator">?</span>.sendEvent(withName: <span class="string">&quot;onResume&quot;</span>, body: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">return</span> .result()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ResetIntent</span>: <span class="title">LiveActivityIntent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">LocalizedStringResource</span> <span class="operator">=</span> <span class="string">&quot;é‡ç½®&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">perform</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="keyword">some</span> <span class="type">IntentResult</span> &#123;</span><br><span class="line">    <span class="type">TimerEventEmitter</span>.emitter<span class="operator">?</span>.sendEvent(withName: <span class="string">&quot;onReset&quot;</span>, body: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">return</span> .result()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€å¾Œæˆ‘å€‘åœ¨ <code>useTimer</code> è£¡é¢ä½¿ç”¨ <code>NativeEventEmitter</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef, useEffect, useCallback &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NativeModules, NativeEventEmitter &#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; TimerWidgetModule &#125; = NativeModules;</span><br><span class="line"><span class="keyword">const</span> timerEmitter = <span class="keyword">new</span> NativeEventEmitter(NativeModules.TimerEventEmitter);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useTimer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [elapsedTimeInMs, setElapsedTimeInMs] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isPlaying, setIsPlaying] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> startTime = useRef(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> pausedTime = useRef(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> intervalId = useRef(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> elapsedTimeInSeconds = <span class="built_in">Math</span>.floor(elapsedTimeInMs / <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">const</span> secondsOnesDigit = elapsedTimeInSeconds % <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">const</span> secondsTensDigit = <span class="built_in">Math</span>.floor(elapsedTimeInSeconds / <span class="number">10</span>) % <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">const</span> minutes = <span class="built_in">Math</span>.floor(elapsedTimeInSeconds / <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> value = <span class="string">`<span class="subst">$&#123;minutes&#125;</span>:<span class="subst">$&#123;secondsTensDigit&#125;</span><span class="subst">$&#123;secondsOnesDigit&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> play = useCallback(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIsPlaying(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!startTime.current) &#123;</span><br><span class="line">      startTime.current = <span class="built_in">Date</span>.now();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pausedTime.current) &#123;</span><br><span class="line">      <span class="comment">// è‹¥è¨ˆæ™‚å™¨è™•æ–¼æš«åœï¼Œå‰‡æ›´æ–° startTime</span></span><br><span class="line">      <span class="keyword">const</span> elapsedSincePaused = <span class="built_in">Date</span>.now() - pausedTime.current;</span><br><span class="line">      startTime.current = startTime.current + elapsedSincePaused;</span><br><span class="line">      pausedTime.current = <span class="literal">null</span>;</span><br><span class="line">      TimerWidgetModule.resume();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      TimerWidgetModule.startLiveActivity(startTime.current / <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    intervalId.current = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setElapsedTimeInMs(<span class="built_in">Date</span>.now() - startTime.current);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> pause = useCallback(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIsPlaying(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(intervalId.current);</span><br><span class="line">      intervalId.current = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (startTime.current &amp;&amp; !pausedTime.current) &#123;</span><br><span class="line">      pausedTime.current = <span class="built_in">Date</span>.now();</span><br><span class="line">      TimerWidgetModule.pause(pausedTime.current / <span class="number">1000</span>);</span><br><span class="line">      setElapsedTimeInMs(pausedTime.current - startTime.current);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> reset = useCallback(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIsPlaying(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (intervalId.current) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(intervalId.current);</span><br><span class="line">      intervalId.current = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    startTime.current = <span class="literal">null</span>;</span><br><span class="line">    pausedTime.current = <span class="literal">null</span>;</span><br><span class="line">    setElapsedTimeInMs(<span class="number">0</span>);</span><br><span class="line">    TimerWidgetModule.stopLiveActivity();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> pauseSubscription = timerEmitter.addListener(<span class="string">&#x27;onPause&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;onPause&#x27;</span>);</span><br><span class="line">      pause();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> resumeSubscription = timerEmitter.addListener(<span class="string">&#x27;onResume&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;onResume&#x27;</span>);</span><br><span class="line">      play();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> resetSubscription = timerEmitter.addListener(<span class="string">&#x27;onReset&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;onReset&#x27;</span>);</span><br><span class="line">      reset();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      pauseSubscription.remove();</span><br><span class="line">      resumeSubscription.remove();</span><br><span class="line">      resetSubscription.remove();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [pause, reset, play]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; value, play, pause, reset, isPlaying &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç­†è¨˜"><a href="#ç­†è¨˜" class="headerlink" title="ç­†è¨˜"></a>ç­†è¨˜</h2><p>React Native -&gt; Nativeï¼š</p>
<ul>
<li>å»ºç«‹ Bridge æª”æ¡ˆ (.m)ï¼Œå®£å‘Š Module å’Œæ–¹æ³•</li>
<li>å»ºç«‹å¯¦ä½œæª”æ¡ˆ (.swift)ï¼Œä½¿ç”¨ <code>@objc</code> æ¨™è¨˜</li>
</ul>
<p>Native -&gt; React Nativeï¼š</p>
<ul>
<li>å»ºç«‹ Event Emitterï¼ŒBridge æª”æ¡ˆ - ç¹¼æ‰¿ RCTEventEmitterã€‚</li>
<li>Swift å¯¦ä½œæª”æ¡ˆ - å®šç¾©å¯ç™¼é€çš„äº‹ä»¶</li>
<li>Swift ç«¯ç™¼é€äº‹ä»¶ (<code>sendEvent</code>)</li>
<li>RN ç«¯ç›£è½äº‹ä»¶ (<code>NativeEventEmitter</code>)</li>
</ul>
<h2 id="åƒè€ƒè³‡æ–™"><a href="#åƒè€ƒè³‡æ–™" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.reactnative.university/blog/live-activities-unleashed">iOS Live Activities Unleashed</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/activitykit/displaying-live-data-with-live-activities">Displaying live data with Live Activities</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/design/human-interface-guidelines/live-activities">Live Activities</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/widgetkit/keeping-a-widget-up-to-date">Keeping a widget up to date</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>React Native å¯¦ä½œ iOS Live Activity</p><p><a href="https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/">https://andyyou.github.io/2024/10/28/implement-live-activity-for-rn/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><p>andyyou(YOU,ZONGYAN)</p></div></div><div class="level-item is-narrow"><div><h6>ç™¼è¡¨æ–¼</h6><p>2024-10-28</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°æ–¼</h6><p>2025-10-16</p></div></div><div class="level-item is-narrow"><div><h6>è¨±å¯å”è­°</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/react-native/">react-native</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">å–œæ­¡é€™ç¯‡æ–‡ç« å—? è´ŠåŠ©ä¸€ä¸‹ä½œè€…å§!</h3><div class="buttons is-centered"><a class="button donate" href="https://www.buymeacoffee.com/andyyou" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>é€æˆ‘æ¯å’–å•¡</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2025/02/16/2025-devops-gitops/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">2025 DevOps å·¥å…·æ•´ç†</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2024/07/08/laravel-interface/"><span class="level-item">[è­¯]Laravel ä»‹é¢æœ€ä½³å¯¦ä½œ</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars2.githubusercontent.com/u/665690?v=3&amp;s=466" alt="andyou"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">andyou</p><p class="is-size-6 is-block">DEVLOG of andyyou</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Taipei</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">231</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†é¡</p><a href="/categories"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ¨™ç±¤</p><a href="/tags"><p class="title">94</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/andyyou" target="_blank" rel="noopener">è¿½è¹¤</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/andyyou"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="/"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="/"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="/"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">åˆ†é¡</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Cloud/"><span class="level-start"><span class="level-item">Cloud</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/DevOps/"><span class="level-start"><span class="level-item">DevOps</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Fun/"><span class="level-start"><span class="level-item">Fun</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Management/"><span class="level-start"><span class="level-item">Management</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Mobile/"><span class="level-start"><span class="level-item">Mobile</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Program/"><span class="level-start"><span class="level-item">Program</span></span><span class="level-end"><span class="level-item tag">161</span></span></a></li><li><a class="level is-mobile" href="/categories/System/"><span class="level-start"><span class="level-item">System</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Tools/"><span class="level-start"><span class="level-item">Tools</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/UX/"><span class="level-start"><span class="level-item">UX</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-10-16T02:07:15.000Z">2025-10-16</time></p><p class="title"><a href="/2025/10/16/laravel-sanctum/">Laravel Sanctum ç­†è¨˜</a></p><p class="categories"><a href="/categories/Program/">Program</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-08-29T22:32:32.000Z">2025-08-30</time></p><p class="title"><a href="/2025/08/30/gh-ost/">gh-ost ç„¡é–ç·¨è¼¯è³‡æ–™çµæ§‹</a></p><p class="categories"><a href="/categories/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-16T05:47:22.000Z">2025-02-16</time></p><p class="title"><a href="/2025/02/16/2025-devops-gitops/">2025 DevOps å·¥å…·æ•´ç†</a></p><p class="categories"><a href="/categories/DevOps/">DevOps</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-10-28T09:04:56.000Z">2024-10-28</time></p><p class="title"><a href="/2024/10/28/implement-live-activity-for-rn/">React Native å¯¦ä½œ iOS Live Activity</a></p><p class="categories"><a href="/categories/Program/">Program</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-08T08:07:15.000Z">2024-07-08</time></p><p class="title"><a href="/2024/07/08/laravel-interface/">[è­¯]Laravel ä»‹é¢æœ€ä½³å¯¦ä½œ</a></p><p class="categories"><a href="/categories/Program/">Program</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½™æ•´</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/10/"><span class="level-start"><span class="level-item">åæœˆ 2025</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2025</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2025</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">åæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">åæœˆ 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">å››æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">å››æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">åæœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">å››æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">åæœˆ 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">å››æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">åæœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">å››æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2016</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">åæœˆ 2016</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2016</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2016</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/04/"><span class="level-start"><span class="level-item">å››æœˆ 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2016</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2016</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/10/"><span class="level-start"><span class="level-item">åæœˆ 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2015</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">å››æœˆ 2015</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2014</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/10/"><span class="level-start"><span class="level-item">åæœˆ 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2014</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2014</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2014</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/10/"><span class="level-start"><span class="level-item">åæœˆ 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2013</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2013</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2012</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2012</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2011/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2011</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ¨™ç±¤</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/net-mvc/"><span class="tag">.net mvc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RoR/"><span class="tag">RoR</span><span class="tag">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/api/"><span class="tag">api</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aws/"><span class="tag">aws</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azure/"><span class="tag">azure</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bot/"><span class="tag">bot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bundler/"><span class="tag">bundler</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cache/"><span class="tag">cache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/carrier-wave/"><span class="tag">carrier wave</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/centos/"><span class="tag">centos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chrome/"><span class="tag">chrome</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloudflare/"><span class="tag">cloudflare</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/compass/"><span class="tag">compass</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag">19</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cve/"><span class="tag">cve</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devise/"><span class="tag">devise</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devops/"><span class="tag">devops</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dnd/"><span class="tag">dnd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/e-invoice/"><span class="tag">e-invoice</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/entity-framework/"><span class="tag">entity framework</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/envoy/"><span class="tag">envoy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/es6/"><span class="tag">es6</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/facebook/"><span class="tag">facebook</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flux/"><span class="tag">flux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/framework/"><span class="tag">framework</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gcp/"><span class="tag">gcp</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gitlab/"><span class="tag">gitlab</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gitops/"><span class="tag">gitops</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/grunt/"><span class="tag">grunt</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gulp/"><span class="tag">gulp</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/heroku/"><span class="tag">heroku</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/html/"><span class="tag">html</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iisexpress/"><span class="tag">iisexpress</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ios/"><span class="tag">ios</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag">88</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript-express-passport/"><span class="tag">javascript express passport</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript-nodejs/"><span class="tag">javascript nodejs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jekyll/"><span class="tag">jekyll</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jetstream/"><span class="tag">jetstream</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jspm/"><span class="tag">jspm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jwt/"><span class="tag">jwt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/laravel/"><span class="tag">laravel</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/letsencrypt/"><span class="tag">letsencrypt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mechanism/"><span class="tag">mechanism</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nextjs/"><span class="tag">nextjs</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/oocss/"><span class="tag">oocss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/osx/"><span class="tag">osx</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/package-manager/"><span class="tag">package manager</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php/"><span class="tag">php</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgres/"><span class="tag">postgres</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgresql/"><span class="tag">postgresql</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/queue/"><span class="tag">queue</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rabbitmq/"><span class="tag">rabbitmq</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rack-server/"><span class="tag">rack server</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rails/"><span class="tag">rails</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rails-webpack-stimulus-javascript-bootstrap/"><span class="tag">rails webpack stimulus javascript bootstrap</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/raspberry-pi/"><span class="tag">raspberry-pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react-native</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reactjs/"><span class="tag">reactjs</span><span class="tag">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redux/"><span class="tag">redux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ruby/"><span class="tag">ruby</span><span class="tag">18</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sass/"><span class="tag">sass</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/selenium/"><span class="tag">selenium</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/serial-port/"><span class="tag">serial-port</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/slim/"><span class="tag">slim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssl/"><span class="tag">ssl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/stimulus/"><span class="tag">stimulus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/svg-javascript/"><span class="tag">svg javascript</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/task-runner/"><span class="tag">task runner</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tmux/"><span class="tag">tmux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tools/"><span class="tag">tools</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ux/"><span class="tag">ux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vm/"><span class="tag">vm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vue/"><span class="tag">vue</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vuejs/"><span class="tag">vuejs</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webpack/"><span class="tag">webpack</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wsl/"><span class="tag">wsl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xml/"><span class="tag">xml</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zoom/"><span class="tag">zoom</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">å»£å‘Š</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3038600205998182" data-ad-slot="6442659171" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="DEVLOG of andyyou" height="28"></a><p class="is-size-7"><span>&copy; 2025 andyyou(YOU,ZONGYAN)</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/andyyou/"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-TW");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é é¦–" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="è«‹è¼¸å…¥é—œéµå­—..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"è«‹è¼¸å…¥é—œéµå­—...","untitled":"(ç„¡æ¨™é¡Œ)","posts":"æ–‡ç« ","pages":"é é¢","categories":"åˆ†é¡","tags":"æ¨™ç±¤"});
        });</script></body></html>